<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Constructions on Annotations :: Reasonably Polymorphic</title>
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
        <link href="../atom.xml" rel="alternate" title="Reasonably Polymorphic - Atom" type="application/atom+xml" />
        <link href="../feed.rss" rel="alternate" title="Reasonably Polymorphic - RSS" type="application/rss+xml" />

        <link href="http://fonts.googleapis.com/css?family=Amiri|Muli" rel="stylesheet" type="text/css" />
        <link href="../css/style.css" type="text/css" rel="stylesheet" />
        <link href="../css/syntax.css" type="text/css" rel="stylesheet" />

        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script type="text/javascript" src="../js/baseline.js"></script>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                    "HTML-CSS": {
                        scale: 50
                    },
  TeX: {extensions: [ "AMSmath.js"
                    , "AMSsymbols.js"
                    , "color.js"
                    , "http://sonoisa.github.io/xyjax_ext/xypic.js"
                    ]}
            });
        </script>
        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
          <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-76834556-1', 'auto');
  ga('send', 'pageview');
  </script>

        </head>
        <body>

<div class="column">
    <article>
<header>
    <h1><a href="../book/constructions-on-annotations">Constructions on Annotations</a></h1>
</header>
<p class="meta">
    
    <span class="prev">
        <a href="../book/latches">&larr;</a>
    </span>
    
    
    <span class="next">
        <a href="../book/memory">&rarr;</a>
    </span>
    
    <time>November 10, 2016</time>
    
        <span class="tags">
        
        </span>
    
</p>
<div class="content">
    <p>In the last chapter, we built the <code>Snap*</code> machine – a memory cell which “captures” some polymorphic input, and continuously outputs it until a signal comes in telling it to capture something new. This is exactly how your computer remembers the contents of a file when you save it, albeit our <code>Snap*</code> machinery is at a smaller scale. The goal of the next chapter is to fix that and build real memory blocks for ourselves. The goal for <em>this</em> chapter, however, is to build some abstractions <em>on top of our multiwire annotations</em> in order to do that.</p>
<p>Conceptually, the way we will do this is by putting a bunch of <code>Snap*</code> machines side by side, routing the same polymorphic input into them, and then use the value of a nybble to help “route” our <code>S</code>napshot wire into “the correct machine.” This should somewhat remind you of the work we did on <code>Demux2</code>, where we fed the same input into our <code>and</code> games, and used a <code>Split</code> machine to route a switching signal to the correct <code>and</code> gate that we wanted. If the details of this construction aren’t fresh in your memory, it might be helpful to review <a href="../book/multiplexing">Chapter 7 on Multiplexing</a> again before continuing.</p>
<p>In effect, what we want is a demuxer that is <em>polymorphic</em> in its <code>D</code>estination wire as well as its value wire. If this were the case, we’d be able to route an input between <span class="math inline">\(2^n\)</span> destinations (where <code>:n</code> is our wire annotation), rather than just the two (<span class="math inline">\(2^1=2\)</span> when our <code>D</code> <em>isn’t</em> polymorphic) that <code>Demux2</code> gives us.</p>
<p>The black-box machine diagram we want is this:</p>
<p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot;
    &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;300.0000&quot; stroke-opacity=&quot;1&quot; viewBox=&quot;0 0 624 300&quot; font-size=&quot;1&quot; width=&quot;624.0000&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; stroke=&quot;rgb(0,0,0)&quot; version=&quot;1.1&quot;&gt;&lt;defs&gt;&lt;/defs&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;35.287464655984905px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,346.9934,174.2601)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;Demux&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;23.524976437323275px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,452.8558,174.2601)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;23.524976437323275px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,241.1310,203.6664)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;D&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;23.524976437323275px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,241.1310,144.8539)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;A&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 476.3808,134.5617 l -0.0000,79.3968 h -258.7747 l -0.0000,-79.3968 Z&quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 158.7936,203.6664 h 58.8124 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 158.7936,144.8539 h 58.8124 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;58.81244109330818px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,579.3025,174.6130)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;{&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 535.1932,174.2601 h 44.1093 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;23.524976437323275px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,535.1932,150.7352)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:(2^d,n)&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 476.3808,174.2601 h 58.8124 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 99.9811,203.6664 h 58.8124 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;23.524976437323275px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,99.9811,180.1414)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:d&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 41.1687,203.6664 h 58.8124 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;58.81244109330818px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,41.1687,204.0192)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;}&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 99.9811,144.8539 h 58.8124 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;23.524976437323275px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,99.9811,121.3289)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:n&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 41.1687,144.8539 h 58.8124 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;58.81244109330818px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3653964013080577&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,41.1687,145.2068)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;}&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;
" id="bb_demux" class="circuit" /></p>
<p>Black-box machine diagrams do little more than to tell us the <em>interface</em> we want our machine to have. More specifically, they are useful primarily to give annotations to any multiwires in our diagram. Here, <code>Demux</code> takes an input <code>A:n</code> and another input <code>D:d</code>. The output has this weird <code>:(2^d,n)</code> annotation, which we’ll discuss shortly.</p>
<h2 id="constructions-on-annotations">Constructions on Annotations</h2>
<p>Annotations are interesting beasts – they describe the general “shape” of what a multiwire must look like. Of course, at the end of the day, multiwires are nothing but lots of wires side-by-side, with no real structure for them. These annotations describe a pattern that exists mostly in our brains.</p>
<p>Whenever you see the word “pattern” in this book (and more generally, whenever you see patterns in real life), you should immediately begin asking yourself “how can we abstract this pattern?” How can we describe the same-ness or different-ness of one pattern compared to another? What are the defining characteristics of this pattern, that we could use to spot another one?</p>
<p>Once these questions are answered, you begin to be capable of describing all the <em>specific instances</em> of a pattern (eg. train, car, boat, plane, dog sled) as <em>instances of the pattern itself</em> (eg. vehicles). In doing so, you have lost some specificity, but gained the ability to manipulate and think larger thoughts about the specific instances that this pattern represents.</p>
<p>And so we find ourselves looking at multiwire annotations as a pattern, because we’d like to manipulate them. We want to find a means of describing one annotation in terms of some other one.</p>
<p>The simplest way to do this is to acknowledge that our annotations can be interpreted as <em>numbers</em>, and indeed, this is what they have been so far. Our nybbles are annotated as <code>:4</code>, for example. This suggests we should be able to perform <em>algebra</em> on our annotations. A nybble with an extra wire to store some auxiliary information might have the annotation <code>:4+1</code>, which of course is just <code>:5</code>. More interestingly, our <em>polymorphic</em> wire annotated as <code>:n</code> might go through a machine which equips it with a similar auxiliary wire – the output to such a machine might be <code>:n+1</code>.</p>
<p>If we can add wires, we can probably multiply them too. And indeed, we can. However, there are two interpretations of what it means to multiply annotations together. The first is in terms of <em>numbers</em>, so <code>:2*3</code> is just the annotation <code>:6</code>. The other interpretation is more <em>structural</em>. Consider this table:</p>
<table>
<tbody>
<tr class="odd">
<td> </td>
<td> </td>
<td> </td>
</tr>
<tr class="even">
<td> </td>
<td> </td>
<td> </td>
</tr>
</tbody>
</table>
<p>While this table has <span class="math inline">\(6\)</span> cells, it equivalently has <span class="math inline">\(2\)</span> rows of <span class="math inline">\(3\)</span> columns. In an annotation context, this interpretation would be labeled <code>:(2,3)</code>. It’s an interesting construction to think about, because this table metaphor generalizes pretty well. Instead of thinking of <em>multiplication</em>, we can instead think of <em>replacement</em>. <code>:(2,3)</code> can be thought of an annotation where each of the <em>single wires</em> in <code>:2</code> are replaced with <em>multiwires</em> with annotation <code>:3</code>.</p>
<p>In short, this diagram, the expanded form of a multiwire <code>:2</code>:</p>
<p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot;
    &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;300.0000&quot; stroke-opacity=&quot;1&quot; viewBox=&quot;0 0 624 300&quot; font-size=&quot;1&quot; width=&quot;624.0000&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; stroke=&quot;rgb(0,0,0)&quot; version=&quot;1.1&quot;&gt;&lt;defs&gt;&lt;/defs&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3416407864998738&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 218.2500,206.2500 h 187.5000 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.3416407864998738&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 218.2500,93.7500 h 187.5000 &quot;/&gt;&lt;/g&gt;&lt;/svg&gt;
" id="two" class="circuit" /></p>
<p>becomes this diagram, where we’ve replaced each of the single wires with multiwires:</p>
<p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot;
    &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;300.0000&quot; stroke-opacity=&quot;1&quot; viewBox=&quot;0 0 624 300&quot; font-size=&quot;1&quot; width=&quot;624.0000&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; stroke=&quot;rgb(0,0,0)&quot; version=&quot;1.1&quot;&gt;&lt;defs&gt;&lt;/defs&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.0954451150103324&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 249.5000,237.5000 h 125.0000 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;50.0px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.0954451150103324&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,249.5000,187.5000)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:3&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.0954451150103324&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 249.5000,112.5000 h 125.0000 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;50.0px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.0954451150103324&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,249.5000,62.5000)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:3&lt;/text&gt;&lt;/g&gt;&lt;/svg&gt;
" id="twomulti" class="circuit" /></p>
<p>which, of course, is the same as this <em>expanded</em> multiwire:</p>
<p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot;
    &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;300.0000&quot; stroke-opacity=&quot;1&quot; viewBox=&quot;0 0 624 300&quot; font-size=&quot;1&quot; width=&quot;624.0000&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; stroke=&quot;rgb(0,0,0)&quot; version=&quot;1.1&quot;&gt;&lt;defs&gt;&lt;/defs&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.0954451150103324&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 249.5000,237.5000 h 125.0000 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.0954451150103324&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 249.5000,212.5000 h 125.0000 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.0954451150103324&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 249.5000,187.5000 h 125.0000 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.0954451150103324&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 249.5000,112.5000 h 125.0000 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.0954451150103324&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 249.5000,87.5000 h 125.0000 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.0954451150103324&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 249.5000,62.5000 h 125.0000 &quot;/&gt;&lt;/g&gt;&lt;/svg&gt;
" id="twothree" class="circuit" /></p>
<p>While <code>:(2,3)</code> is <em>syntactically</em> equivalent to <code>:6</code>, they have very different <em>semantics</em> when viewed under this light. <code>:6</code> has no structure to it, while <code>:(2,3)</code> indicates a structure of two multiwires, each with annotation <code>:3</code>.</p>
<p>Therefore, these structural <code>:(x,y)</code> annotations can be thought of as <em>multi-multiwires</em>. We will refer to this structure as a <strong>product annotation</strong>.</p>
<blockquote>
<p>Takeaway: A product annotation <code>:(x,y)</code> is a replacement of each of the individual wires in a multiwire <code>:x</code> themselves with a multiwire <code>:y</code>.</p>
</blockquote>
<p>In this sense, multiwire annotations are <em>algebraic</em>, because we can perform <em>algebra</em> on them. Don’t worry, just because we’re doing algebra on multiwire annotations doesn’t mean we ever need to actually <em>solve</em> that algebra. We leave that work to the plebes responsible for actually implementing these wonderful designs of ours.</p>
<h2 id="back-to-sanity">Back to Sanity</h2>
<p>Returning to our <code>Demux</code> black-box, we see that it has inputs <code>A:n</code> and <code>D:d</code>, and an output <code>:(2^d,n)</code>. Here <code>2^d</code> is a barbaric rendering of <span class="math inline">\(2^d\)</span>, which as we remember, is equivalent to the count of the unique numbers we can describe in a multiwire with <code>d</code> bits. <code>Demux</code> is thus creating a multiwire for every possible number we can describe in <code>d</code> bits, and each of them is of size <code>:n</code>. This is the big bubba great granddaddy of our old <code>Demux2</code> machine.</p>
<p>Notice that the annotations on our inputs and outputs tell us a huge amount of what this machine must do, despite the fact that we don’t actually know what’s inside of it.</p>
<p>We’ll start with a simple example to help drive the point home. Consider the following machine:</p>
<p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot;
    &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;300.0000&quot; stroke-opacity=&quot;1&quot; viewBox=&quot;0 0 624 300&quot; font-size=&quot;1&quot; width=&quot;624.0000&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; stroke=&quot;rgb(0,0,0)&quot; version=&quot;1.1&quot;&gt;&lt;defs&gt;&lt;/defs&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;54.151624548736464px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.6122276447013772&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,515.0686,148.9170)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:2^x&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.6122276447013772&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 379.6895,203.0686 h 135.3791 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;54.151624548736464px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.6122276447013772&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,108.9314,148.9170)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:x&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;81.22743682310468px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.6122276447013772&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,312.0000,203.0686)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;54.151624548736464px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.6122276447013772&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,325.5379,203.0686)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;54.151624548736464px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.6122276447013772&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,298.4621,203.0686)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.6122276447013772&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 379.6895,173.8267 l -0.0000,58.4838 h -135.3791 l -0.0000,-58.4838 Z&quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.6122276447013772&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 108.9314,203.0686 h 135.3791 &quot;/&gt;&lt;/g&gt;&lt;/svg&gt;
" id="expand" class="circuit" /></p>
<p>There’s really only one “honest” implementation for this machine, in the sense that these are the true (most parsimonious) annotations for the inputs and outputs. The only <em>obvious</em> implementation of this machine is to output a 1 on the wire equivalent to the value of input multiwire. Why? Well the only relationship that we know between <code>:x</code> and <code>:2^x</code> is that we can represent <span class="math inline">\(2^x\)</span> different numbers with <code>x</code> bits. This implies we are probably expanding out the number we’ve encoded in the input multiwire. This expansion is only ever going to be <em>one</em> of the <span class="math inline">\(2^x\)</span> possibilities, implying we should probably put a 1 on that line.</p>
<p>Note that this isn’t the only implementation we could have made, but it’s the most likely based on what we know.</p>
<p>Back to <code>Demux</code>, due to our previous argument, it’s almost certainly evaluating the number stored in our <code>:d</code> multiwire, since our output is a product of <code>2^d</code> and <code>n</code>. Recall that a product is the replacement of the single wires in a multiwire each with a multiwire, so <code>:(2^d,n)</code> is, by the same argument, some way of moving <code>n</code> into the number described by <code>d</code>.</p>
<p>That’s as far as our analysis can get, since we don’t know what that means of moving <code>n</code> into <code>2^n</code> is, but we’ve already come quite some distance, analytically.</p>
<p>Enough chatting. Let’s build the dang thing. But first, a lemma from above:</p>
<p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot;
    &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;300.0000&quot; stroke-opacity=&quot;1&quot; viewBox=&quot;0 0 624 300&quot; font-size=&quot;1&quot; width=&quot;624.0000&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; stroke=&quot;rgb(0,0,0)&quot; version=&quot;1.1&quot;&gt;&lt;defs&gt;&lt;/defs&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;48.43918191603875px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.2450115747707888&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,312.0000,259.6340)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;Eval&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;3.112528936926972&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 392.7320,178.9020 l -0.0000,-138.5361 h -161.4639 l -0.0000,138.5361 Z&quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;32.29278794402583px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.2450115747707888&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,433.0980,108.9882)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:2^x&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.2450115747707888&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 352.3660,141.2809 h 80.7320 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;32.29278794402583px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.2450115747707888&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,190.9020,108.9882)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:x&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;48.43918191603875px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.2450115747707888&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,312.0000,141.2809)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;32.29278794402583px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.2450115747707888&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,320.0732,141.2809)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;32.29278794402583px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.2450115747707888&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,303.9268,141.2809)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.2450115747707888&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 352.3660,123.8428 l -0.0000,34.8762 h -80.7320 l -0.0000,-34.8762 Z&quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.2450115747707888&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 190.9020,141.2809 h 80.7320 &quot;/&gt;&lt;/g&gt;&lt;/svg&gt;
" id="eval" class="circuit" /></p>
<p>We leave the implementation of this machine as an exercise to the reader, but as our analysis showed earlier, the annotations here are powerful enough for us to reason about this machine without knowing exactly how it might work. Of course, that might not be satisfactory to you, and you are welcome to work out the function table for this as a first step to implementing it. It’s really not that hard!</p>
<p>Anyway, we now present <code>Demux</code>:</p>
<p><img src="data:image/svg+xml;utf8,&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot;
    &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; height=&quot;300.0000&quot; stroke-opacity=&quot;1&quot; viewBox=&quot;0 0 624 300&quot; font-size=&quot;1&quot; width=&quot;624.0000&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; stroke=&quot;rgb(0,0,0)&quot; version=&quot;1.1&quot;&gt;&lt;defs&gt;&lt;/defs&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;26.80028632784538px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,300.8332,239.3343)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;Demux&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;3.7331151724102485&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 556.9993,194.6671 l -0.0000,-134.0014 h -512.3321 l -0.0000,134.0014 Z&quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;17.866857551896924px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,67.0007,143.2999)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:n&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 22.3336,161.1668 h 44.6671 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;44.667143879742305px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,22.3336,161.4348)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;}&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;17.866857551896924px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,579.3329,120.9664)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:(2^d,n)&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 534.6657,138.8332 h 44.6671 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 534.6657,138.8332 h 0.0000 c 0.0000,-24.6690 -19.9982,-44.6671 -44.6671 -44.6671h -62.5340 v 89.3343 h 62.5340 c 24.6690,0.0000 44.6671,-19.9982 44.6671 -44.6671Z&quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;44.667143879742305px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,415.8511,161.4348)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;{&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 382.3508,161.1668 h 33.5004 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 382.3508,116.4996 h 44.6671 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;44.667143879742305px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,370.7373,116.7676)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;{&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 337.2369,116.4996 h 33.5004 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;17.866857551896924px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,337.2369,98.6328)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:2^d&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 292.5698,116.4996 h 44.6671 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;44.667143879742305px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,292.5698,116.7676)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;}&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;26.80028632784538px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,196.5354,116.4996)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;Eval&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;17.866857551896924px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,263.5361,116.4996)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;17.866857551896924px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,129.5347,116.4996)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;*&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 281.4030,106.8515 l -0.0000,19.2962 h -169.7351 l -0.0000,-19.2962 Z&quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 67.0007,116.4996 h 44.6671 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;17.866857551896924px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,67.0007,98.6328)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;:d&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 22.3336,116.4996 h 44.6671 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; font-size=&quot;44.667143879742305px&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;text dominant-baseline=&quot;middle&quot; transform=&quot;matrix(1.0000,0.0000,0.0000,1.0000,22.3336,116.7676)&quot; stroke=&quot;none&quot; text-anchor=&quot;middle&quot;&gt;}&lt;/text&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;0.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;1.4932460689640994&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;path d=&quot;M 67.0007,161.1668 h 315.3500 &quot;/&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;0.0&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;0.0&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;0.0&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;/g&gt;&lt;g stroke-linejoin=&quot;miter&quot; stroke-opacity=&quot;1.0&quot; fill-opacity=&quot;1.0&quot; stroke=&quot;rgb(0,0,0)&quot; stroke-width=&quot;0.0&quot; fill=&quot;rgb(0,0,0)&quot; stroke-linecap=&quot;butt&quot; stroke-miterlimit=&quot;10.0&quot;&gt;&lt;/g&gt;&lt;/svg&gt;
" id="demux" class="circuit" /></p>
<p>The jankiness at the first input to the <code>and</code> gate is unfortunate, but necessary. It’s to indicate we’re expanding all of the <code>:2^d</code> multiwire and piping each of them into a copy of the <code>and</code> gate. We need that extra single wire going directly into the <code>and</code> gate to distinguish from the syntax we established earlier where we wanted to “zip” the wires in two multiwires together. See the implementation for <code>Add4</code> if you don’t remember this concession.</p>
<p>There’s a growing trend that our machine diagrams get simpler and simpler as our diagram language becomes more and more powerful, and as we build more powerful machines to harness. <code>Demux</code> would have been literally impossible to build without polymorphic multiwires (although you could build <code>Demux</code> for any <em>particular</em> annotation).</p>
<p>Given <code>Demux</code>, we’re now set to build that memory block we’ve been discussing seemingly <em>ad infinitum</em>, but we’ll have to do it in the next chapter.</p>
<hr />
<h2 id="exercises">Exercises</h2>
<ol style="list-style-type: decimal">
<li>Flesh out the implementation for the <code>Eval</code> machine.</li>
<li>What’s the difference between “zipping” two multiwires like we did in <code>Add4</code>, vs multiplying them like we are in our <code>and</code> gate in <code>Demux</code>? When are you capable of zipping multiwires? How about multiplying?</li>
</ol>
</div>
<p class="meta">
    
    <span class="prev">
        <a href="../book/latches">&larr;</a>
    </span>
    
    
    <span class="next">
        <a href="../book/memory">&rarr;</a>
    </span>
    
</p>
</article>

    <nav>
    <h1><a href="../">REASONABLY<br />POLYMORPHIC</a></h1>

    <p> Hi there. I'm <strong>Sandy Maguire</strong>. I like improving life and
    making cool things.</p>

    <p>If you want to get in touch, I'd love to hear from you! Send me an email;
    my name is <tt>sandy</tt> and this is my website.</p>

    <h2>THINGS I MAKE</h2>
    <ul>
        <li>Code on <a href="http://github.com/isovector">github</a></li>
        <li>Essays <a href="../blog/archives/">archive</a></li>
        <li>Book <a href="../book/preface">archive</a></li>
    </ul>

    <h2>WHAT I'M DOING</h2>
    <ul>
        <li>Music at <a href="http://last.fm/user/Paamayim">last.fm</a></li>
        <li>Books at <a href="https://www.goodreads.com/review/list/14945161-sandy-maguire?shelf=currently-reading">goodreads</a></li>
        <li>Papers at <a href="https://www.mendeley.com/groups/7295141/read/papers/">mendeley</a></li>
    </ul>

    <p>
    &copy; 2011-2016 Sandy Maguire
    </p>
</nav>

</div>
    </body>
</html>

