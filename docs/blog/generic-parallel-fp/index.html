<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <base href="/"></base>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Review: Generic Parallel Functional Programming :: Reasonably Polymorphic</title>
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
        <link href="/atom.xml" rel="alternate" title="Reasonably Polymorphic - Atom" type="application/atom+xml" />
        <link href="/feed.rss" rel="alternate" title="Reasonably Polymorphic - RSS" type="application/rss+xml" />

        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/katex.min.css" />
        <link rel="stylesheet" href="/css/agda-cats.css" />

        <script src="/equations.js"></script>
        <script src="/highlight-hover.js"></script>

  <noscript>
    <style>
      body span.reasoning-step .as-written {
        display: inline;
      }

      body span.reasoning-step .alternate {
        display: none;
      }
    </style>
  </noscript>

        </head>
        <body>
<div class="main">

<article>
<header>
  <h1><a href="/blog/generic-parallel-fp/index.html#">Review: Generic Parallel Functional Programming</a></h1>
</header>
<p class="meta">
    <time>2022-03-12</time>

    <span class="tags">
        
    </span>
</p>
<div class="content">
    <!--
<pre class="Agda"><a id="164" class="Keyword">module</a> <a id="171" href="blog.generic-parallel-fp.html" class="Module">blog.generic-parallel-fp</a> <a id="196" class="Keyword">where</a>

<a id="203" class="Keyword">open</a> <a id="208" class="Keyword">import</a> <a id="215" href="Agda.Primitive.html" class="Module">Agda.Primitive</a>

<a id="231" class="Keyword">private</a>
  <a id="241" class="Keyword">variable</a>
    <a id="254" href="blog.generic-parallel-fp.html#254" class="Generalizable">A</a> <a id="256" class="Symbol">:</a> <a id="258" href="Agda.Primitive.html#326" class="Primitive">Set</a>
    <a id="266" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="268" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a> <a id="270" class="Symbol">:</a> <a id="272" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="276" class="Symbol">‚Üí</a> <a id="278" href="Agda.Primitive.html#326" class="Primitive">Set</a>
    <a id="286" href="blog.generic-parallel-fp.html#286" class="Generalizable">ùìÅ</a> <a id="288" class="Symbol">:</a> <a id="290" href="Agda.Primitive.html#597" class="Postulate">Level</a>

<a id="297" class="Keyword">record</a> <a id="Monoid"></a><a id="304" href="blog.generic-parallel-fp.html#304" class="Record">Monoid</a> <a id="311" class="Symbol">(</a><a id="312" href="blog.generic-parallel-fp.html#312" class="Bound">A</a> <a id="314" class="Symbol">:</a> <a id="316" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="319" class="Symbol">)</a> <a id="321" class="Symbol">:</a> <a id="323" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="327" class="Keyword">where</a>
  <a id="335" class="Keyword">infixr</a> <a id="342" class="Number">6</a> <a id="344" href="blog.generic-parallel-fp.html#376" class="Field Operator">_&lt;&gt;_</a>
  <a id="351" class="Keyword">field</a>
    <a id="Monoid.mempty"></a><a id="361" href="blog.generic-parallel-fp.html#361" class="Field">mempty</a> <a id="368" class="Symbol">:</a> <a id="370" href="blog.generic-parallel-fp.html#312" class="Bound">A</a>
    <a id="Monoid._&lt;&gt;_"></a><a id="376" href="blog.generic-parallel-fp.html#376" class="Field Operator">_&lt;&gt;_</a> <a id="381" class="Symbol">:</a> <a id="383" href="blog.generic-parallel-fp.html#312" class="Bound">A</a> <a id="385" class="Symbol">‚Üí</a> <a id="387" href="blog.generic-parallel-fp.html#312" class="Bound">A</a> <a id="389" class="Symbol">‚Üí</a> <a id="391" href="blog.generic-parallel-fp.html#312" class="Bound">A</a>
<a id="393" class="Keyword">open</a> <a id="398" href="blog.generic-parallel-fp.html#304" class="Module">Monoid</a> <a id="405" class="Symbol">‚¶É</a> <a id="407" class="Symbol">...</a> <a id="411" class="Symbol">‚¶Ñ</a>


<a id="415" class="Keyword">open</a> <a id="420" class="Keyword">import</a> <a id="427" href="Function.html" class="Module">Function</a>
<a id="436" class="Keyword">open</a> <a id="441" class="Keyword">import</a> <a id="448" href="Data.Product.html" class="Module">Data.Product</a> <a id="461" class="Keyword">hiding</a> <a id="468" class="Symbol">(</a><a id="469" href="Data.Product.html#3060" class="Function">zip</a><a id="472" class="Symbol">)</a>
</pre>-->
<p>Today we‚Äôre heading back into the Elliottverse ‚Äî a beautiful world where programming is principled and makes sense. The paper of the week is Conal Elliott‚Äôs <a href="http://conal.net/papers/generic-parallel-functional/generic-parallel-functional.pdf">Generic Parallel Functional Programming</a>, which productively addresses the duality between ‚Äúeasy to reason about‚Äù and ‚Äúfast to run.‚Äù</p>
<p>Consider the case of a right-associated list, we can give a scan of it in linear time and constant space:</p>
<pre class="Agda"><a id="989" class="Keyword">module</a> <a id="ExR"></a><a id="996" href="blog/generic-parallel-fp/index.html#996" class="Module">ExR</a> <a id="1000" class="Keyword">where</a>
  <a id="1008" class="Keyword">data</a> <a id="ExR.RList"></a><a id="1013" href="blog/generic-parallel-fp/index.html#1013" class="Datatype">RList</a> <a id="1019" class="Symbol">(</a><a id="1020" href="blog/generic-parallel-fp/index.html#1020" class="Bound">A</a> <a id="1022" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="1024" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="1027" class="Symbol">)</a> <a id="1029" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="1031" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1035" class="Keyword">where</a>
    <a id="ExR.RList.RNil"></a><a id="1045" href="blog/generic-parallel-fp/index.html#1045" class="InductiveConstructor">RNil</a> <a id="1050" class="Symbol">:</a> <a id="1052" href="blog/generic-parallel-fp/index.html#1013" class="Datatype">RList</a> <a id="1058" href="blog/generic-parallel-fp/index.html#1020" class="Bound">A</a>
    <a id="ExR.RList._‚óÅ_"></a><a id="1064" href="blog/generic-parallel-fp/index.html#1064" class="InductiveConstructor Operator">_‚óÅ_</a> <a id="1068" class="Symbol">:</a> <a id="1070" href="blog/generic-parallel-fp/index.html#1020" class="Bound">A</a> <a id="1072" class="Symbol">‚Üí</a> <a id="1074" href="blog/generic-parallel-fp/index.html#1013" class="Datatype">RList</a> <a id="1080" href="blog/generic-parallel-fp/index.html#1020" class="Bound">A</a> <a id="1082" class="Symbol">‚Üí</a> <a id="1084" href="blog/generic-parallel-fp/index.html#1013" class="Datatype">RList</a> <a id="1090" href="blog/generic-parallel-fp/index.html#1020" class="Bound">A</a>

  <a id="1095" class="Keyword">infixr</a> <a id="1102" class="Number">5</a> <a id="1104" href="blog/generic-parallel-fp/index.html#1064" class="InductiveConstructor Operator">_‚óÅ_</a>

  <a id="ExR.scanR"></a><a id="1111" href="blog/generic-parallel-fp/index.html#1111" class="Function">scanR</a> <a id="1117" class="Symbol">:</a> <a id="1119" class="Symbol">‚¶É</a> <a id="1121" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="1128" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="1130" class="Symbol">‚¶Ñ</a> <a id="1132" class="Symbol">‚Üí</a> <a id="1134" href="blog/generic-parallel-fp/index.html#1013" class="Datatype">RList</a> <a id="1140" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="1142" class="Symbol">‚Üí</a> <a id="1144" href="blog/generic-parallel-fp/index.html#1013" class="Datatype">RList</a> <a id="1150" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
  <a id="1154" href="blog/generic-parallel-fp/index.html#1111" class="Function">scanR</a> <a id="1160" class="Symbol">=</a> <a id="1162" href="blog/generic-parallel-fp/index.html#1188" class="Function">go</a> <a id="1165" href="blog/generic-parallel-fp/index.html#361" class="Field">mempty</a>
    <a id="1176" class="Keyword">where</a>
      <a id="1188" href="blog/generic-parallel-fp/index.html#1188" class="Function">go</a> <a id="1191" class="Symbol">:</a> <a id="1193" class="Symbol">‚¶É</a> <a id="1195" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="1202" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="1204" class="Symbol">‚¶Ñ</a> <a id="1206" class="Symbol">‚Üí</a> <a id="1208" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="1210" class="Symbol">‚Üí</a> <a id="1212" href="blog/generic-parallel-fp/index.html#1013" class="Datatype">RList</a> <a id="1218" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="1220" class="Symbol">‚Üí</a> <a id="1222" href="blog/generic-parallel-fp/index.html#1013" class="Datatype">RList</a> <a id="1228" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
      <a id="1236" href="blog/generic-parallel-fp/index.html#1188" class="Function">go</a> <a id="1239" href="blog/generic-parallel-fp/index.html#1239" class="Bound">acc</a> <a id="1243" href="blog/generic-parallel-fp/index.html#1045" class="InductiveConstructor">RNil</a> <a id="1248" class="Symbol">=</a> <a id="1250" href="blog/generic-parallel-fp/index.html#1045" class="InductiveConstructor">RNil</a>
      <a id="1261" href="blog/generic-parallel-fp/index.html#1188" class="Function">go</a> <a id="1264" href="blog/generic-parallel-fp/index.html#1264" class="Bound">acc</a> <a id="1268" class="Symbol">(</a><a id="1269" href="blog/generic-parallel-fp/index.html#1269" class="Bound">x</a> <a id="1271" href="blog/generic-parallel-fp/index.html#1064" class="InductiveConstructor Operator">‚óÅ</a> <a id="1273" href="blog/generic-parallel-fp/index.html#1273" class="Bound">xs</a><a id="1275" class="Symbol">)</a> <a id="1277" class="Symbol">=</a> <a id="1279" href="blog/generic-parallel-fp/index.html#1264" class="Bound">acc</a> <a id="1283" href="blog/generic-parallel-fp/index.html#1064" class="InductiveConstructor Operator">‚óÅ</a> <a id="1285" href="blog/generic-parallel-fp/index.html#1188" class="Function">go</a> <a id="1288" class="Symbol">(</a><a id="1289" href="blog/generic-parallel-fp/index.html#1264" class="Bound">acc</a> <a id="1293" href="blog/generic-parallel-fp/index.html#376" class="Field Operator">&lt;&gt;</a> <a id="1296" href="blog/generic-parallel-fp/index.html#1269" class="Bound">x</a><a id="1297" class="Symbol">)</a> <a id="1299" href="blog/generic-parallel-fp/index.html#1273" class="Bound">xs</a>
</pre>
<p>This is a nice functional algorithm that runs in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> time, and requires <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span> space. However, consider the equivalent algorithm over left-associative lists:</p>
<pre class="Agda"><a id="1473" class="Keyword">module</a> <a id="ExL"></a><a id="1480" href="blog/generic-parallel-fp/index.html#1480" class="Module">ExL</a> <a id="1484" class="Keyword">where</a>
  <a id="1492" class="Keyword">data</a> <a id="ExL.LList"></a><a id="1497" href="blog/generic-parallel-fp/index.html#1497" class="Datatype">LList</a> <a id="1503" class="Symbol">(</a><a id="1504" href="blog/generic-parallel-fp/index.html#1504" class="Bound">A</a> <a id="1506" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="1508" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="1511" class="Symbol">)</a> <a id="1513" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="1515" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1519" class="Keyword">where</a>
    <a id="ExL.LList.LNil"></a><a id="1529" href="blog/generic-parallel-fp/index.html#1529" class="InductiveConstructor">LNil</a> <a id="1534" class="Symbol">:</a> <a id="1536" href="blog/generic-parallel-fp/index.html#1497" class="Datatype">LList</a> <a id="1542" href="blog/generic-parallel-fp/index.html#1504" class="Bound">A</a>
    <a id="ExL.LList._‚ñ∑_"></a><a id="1548" href="blog/generic-parallel-fp/index.html#1548" class="InductiveConstructor Operator">_‚ñ∑_</a> <a id="1552" class="Symbol">:</a> <a id="1554" href="blog/generic-parallel-fp/index.html#1497" class="Datatype">LList</a> <a id="1560" href="blog/generic-parallel-fp/index.html#1504" class="Bound">A</a> <a id="1562" class="Symbol">‚Üí</a> <a id="1564" href="blog/generic-parallel-fp/index.html#1504" class="Bound">A</a> <a id="1566" class="Symbol">‚Üí</a> <a id="1568" href="blog/generic-parallel-fp/index.html#1497" class="Datatype">LList</a> <a id="1574" href="blog/generic-parallel-fp/index.html#1504" class="Bound">A</a>

  <a id="1579" class="Keyword">infixl</a> <a id="1586" class="Number">5</a> <a id="1588" href="blog/generic-parallel-fp/index.html#1548" class="InductiveConstructor Operator">_‚ñ∑_</a>

  <a id="ExL.scanL"></a><a id="1595" href="blog/generic-parallel-fp/index.html#1595" class="Function">scanL</a> <a id="1601" class="Symbol">:</a> <a id="1603" class="Symbol">‚¶É</a> <a id="1605" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="1612" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="1614" class="Symbol">‚¶Ñ</a> <a id="1616" class="Symbol">‚Üí</a> <a id="1618" href="blog/generic-parallel-fp/index.html#1497" class="Datatype">LList</a> <a id="1624" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="1626" class="Symbol">‚Üí</a> <a id="1628" href="blog/generic-parallel-fp/index.html#1497" class="Datatype">LList</a> <a id="1634" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
  <a id="1638" href="blog/generic-parallel-fp/index.html#1595" class="Function">scanL</a> <a id="1644" class="Symbol">=</a> <a data-type="Œ£ A B ‚Üí A" id="1646" href="Agda.Builtin.Sigma.html#252" class="Field">proj‚ÇÅ</a> <a id="1652" href="Function.Base.html#1031" class="Function Operator">‚àò</a> <a id="1654" href="blog/generic-parallel-fp/index.html#1673" class="Function">go</a>
    <a id="1661" class="Keyword">where</a>
      <a id="1673" href="blog/generic-parallel-fp/index.html#1673" class="Function">go</a> <a id="1676" class="Symbol">:</a> <a id="1678" class="Symbol">‚¶É</a> <a id="1680" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="1687" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="1689" class="Symbol">‚¶Ñ</a> <a id="1691" class="Symbol">‚Üí</a> <a id="1693" href="blog/generic-parallel-fp/index.html#1497" class="Datatype">LList</a> <a id="1699" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="1701" class="Symbol">‚Üí</a> <a id="1703" href="blog/generic-parallel-fp/index.html#1497" class="Datatype">LList</a> <a id="1709" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="1711" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="1713" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
      <a id="1721" href="blog/generic-parallel-fp/index.html#1673" class="Function">go</a> <a id="1724" href="blog/generic-parallel-fp/index.html#1529" class="InductiveConstructor">LNil</a> <a id="1729" class="Symbol">=</a> <a id="1731" href="blog/generic-parallel-fp/index.html#1529" class="InductiveConstructor">LNil</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="1736" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1738" href="blog/generic-parallel-fp/index.html#361" class="Field">mempty</a>
      <a id="1751" href="blog/generic-parallel-fp/index.html#1673" class="Function">go</a> <a id="1754" class="Symbol">(</a><a id="1755" href="blog/generic-parallel-fp/index.html#1755" class="Bound">xs</a> <a id="1758" href="blog/generic-parallel-fp/index.html#1548" class="InductiveConstructor Operator">‚ñ∑</a> <a id="1760" href="blog/generic-parallel-fp/index.html#1760" class="Bound">x</a><a id="1761" class="Symbol">)</a> <a id="1763" class="Symbol">=</a>
        <a id="1773" class="Keyword">let</a> <a id="1777" href="blog/generic-parallel-fp/index.html#1777" class="Bound">xs&#39;</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="1781" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1783" href="blog/generic-parallel-fp/index.html#1783" class="Bound">acc</a> <a id="1787" class="Symbol">=</a> <a id="1789" href="blog/generic-parallel-fp/index.html#1673" class="Function">go</a> <a id="1792" href="blog/generic-parallel-fp/index.html#1755" class="Bound">xs</a>
         <a id="1804" class="Keyword">in</a> <a id="1807" href="blog/generic-parallel-fp/index.html#1777" class="Bound">xs&#39;</a> <a id="1811" href="blog/generic-parallel-fp/index.html#1548" class="InductiveConstructor Operator">‚ñ∑</a> <a id="1813" href="blog/generic-parallel-fp/index.html#1783" class="Bound">acc</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="1817" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1819" href="blog/generic-parallel-fp/index.html#1760" class="Bound">x</a> <a id="1821" href="blog/generic-parallel-fp/index.html#376" class="Field Operator">&lt;&gt;</a> <a id="1824" href="blog/generic-parallel-fp/index.html#1783" class="Bound">acc</a>
</pre>
<p>While <span class="Agda"><a href="blog/generic-parallel-fp/index.html#1595" class="Function">scanL</a></span> is also <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> in its runtime, it is not amenable to tail call optimization, and thus also requires <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> <em>space.</em> Egads!</p>
<p>You are probably not amazed to learn that different ways of structuring data lead to different runtime and space complexities. But it‚Äôs a more interesting puzzle than it sounds; because <span class="Agda"><a href="blog/generic-parallel-fp/index.html#1013" class="Datatype">RList</a></span> and <span class="Agda"><a href="blog/generic-parallel-fp/index.html#1497" class="Datatype">LList</a></span> are isomorphic! So what gives?</p>
<p>Reed‚Äôs pithy description here is</p>
<blockquote>
<p>Computation time doesn‚Äôt respect isos</p>
</blockquote>
<p>Exploring that question with him has been very illuminating. Math is deeply about extentionality; two mathematical objects are equivalent if their abstract interfaces are indistinguishable. Computation‚Ä¶ doesn‚Äôt have this property. When computing, we care a great deal about runtime performance, which depends on fiddly implementation details, even if those aren‚Äôt externally observable.</p>
<p>In fact, as he goes on to state, this is the whole idea of denotational design. Figure out the extensional behavior first, and then figure out how to implement it.</p>
<p>This all harkens back to my review of another of Elliott‚Äôs papers, <a href="/blog/adders-and-arrows">Adders and Arrows</a>, which starts from the extensional behavior of natural addition (encoded as the Peano naturals), and then derives a chain of proofs showing that our everyday binary adders preserve this behavior.</p>
<p>Anyway, let‚Äôs switch topics and consider a weird fact of the world. Why do so many parallel algorithms require gnarly array indexing? Here‚Äôs an example I found by googling for ‚Äúparallel c algorithms cuda‚Äù:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>__global__ <span class="dt">void</span> stencil_1d<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>in<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>out<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  __shared__ <span class="dt">int</span> temp<span class="op">[</span>BLOCK_SIZE <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> RADIUS<span class="op">];</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> gindex <span class="op">=</span> threadIdx<span class="op">.</span>x <span class="op">+</span> blockIdx<span class="op">.</span>x <span class="op">*</span> blockDim<span class="op">.</span>x<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> lindex <span class="op">=</span> threadIdx<span class="op">.</span>x <span class="op">+</span> RADIUS<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  temp<span class="op">[</span>lindex<span class="op">]</span> <span class="op">=</span> in<span class="op">[</span>gindex<span class="op">];</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>threadIdx<span class="op">.</span>x <span class="op">&lt;</span> RADIUS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    temp<span class="op">[</span>lindex <span class="op">-</span> RADIUS<span class="op">]</span> <span class="op">=</span> in<span class="op">[</span>gindex <span class="op">-</span> RADIUS<span class="op">];</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    temp<span class="op">[</span>lindex <span class="op">+</span> BLOCK_SIZE<span class="op">]</span> <span class="op">=</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    in<span class="op">[</span>gindex <span class="op">+</span> BLOCK_SIZE<span class="op">];</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  __syncthreads<span class="op">();</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> result <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> offset <span class="op">=</span> <span class="op">-</span>RADIUS <span class="op">;</span> offset <span class="op">&lt;=</span> RADIUS <span class="op">;</span> offset<span class="op">++)</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    result <span class="op">+=</span> temp<span class="op">[</span>lindex <span class="op">+</span> offset<span class="op">];</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  out<span class="op">[</span>gindex<span class="op">]</span> <span class="op">=</span> result<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>and here‚Äôs another, expressed as an ‚Äúeasy induction‚Äù recurrence relation, from <a href="http://personal.denison.edu/~bressoud/cs402-s11/Supplements/ParallelPrefix.pdf">Richard E Ladner and Michael J Fischer. Parallel prefix computation</a>:</p>
<center>
<img src="/images/generic-parallel-fp/indices.png">
</center>
<p>Sweet lord. No wonder we‚Äôre all stuck pretending our computer machines are single threaded behemoths from the 1960s. Taking full advantage of parallelism on modern CPUs must require a research team and five years!</p>
<p>But it‚Äôs worth taking a moment and thinking about what all of this janky indexing must be doing. Whatever algorithm is telling the programmer which indices to write where necessarily must be providing a view on the data. That is, the programmer has some sort of ‚Äúshape‚Äù in mind for how the problem should be subdivided, and the indexing is an implementation of accessing the raw array elements in the desired shape.</p>
<p>At risk of beating you on the head with it, this array indexing is <em>a bad implementation of a type system.</em> Bad because it‚Äôs something the implementer needed to invent by hand, and is not in any form that the compiler can help ensure the correctness of.</p>
<p>That returns us to the big contribution of <em>Generic Function Parallel Algorithms,</em> which is a technique for decoupling the main thrust of an algorithm from extentionally-inconsequential encodings of things. The idea is to implement the algorithm on lots of trivial data structures, and then compose those small pieces together to get a <em>class</em> of algorithms.</p>
<h2 id="generic-representations"><a href="#generic-representations" class="header-link">Generic Representations<span class="header-link-emoji">üîó</span></a></h2>
<p>The first step is to determine which trivial data structures we need to support. Following the steps of Haskell‚Äôs <code>GHC.Generics</code> module, we can decompose any Haskell98 data type as compositions of the following pieces:</p>
<pre class="Agda"><a id="5738" class="Keyword">data</a> <a id="Rep"></a><a id="5743" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a> <a id="5747" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="5749" href="Agda.Primitive.html#326" class="Primitive">Set‚ÇÅ</a> <a id="5754" class="Keyword">where</a>
  <a id="Rep.V"></a><a id="5762" href="blog/generic-parallel-fp/index.html#5762" class="InductiveConstructor">V</a> <a id="5764" class="Symbol">:</a> <a id="5766" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
  <a id="Rep.U"></a><a id="5772" href="blog/generic-parallel-fp/index.html#5772" class="InductiveConstructor">U</a> <a id="5774" class="Symbol">:</a> <a id="5776" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
  <a id="Rep.K"></a><a id="5782" href="blog/generic-parallel-fp/index.html#5782" class="InductiveConstructor">K</a> <a id="5784" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="5786" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="5790" class="Symbol">‚Üí</a> <a id="5792" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
  <a id="Rep.Par"></a><a id="5798" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a> <a id="5802" class="Symbol">:</a> <a id="5804" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
  <a id="Rep.Rec"></a><a id="5810" href="blog/generic-parallel-fp/index.html#5810" class="InductiveConstructor">Rec</a> <a id="5814" class="Symbol">:</a> <a id="5816" class="Symbol">(</a><a data-type="Set‚ÇÅ" id="5817" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="5821" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="5823" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="5826" class="Symbol">)</a> <a id="5828" class="Symbol">‚Üí</a> <a id="5830" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
  <a id="Rep._:+:_"></a><a id="5836" href="blog/generic-parallel-fp/index.html#5836" class="InductiveConstructor Operator">_:+:_</a> <a id="5842" class="Symbol">:</a> <a id="5844" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a> <a id="5848" class="Symbol">‚Üí</a> <a id="5850" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a> <a id="5854" class="Symbol">‚Üí</a> <a id="5856" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
  <a id="Rep._:*:_"></a><a id="5862" href="blog/generic-parallel-fp/index.html#5862" class="InductiveConstructor Operator">_:*:_</a> <a id="5868" class="Symbol">:</a> <a id="5870" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a> <a id="5874" class="Symbol">‚Üí</a> <a id="5876" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a> <a id="5880" class="Symbol">‚Üí</a> <a id="5882" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
  <a id="Rep._:‚àò:_"></a><a id="5888" href="blog/generic-parallel-fp/index.html#5888" class="InductiveConstructor Operator">_:‚àò:_</a> <a id="5894" class="Symbol">:</a> <a id="5896" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a> <a id="5900" class="Symbol">‚Üí</a> <a id="5902" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a> <a id="5906" class="Symbol">‚Üí</a> <a id="5908" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
</pre>
<p>which we can embed in <span class="Agda"><a data-type="Set‚ÇÅ" href="Agda.Primitive.html#326" class="Primitive">Set</a></span> via <span class="Agda"><a href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a></span>:</p>
<pre class="Agda"><a id="5981" class="Keyword">open</a> <a id="5986" class="Keyword">import</a> <a id="5993" href="Data.Empty.html" class="Module">Data.Empty</a>
<a id="6004" class="Keyword">open</a> <a id="6009" class="Keyword">import</a> <a id="6016" href="Data.Sum.html" class="Module">Data.Sum</a>
<a id="6025" class="Keyword">open</a> <a id="6030" class="Keyword">import</a> <a id="6037" href="Data.Unit.html" class="Module">Data.Unit</a> <a id="6047" class="Keyword">hiding</a> <a id="6054" class="Symbol">(</a><a id="6055" href="Data.Unit.Base.html#1023" class="Record Operator">_‚â§_</a><a id="6058" class="Symbol">)</a>

<a id="6061" class="Keyword">record</a> <a id="Compose"></a><a id="6068" href="blog/generic-parallel-fp/index.html#6068" class="Record">Compose</a> <a id="6076" class="Symbol">(</a><a id="6077" href="blog/generic-parallel-fp/index.html#6077" class="Bound">F</a> <a id="6079" href="blog/generic-parallel-fp/index.html#6079" class="Bound">G</a> <a id="6081" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="6083" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="6087" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="6089" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="6092" class="Symbol">)</a> <a id="6094" class="Symbol">(</a><a id="6095" href="blog/generic-parallel-fp/index.html#6095" class="Bound">A</a> <a id="6097" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="6099" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="6102" class="Symbol">)</a> <a id="6104" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="6106" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="6110" class="Keyword">where</a>
  <a id="6118" class="Keyword">constructor</a> <a id="compose"></a><a id="6130" href="blog/generic-parallel-fp/index.html#6130" class="InductiveConstructor">compose</a>
  <a id="6140" class="Keyword">field</a>
    <a id="Compose.composed"></a><a id="6150" href="blog/generic-parallel-fp/index.html#6150" class="Field">composed</a> <a id="6159" class="Symbol">:</a> <a id="6161" href="blog/generic-parallel-fp/index.html#6077" class="Bound">F</a> <a id="6163" class="Symbol">(</a><a id="6164" href="blog/generic-parallel-fp/index.html#6079" class="Bound">G</a> <a id="6166" href="blog/generic-parallel-fp/index.html#6095" class="Bound">A</a><a id="6167" class="Symbol">)</a>
<a id="6169" class="Keyword">open</a> <a id="6174" href="blog/generic-parallel-fp/index.html#6068" class="Module">Compose</a>

<a id="Represent"></a><a id="6183" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6193" class="Symbol">:</a> <a id="6195" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a> <a id="6199" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="6201" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="6205" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="6207" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="6211" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6221" href="blog/generic-parallel-fp/index.html#5762" class="InductiveConstructor">V</a> <a id="6223" href="blog/generic-parallel-fp/index.html#6223" class="Bound">a</a>         <a id="6233" class="Symbol">=</a> <a id="6235" href="Data.Empty.html#526" class="Datatype">‚ä•</a>
<a id="6237" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6247" href="blog/generic-parallel-fp/index.html#5772" class="InductiveConstructor">U</a> <a id="6249" href="blog/generic-parallel-fp/index.html#6249" class="Bound">a</a>         <a id="6259" class="Symbol">=</a> <a data-type="Set" id="6261" href="Agda.Builtin.Unit.html#164" class="Record">‚ä§</a>
<a id="6263" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6273" class="Symbol">(</a><a id="6274" href="blog/generic-parallel-fp/index.html#5782" class="InductiveConstructor">K</a> <a id="6276" href="blog/generic-parallel-fp/index.html#6276" class="Bound">x</a><a id="6277" class="Symbol">)</a> <a id="6279" href="blog/generic-parallel-fp/index.html#6279" class="Bound">a</a>     <a id="6285" class="Symbol">=</a> <a id="6287" href="blog/generic-parallel-fp/index.html#6276" class="Bound">x</a>
<a id="6289" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6299" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a> <a id="6303" href="blog/generic-parallel-fp/index.html#6303" class="Bound">a</a>       <a id="6311" class="Symbol">=</a> <a id="6313" href="blog/generic-parallel-fp/index.html#6303" class="Bound">a</a>
<a id="6315" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6325" class="Symbol">(</a><a id="6326" href="blog/generic-parallel-fp/index.html#5810" class="InductiveConstructor">Rec</a> <a id="6330" href="blog/generic-parallel-fp/index.html#6330" class="Bound">f</a><a id="6331" class="Symbol">)</a> <a id="6333" href="blog/generic-parallel-fp/index.html#6333" class="Bound">a</a>   <a id="6337" class="Symbol">=</a> <a id="6339" href="blog/generic-parallel-fp/index.html#6330" class="Bound">f</a> <a id="6341" href="blog/generic-parallel-fp/index.html#6333" class="Bound">a</a>
<a id="6343" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6353" class="Symbol">(</a><a id="6354" href="blog/generic-parallel-fp/index.html#6354" class="Bound">x</a> <a id="6356" href="blog/generic-parallel-fp/index.html#5836" class="InductiveConstructor Operator">:+:</a> <a id="6360" href="blog/generic-parallel-fp/index.html#6360" class="Bound">y</a><a id="6361" class="Symbol">)</a> <a id="6363" href="blog/generic-parallel-fp/index.html#6363" class="Bound">a</a> <a id="6365" class="Symbol">=</a> <a id="6367" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6377" href="blog/generic-parallel-fp/index.html#6354" class="Bound">x</a> <a id="6379" href="blog/generic-parallel-fp/index.html#6363" class="Bound">a</a> <a id="6381" href="Data.Sum.Base.html#734" class="Datatype Operator">‚äé</a> <a id="6383" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6393" href="blog/generic-parallel-fp/index.html#6360" class="Bound">y</a> <a id="6395" href="blog/generic-parallel-fp/index.html#6363" class="Bound">a</a>
<a id="6397" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6407" class="Symbol">(</a><a id="6408" href="blog/generic-parallel-fp/index.html#6408" class="Bound">x</a> <a id="6410" href="blog/generic-parallel-fp/index.html#5862" class="InductiveConstructor Operator">:*:</a> <a id="6414" href="blog/generic-parallel-fp/index.html#6414" class="Bound">y</a><a id="6415" class="Symbol">)</a> <a id="6417" href="blog/generic-parallel-fp/index.html#6417" class="Bound">a</a> <a id="6419" class="Symbol">=</a> <a id="6421" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6431" href="blog/generic-parallel-fp/index.html#6408" class="Bound">x</a> <a id="6433" href="blog/generic-parallel-fp/index.html#6417" class="Bound">a</a> <a id="6435" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="6437" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6447" href="blog/generic-parallel-fp/index.html#6414" class="Bound">y</a> <a id="6449" href="blog/generic-parallel-fp/index.html#6417" class="Bound">a</a>
<a id="6451" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6461" class="Symbol">(</a><a id="6462" href="blog/generic-parallel-fp/index.html#6462" class="Bound">x</a> <a id="6464" href="blog/generic-parallel-fp/index.html#5888" class="InductiveConstructor Operator">:‚àò:</a> <a id="6468" href="blog/generic-parallel-fp/index.html#6468" class="Bound">y</a><a id="6469" class="Symbol">)</a> <a id="6471" href="blog/generic-parallel-fp/index.html#6471" class="Bound">a</a> <a id="6473" class="Symbol">=</a> <a id="6475" href="blog/generic-parallel-fp/index.html#6068" class="Record">Compose</a> <a id="6483" class="Symbol">(</a><a id="6484" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6494" href="blog/generic-parallel-fp/index.html#6462" class="Bound">x</a><a id="6495" class="Symbol">)</a> <a id="6497" class="Symbol">(</a><a id="6498" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6508" href="blog/generic-parallel-fp/index.html#6468" class="Bound">y</a><a id="6509" class="Symbol">)</a> <a id="6511" href="blog/generic-parallel-fp/index.html#6471" class="Bound">a</a>
</pre>
<p>If you‚Äôve ever worked with <code>GHC.Generics</code>, none of this should be very exciting. We can bundle everything together, plus an iso to transform to and from the <span class="Agda"><a href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a></span>ed type:</p>
<pre class="Agda"><a id="6707" class="Keyword">record</a> <a id="Generic"></a><a id="6714" href="blog/generic-parallel-fp/index.html#6714" class="Record">Generic</a> <a id="6722" class="Symbol">(</a><a id="6723" href="blog/generic-parallel-fp/index.html#6723" class="Bound">F</a> <a id="6725" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="6727" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="6731" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="6733" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="6736" class="Symbol">)</a> <a id="6738" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="6740" href="Agda.Primitive.html#326" class="Primitive">Set‚ÇÅ</a> <a id="6745" class="Keyword">where</a>
  <a id="6753" class="Keyword">field</a>
    <a id="Generic.RepOf"></a><a id="6763" href="blog/generic-parallel-fp/index.html#6763" class="Field">RepOf</a> <a id="6769" class="Symbol">:</a> <a id="6771" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
    <a id="Generic.from"></a><a id="6779" href="blog/generic-parallel-fp/index.html#6779" class="Field">from</a>  <a id="6785" class="Symbol">:</a> <a id="6787" href="blog/generic-parallel-fp/index.html#6723" class="Bound">F</a> <a id="6789" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="6791" class="Symbol">‚Üí</a> <a id="6793" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6803" href="blog/generic-parallel-fp/index.html#6763" class="Field">RepOf</a> <a id="6809" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
    <a id="Generic.to"></a><a id="6815" href="blog/generic-parallel-fp/index.html#6815" class="Field">to</a>    <a id="6821" class="Symbol">:</a> <a id="6823" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6833" href="blog/generic-parallel-fp/index.html#6763" class="Field">RepOf</a> <a id="6839" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="6841" class="Symbol">‚Üí</a> <a id="6843" href="blog/generic-parallel-fp/index.html#6723" class="Bound">F</a> <a id="6845" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
<a id="6847" class="Keyword">open</a> <a id="6852" href="blog/generic-parallel-fp/index.html#6714" class="Module">Generic</a> <a id="6860" class="Symbol">‚¶É</a> <a id="6862" class="Symbol">...</a> <a id="6866" class="Symbol">‚¶Ñ</a>

<a id="GenericRep"></a><a id="6869" href="blog/generic-parallel-fp/index.html#6869" class="Function">GenericRep</a> <a id="6880" class="Symbol">:</a> <a id="6882" class="Symbol">(</a><a id="6883" href="blog/generic-parallel-fp/index.html#6883" class="Bound">F</a> <a id="6885" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="6887" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="6891" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="6893" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="6896" class="Symbol">)</a> <a id="6898" class="Symbol">‚Üí</a> <a id="6900" class="Symbol">‚¶É</a> <a id="6902" href="blog/generic-parallel-fp/index.html#6714" class="Record">Generic</a> <a id="6910" href="blog/generic-parallel-fp/index.html#6883" class="Bound">F</a> <a id="6912" class="Symbol">‚¶Ñ</a> <a id="6914" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="6916" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="6920" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="6922" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="6926" href="blog/generic-parallel-fp/index.html#6869" class="Function">GenericRep</a> <a id="6937" class="Symbol">_</a> <a id="6939" class="Symbol">=</a> <a id="6941" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="6951" href="blog/generic-parallel-fp/index.html#6763" class="Field">RepOf</a>
</pre>
<p>Agda doesn‚Äôt have any out-of-the-box notion of <code>-XDeriveGeneric</code>, which seems like a headache at first blush. It means we need to explicitly write out a <span class="Agda"><a href="blog/generic-parallel-fp/index.html#6763" class="Field">RepOf</a></span> and <span class="Agda"><a href="blog/generic-parallel-fp/index.html#6779" class="Field">from</a></span>/<span class="Agda"><a href="blog/generic-parallel-fp/index.html#6815" class="Field">to</a></span> pairs by hand, <em>like peasants.</em> Surprisingly however, needing to implement by hand is beneficial, as it reminds us that <span class="Agda"><a href="blog/generic-parallel-fp/index.html#6763" class="Field">RepOf</a></span> <em>is not uniquely determined!</em></p>
<p>A good metaphor here is the number 16, which stands for some type we‚Äôd like to generify. A <span class="Agda"><a href="blog/generic-parallel-fp/index.html#6763" class="Field">RepOf</a></span> for 16 is an equivalent representation for 16. Here are a few:</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">2+(2+(2+(2+(2+(2+(2+2))))))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">))))))</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo>‚àó</mo><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mn>2</mn><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">((2+2)*2)+(((2+2)+2)+2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">((</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">‚àó</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(((</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>√ó</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">2 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">8</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mo>√ó</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">8 \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>4</mn><mo>√ó</mo><mn>2</mn><mo stretchy="false">)</mo><mo>√ó</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">(4 \times 2) \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mn>2</mn><mo>√ó</mo><mn>4</mn><mo stretchy="false">)</mo><mo>√ó</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">(2 \times 4) \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>√ó</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">4 \times 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">√ó</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">2^4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><msup><mn>2</mn><mn>2</mn></msup></msup></mrow><annotation encoding="application/x-tex">2^{2^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9869em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9869em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></li>
</ul>
<p>And there are lots more! Each of <span style="white-space: nowrap;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>+</mo></mrow><annotation encoding="application/x-tex">+</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">+</span></span></span></span>,</span> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>√ó</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">√ó</span></span></span></span> and exponentiation corresponds to a different way of building a type, so every one of these expressions is a distinct (if isomorphic) type with 16 values. Every single possible factoring of 16 corresponds to a different way of dividing-and-conquering, which is to say, a different (but related) algorithm.</p>
<p>The trick is to define our algorithm inductively over each <span class="Agda"><a data-type="Set‚ÇÅ" href="Agda.Primitive.html#326" class="Primitive">Set</a></span> that can result from <span class="Agda"><a href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a></span>. We can then pick different algorithms from the class by changing the specific way of factoring our type.</p>
<h2 id="left-scans"><a href="#left-scans" class="header-link">Left Scans<span class="header-link-emoji">üîó</span></a></h2>
<p>Let‚Äôs consider the case of left scans. I happen to know it‚Äôs going to require <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8411" class="Record">Functor</a></span> capabilities, so we‚Äôll also define that:</p>
<pre class="Agda"><a id="8404" class="Keyword">record</a> <a id="Functor"></a><a id="8411" href="blog/generic-parallel-fp/index.html#8411" class="Record">Functor</a> <a id="8419" class="Symbol">(</a><a id="8420" href="blog/generic-parallel-fp/index.html#8420" class="Bound">F</a> <a id="8422" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="8424" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="8428" href="blog/generic-parallel-fp/index.html#286" class="Generalizable">ùìÅ</a> <a id="8430" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="8432" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="8436" href="blog/generic-parallel-fp/index.html#286" class="Generalizable">ùìÅ</a><a id="8437" class="Symbol">)</a> <a id="8439" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="8441" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="8445" class="Symbol">(</a><a data-type="Level ‚Üí Level" id="8446" href="Agda.Primitive.html#780" class="Primitive">lsuc</a> <a id="8451" href="blog/generic-parallel-fp/index.html#8428" class="Bound">ùìÅ</a><a id="8452" class="Symbol">)</a> <a id="8454" class="Keyword">where</a>
  <a id="8462" class="Keyword">field</a>
    <a id="Functor.fmap"></a><a id="8472" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="8477" class="Symbol">:</a> <a id="8479" class="Symbol">{</a><a id="8480" href="blog/generic-parallel-fp/index.html#8480" class="Bound">A</a> <a id="8482" href="blog/generic-parallel-fp/index.html#8482" class="Bound">B</a> <a id="8484" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="8486" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="8490" href="blog/generic-parallel-fp/index.html#8428" class="Bound">ùìÅ</a><a id="8491" class="Symbol">}</a> <a id="8493" class="Symbol">‚Üí</a> <a id="8495" class="Symbol">(</a><a id="8496" href="blog/generic-parallel-fp/index.html#8480" class="Bound">A</a> <a id="8498" class="Symbol">‚Üí</a> <a id="8500" href="blog/generic-parallel-fp/index.html#8482" class="Bound">B</a><a id="8501" class="Symbol">)</a> <a id="8503" class="Symbol">‚Üí</a> <a id="8505" href="blog/generic-parallel-fp/index.html#8420" class="Bound">F</a> <a id="8507" href="blog/generic-parallel-fp/index.html#8480" class="Bound">A</a> <a id="8509" class="Symbol">‚Üí</a> <a id="8511" href="blog/generic-parallel-fp/index.html#8420" class="Bound">F</a> <a id="8513" href="blog/generic-parallel-fp/index.html#8482" class="Bound">B</a>

<a id="8516" class="Keyword">record</a> <a id="LScan"></a><a id="8523" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="8529" class="Symbol">(</a><a id="8530" href="blog/generic-parallel-fp/index.html#8530" class="Bound">F</a> <a id="8532" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="8534" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="8538" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="8540" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="8543" class="Symbol">)</a> <a id="8545" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="8547" href="Agda.Primitive.html#326" class="Primitive">Set‚ÇÅ</a> <a id="8552" class="Keyword">where</a>
  <a id="8560" class="Keyword">field</a>
    <a id="8570" class="Keyword">overlap</a> <a id="8578" class="Symbol">‚¶É</a> <a id="LScan.func"></a><a id="8580" href="blog/generic-parallel-fp/index.html#8580" class="Field">func</a> <a id="8585" class="Symbol">‚¶Ñ</a> <a id="8587" class="Symbol">:</a> <a id="8589" href="blog/generic-parallel-fp/index.html#8411" class="Record">Functor</a> <a id="8597" href="blog/generic-parallel-fp/index.html#8530" class="Bound">F</a>
    <a id="LScan.lscan"></a><a id="8603" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="8609" class="Symbol">:</a> <a id="8611" class="Symbol">‚¶É</a> <a id="8613" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="8620" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="8622" class="Symbol">‚¶Ñ</a> <a id="8624" class="Symbol">‚Üí</a> <a id="8626" href="blog/generic-parallel-fp/index.html#8530" class="Bound">F</a> <a id="8628" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="8630" class="Symbol">‚Üí</a> <a id="8632" href="blog/generic-parallel-fp/index.html#8530" class="Bound">F</a> <a id="8634" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="8636" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="8638" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>

<a id="8641" class="Keyword">open</a> <a id="8646" href="blog/generic-parallel-fp/index.html#8411" class="Module">Functor</a> <a id="8654" class="Symbol">‚¶É</a>  <a id="8657" class="Symbol">...</a>  <a id="8662" class="Symbol">‚¶Ñ</a>
<a id="8664" class="Keyword">open</a> <a id="8669" href="blog/generic-parallel-fp/index.html#8523" class="Module">LScan</a> <a id="8675" class="Symbol">‚¶É</a> <a id="8677" class="Symbol">...</a> <a id="8681" class="Symbol">‚¶Ñ</a>
</pre>
<p>What‚Äôs with the type of <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a></span>? This thing is an exclusive scan, so the first element is always <span class="Agda"><a href="blog/generic-parallel-fp/index.html#361" class="Field">mempty</a></span>, and thus the last elemenet is always returned as <span class="Agda"><a data-type="(r : Œ£ A B) ‚Üí B (fst r)" href="Agda.Builtin.Sigma.html#264" class="Field">proj‚ÇÇ</a></span> of <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a></span>.</p>
<p>We need to implement <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a></span> for each <span class="Agda"><a href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a></span>ation, and because there is no global coherence requirement in Agda, we can define our <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8411" class="Record">Functor</a></span> instances at the same time.</p>
<p>The simplest case is void which we can scan because we have a <span class="Agda"><a href="Data.Empty.html#526" class="Datatype">‚ä•</a></span> in negative position:</p>
<pre class="Agda"><a id="9189" class="Keyword">instance</a>
  <a id="lV"></a><a id="9200" href="blog/generic-parallel-fp/index.html#9200" class="Function">lV</a> <a id="9203" class="Symbol">:</a> <a id="9205" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="9211" class="Symbol">(\</a><a id="9213" href="blog/generic-parallel-fp/index.html#9213" class="Bound">a</a> <a id="9215" class="Symbol">‚Üí</a> <a id="9217" href="Data.Empty.html#526" class="Datatype">‚ä•</a><a id="9218" class="Symbol">)</a>
  <a id="9222" href="blog/generic-parallel-fp/index.html#9200" class="Function">lV</a> <a id="9225" class="Symbol">.</a><a id="9226" href="blog/generic-parallel-fp/index.html#8580" class="Field">func</a> <a id="9231" class="Symbol">.</a><a id="9232" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="9237" href="blog/generic-parallel-fp/index.html#9237" class="Bound">f</a> <a id="9239" href="blog/generic-parallel-fp/index.html#9239" class="Bound">x</a> <a id="9241" class="Symbol">=</a> <a id="9243" href="Data.Empty.html#628" class="Function">‚ä•-elim</a> <a id="9250" href="blog/generic-parallel-fp/index.html#9239" class="Bound">x</a>
  <a id="9254" href="blog/generic-parallel-fp/index.html#9200" class="Function">lV</a> <a id="9257" class="Symbol">.</a><a id="9258" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="9264" class="Symbol">()</a>
</pre>
<p><span class="Agda"><a data-type="Set" href="Agda.Builtin.Unit.html#164" class="Record">‚ä§</a></span> is also trivial. Notice that there isn‚Äôt any <code>a</code> inside of it, so our final accumulated value must be <span class="Agda"><a href="blog/generic-parallel-fp/index.html#361" class="Field">mempty</a></span>:</p>
<pre class="Agda">  <a id="lU"></a><a id="9409" href="blog/generic-parallel-fp/index.html#9409" class="Function">lU</a> <a id="9412" class="Symbol">:</a> <a id="9414" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="9420" class="Symbol">(\</a><a id="9422" href="blog/generic-parallel-fp/index.html#9422" class="Bound">a</a> <a id="9424" class="Symbol">‚Üí</a> <a data-type="Set" id="9426" href="Agda.Builtin.Unit.html#164" class="Record">‚ä§</a><a id="9427" class="Symbol">)</a>
  <a id="9431" href="blog/generic-parallel-fp/index.html#9409" class="Function">lU</a> <a id="9434" class="Symbol">.</a><a id="9435" href="blog/generic-parallel-fp/index.html#8580" class="Field">func</a> <a id="9440" class="Symbol">.</a><a id="9441" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="9446" href="blog/generic-parallel-fp/index.html#9446" class="Bound">f</a> <a id="9448" href="blog/generic-parallel-fp/index.html#9448" class="Bound">x</a> <a id="9450" class="Symbol">=</a> <a id="9452" href="blog/generic-parallel-fp/index.html#9448" class="Bound">x</a>
  <a id="9456" href="blog/generic-parallel-fp/index.html#9409" class="Function">lU</a> <a id="9459" class="Symbol">.</a><a id="9460" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="9466" href="blog/generic-parallel-fp/index.html#9466" class="Bound">x</a> <a id="9468" class="Symbol">=</a> <a id="9470" href="blog/generic-parallel-fp/index.html#9466" class="Bound">x</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="9472" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="9474" href="blog/generic-parallel-fp/index.html#361" class="Field">mempty</a>
</pre>
<p>The identity functor is also trivial. Except this time, we <em>do</em> have a result, so it becomes the accumulated value, and we replace it with how much we‚Äôve scaned thus far (nothing):</p>
<pre class="Agda">  <a id="lP"></a><a id="9674" href="blog/generic-parallel-fp/index.html#9674" class="Function">lP</a> <a id="9677" class="Symbol">:</a> <a id="9679" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="9685" class="Symbol">(\</a><a id="9687" href="blog/generic-parallel-fp/index.html#9687" class="Bound">a</a> <a id="9689" class="Symbol">‚Üí</a> <a id="9691" href="blog/generic-parallel-fp/index.html#9687" class="Bound">a</a><a id="9692" class="Symbol">)</a>
  <a id="9696" href="blog/generic-parallel-fp/index.html#9674" class="Function">lP</a> <a id="9699" class="Symbol">.</a><a id="9700" href="blog/generic-parallel-fp/index.html#8580" class="Field">func</a> <a id="9705" class="Symbol">.</a><a id="9706" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="9711" href="blog/generic-parallel-fp/index.html#9711" class="Bound">f</a> <a id="9713" class="Symbol">=</a> <a id="9715" href="blog/generic-parallel-fp/index.html#9711" class="Bound">f</a>
  <a id="9719" href="blog/generic-parallel-fp/index.html#9674" class="Function">lP</a> <a id="9722" class="Symbol">.</a><a id="9723" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="9729" href="blog/generic-parallel-fp/index.html#9729" class="Bound">x</a> <a id="9731" class="Symbol">=</a> <a id="9733" href="blog/generic-parallel-fp/index.html#361" class="Field">mempty</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="9740" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="9742" href="blog/generic-parallel-fp/index.html#9729" class="Bound">x</a>
</pre>
<p>Coproducts are uninteresting; we merely lift the tag:</p>
<pre class="Agda">  <a id="l+"></a><a id="9810" href="blog/generic-parallel-fp/index.html#9810" class="Function">l+</a> <a id="9813" class="Symbol">:</a> <a id="9815" class="Symbol">‚¶É</a> <a id="9817" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="9823" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="9825" class="Symbol">‚¶Ñ</a> <a id="9827" class="Symbol">‚Üí</a> <a id="9829" class="Symbol">‚¶É</a> <a id="9831" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="9837" href="blog/generic-parallel-fp/index.html#268" class="Generalizable">G</a> <a id="9839" class="Symbol">‚¶Ñ</a> <a id="9841" class="Symbol">‚Üí</a> <a id="9843" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="9849" class="Symbol">(\</a><a id="9851" href="blog/generic-parallel-fp/index.html#9851" class="Bound">a</a> <a id="9853" class="Symbol">‚Üí</a> <a id="9855" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="9857" href="blog/generic-parallel-fp/index.html#9851" class="Bound">a</a> <a id="9859" href="Data.Sum.Base.html#734" class="Datatype Operator">‚äé</a> <a id="9861" href="blog/generic-parallel-fp/index.html#268" class="Generalizable">G</a> <a id="9863" href="blog/generic-parallel-fp/index.html#9851" class="Bound">a</a><a id="9864" class="Symbol">)</a>
  <a id="9868" href="blog/generic-parallel-fp/index.html#9810" class="Function">l+</a> <a id="9871" class="Symbol">.</a><a id="9872" href="blog/generic-parallel-fp/index.html#8580" class="Field">func</a> <a id="9877" class="Symbol">.</a><a id="9878" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="9883" href="blog/generic-parallel-fp/index.html#9883" class="Bound">f</a> <a id="9885" class="Symbol">(</a><a id="9886" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj‚ÇÅ</a> <a id="9891" href="blog/generic-parallel-fp/index.html#9891" class="Bound">y</a><a id="9892" class="Symbol">)</a> <a id="9894" class="Symbol">=</a> <a id="9896" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj‚ÇÅ</a> <a id="9901" class="Symbol">(</a><a id="9902" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="9907" href="blog/generic-parallel-fp/index.html#9883" class="Bound">f</a> <a id="9909" href="blog/generic-parallel-fp/index.html#9891" class="Bound">y</a><a id="9910" class="Symbol">)</a>
  <a id="9914" href="blog/generic-parallel-fp/index.html#9810" class="Function">l+</a> <a id="9917" class="Symbol">.</a><a id="9918" href="blog/generic-parallel-fp/index.html#8580" class="Field">func</a> <a id="9923" class="Symbol">.</a><a id="9924" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="9929" href="blog/generic-parallel-fp/index.html#9929" class="Bound">f</a> <a id="9931" class="Symbol">(</a><a id="9932" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj‚ÇÇ</a> <a id="9937" href="blog/generic-parallel-fp/index.html#9937" class="Bound">y</a><a id="9938" class="Symbol">)</a> <a id="9940" class="Symbol">=</a> <a id="9942" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj‚ÇÇ</a> <a id="9947" class="Symbol">(</a><a id="9948" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="9953" href="blog/generic-parallel-fp/index.html#9929" class="Bound">f</a> <a id="9955" href="blog/generic-parallel-fp/index.html#9937" class="Bound">y</a><a id="9956" class="Symbol">)</a>
  <a id="9960" href="blog/generic-parallel-fp/index.html#9810" class="Function">l+</a> <a id="9963" class="Symbol">.</a><a id="9964" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="9970" class="Symbol">(</a><a id="9971" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj‚ÇÅ</a> <a id="9976" href="blog/generic-parallel-fp/index.html#9976" class="Bound">x</a><a id="9977" class="Symbol">)</a> <a id="9979" class="Symbol">=</a>
    <a id="9985" class="Keyword">let</a> <a id="9989" href="blog/generic-parallel-fp/index.html#9989" class="Bound">x&#39;</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="9992" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="9994" href="blog/generic-parallel-fp/index.html#9994" class="Bound">y</a> <a id="9996" class="Symbol">=</a> <a id="9998" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="10004" href="blog/generic-parallel-fp/index.html#9976" class="Bound">x</a>
     <a id="10011" class="Keyword">in</a> <a id="10014" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj‚ÇÅ</a> <a id="10019" href="blog/generic-parallel-fp/index.html#9989" class="Bound">x&#39;</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="10022" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="10024" href="blog/generic-parallel-fp/index.html#9994" class="Bound">y</a>
  <a id="10028" href="blog/generic-parallel-fp/index.html#9810" class="Function">l+</a> <a id="10031" class="Symbol">.</a><a id="10032" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="10038" class="Symbol">(</a><a id="10039" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj‚ÇÇ</a> <a id="10044" href="blog/generic-parallel-fp/index.html#10044" class="Bound">x</a><a id="10045" class="Symbol">)</a> <a id="10047" class="Symbol">=</a>
    <a id="10053" class="Keyword">let</a> <a id="10057" href="blog/generic-parallel-fp/index.html#10057" class="Bound">x&#39;</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="10060" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="10062" href="blog/generic-parallel-fp/index.html#10062" class="Bound">y</a> <a id="10064" class="Symbol">=</a> <a id="10066" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="10072" href="blog/generic-parallel-fp/index.html#10044" class="Bound">x</a>
     <a id="10079" class="Keyword">in</a> <a id="10082" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj‚ÇÇ</a> <a id="10087" href="blog/generic-parallel-fp/index.html#10057" class="Bound">x&#39;</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="10090" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="10092" href="blog/generic-parallel-fp/index.html#10062" class="Bound">y</a>
</pre>
<p>And then we come to the interesting cases. To scan the product of <code>F</code> and <code>G</code>, we notice that every left scan of <code>F</code> is a prefix of <code>F √ó G</code> (because <code>F</code> is on the left.) Thus, we can use <code>lscan F</code> directly in the result, and need only adjust the results of <code>lscan G</code> with the accumulated value from <code>F</code>:</p>
<pre class="Agda">  <a id="l*"></a><a id="10410" href="blog/generic-parallel-fp/index.html#10410" class="Function">l*</a> <a id="10413" class="Symbol">:</a> <a id="10415" class="Symbol">‚¶É</a> <a id="10417" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="10423" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="10425" class="Symbol">‚¶Ñ</a> <a id="10427" class="Symbol">‚Üí</a> <a id="10429" class="Symbol">‚¶É</a> <a id="10431" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="10437" href="blog/generic-parallel-fp/index.html#268" class="Generalizable">G</a> <a id="10439" class="Symbol">‚¶Ñ</a> <a id="10441" class="Symbol">‚Üí</a> <a id="10443" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="10449" class="Symbol">(\</a><a id="10451" href="blog/generic-parallel-fp/index.html#10451" class="Bound">a</a> <a id="10453" class="Symbol">‚Üí</a> <a id="10455" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="10457" href="blog/generic-parallel-fp/index.html#10451" class="Bound">a</a> <a id="10459" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="10461" href="blog/generic-parallel-fp/index.html#268" class="Generalizable">G</a> <a id="10463" href="blog/generic-parallel-fp/index.html#10451" class="Bound">a</a><a id="10464" class="Symbol">)</a>
  <a id="10468" href="blog/generic-parallel-fp/index.html#10410" class="Function">l*</a> <a id="10471" class="Symbol">.</a><a id="10472" href="blog/generic-parallel-fp/index.html#8580" class="Field">func</a> <a id="10477" class="Symbol">.</a><a id="10478" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="10483" href="blog/generic-parallel-fp/index.html#10483" class="Bound">f</a> <a id="10485" href="blog/generic-parallel-fp/index.html#10485" class="Bound">x</a> <a id="10487" class="Symbol">.</a><a data-type="Œ£ A B ‚Üí A" id="10488" href="Agda.Builtin.Sigma.html#252" class="Field">proj‚ÇÅ</a> <a id="10494" class="Symbol">=</a> <a id="10496" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="10501" href="blog/generic-parallel-fp/index.html#10483" class="Bound">f</a> <a id="10503" class="Symbol">(</a><a id="10504" href="blog/generic-parallel-fp/index.html#10485" class="Bound">x</a> <a id="10506" class="Symbol">.</a><a data-type="Œ£ A B ‚Üí A" id="10507" href="Agda.Builtin.Sigma.html#252" class="Field">proj‚ÇÅ</a><a id="10512" class="Symbol">)</a>
  <a id="10516" href="blog/generic-parallel-fp/index.html#10410" class="Function">l*</a> <a id="10519" class="Symbol">.</a><a id="10520" href="blog/generic-parallel-fp/index.html#8580" class="Field">func</a> <a id="10525" class="Symbol">.</a><a id="10526" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="10531" href="blog/generic-parallel-fp/index.html#10531" class="Bound">f</a> <a id="10533" href="blog/generic-parallel-fp/index.html#10533" class="Bound">x</a> <a id="10535" class="Symbol">.</a><a data-type="(r : Œ£ A B) ‚Üí B (fst r)" id="10536" href="Agda.Builtin.Sigma.html#264" class="Field">proj‚ÇÇ</a> <a id="10542" class="Symbol">=</a> <a id="10544" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="10549" href="blog/generic-parallel-fp/index.html#10531" class="Bound">f</a> <a id="10551" class="Symbol">(</a><a id="10552" href="blog/generic-parallel-fp/index.html#10533" class="Bound">x</a> <a id="10554" class="Symbol">.</a><a data-type="(r : Œ£ A B) ‚Üí B (fst r)" id="10555" href="Agda.Builtin.Sigma.html#264" class="Field">proj‚ÇÇ</a><a id="10560" class="Symbol">)</a>
  <a id="10564" href="blog/generic-parallel-fp/index.html#10410" class="Function">l*</a> <a id="10567" class="Symbol">.</a><a id="10568" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="10574" class="Symbol">(</a><a id="10575" href="blog/generic-parallel-fp/index.html#10575" class="Bound">f-in</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="10580" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="10582" href="blog/generic-parallel-fp/index.html#10582" class="Bound">g-in</a><a id="10586" class="Symbol">)</a> <a id="10588" class="Symbol">=</a>
    <a id="10594" class="Keyword">let</a> <a id="10598" href="blog/generic-parallel-fp/index.html#10598" class="Bound">f-out</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="10604" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="10606" href="blog/generic-parallel-fp/index.html#10606" class="Bound">f-acc</a> <a id="10612" class="Symbol">=</a> <a id="10614" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="10620" href="blog/generic-parallel-fp/index.html#10575" class="Bound">f-in</a>
        <a id="10633" href="blog/generic-parallel-fp/index.html#10633" class="Bound">g-out</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="10639" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="10641" href="blog/generic-parallel-fp/index.html#10641" class="Bound">g-acc</a> <a id="10647" class="Symbol">=</a> <a id="10649" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="10655" href="blog/generic-parallel-fp/index.html#10582" class="Bound">g-in</a>
     <a id="10665" class="Keyword">in</a> <a id="10668" class="Symbol">(</a><a id="10669" href="blog/generic-parallel-fp/index.html#10598" class="Bound">f-out</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="10675" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="10677" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="10682" class="Symbol">(</a><a id="10683" href="blog/generic-parallel-fp/index.html#10606" class="Bound">f-acc</a> <a id="10689" href="blog/generic-parallel-fp/index.html#376" class="Field Operator">&lt;&gt;_</a><a id="10692" class="Symbol">)</a> <a id="10694" href="blog/generic-parallel-fp/index.html#10633" class="Bound">g-out</a><a id="10699" class="Symbol">)</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="10701" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="10703" href="blog/generic-parallel-fp/index.html#10606" class="Bound">f-acc</a> <a id="10709" href="blog/generic-parallel-fp/index.html#376" class="Field Operator">&lt;&gt;</a> <a id="10712" href="blog/generic-parallel-fp/index.html#10641" class="Bound">g-acc</a>
</pre>
<p><span class="Agda"><a href="blog/generic-parallel-fp/index.html#10410" class="Function">l*</a></span> is what makes the whole algorithm parallel. It says we can scan <code>F</code> and <code>G</code> in parallel, and need only a single join node at the end to stick <code>f-acc &lt;&gt;_</code> on at the end. This parallelism is visible in the <code>let</code> expression, where there is no data dependency between the two bindings.</p>
<p>Our final generic instance of <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a></span> is over composition. Howevef, we can‚Äôt implement <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a></span> for every composition of functors, since we require the ability to ‚Äúzip‚Äù two functors together. The paper is pretty cagey about exactly what <code>Zip</code> is, but after some sleuthing, I think it‚Äôs this:</p>
<pre class="Agda"><a id="11328" class="Keyword">record</a> <a id="Zip"></a><a id="11335" href="blog/generic-parallel-fp/index.html#11335" class="Record">Zip</a> <a id="11339" class="Symbol">(</a><a id="11340" href="blog/generic-parallel-fp/index.html#11340" class="Bound">F</a> <a id="11342" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="11344" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="11348" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="11350" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="11353" class="Symbol">)</a> <a id="11355" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="11357" href="Agda.Primitive.html#326" class="Primitive">Set‚ÇÅ</a> <a id="11362" class="Keyword">where</a>
  <a id="11370" class="Keyword">field</a>
    <a id="11380" class="Keyword">overlap</a> <a id="11388" class="Symbol">‚¶É</a> <a id="Zip.func"></a><a id="11390" href="blog/generic-parallel-fp/index.html#11390" class="Field">func</a> <a id="11395" class="Symbol">‚¶Ñ</a> <a id="11397" class="Symbol">:</a> <a id="11399" href="blog/generic-parallel-fp/index.html#8411" class="Record">Functor</a> <a id="11407" href="blog/generic-parallel-fp/index.html#11340" class="Bound">F</a>
    <a id="Zip.zip"></a><a id="11413" href="blog/generic-parallel-fp/index.html#11413" class="Field">zip</a> <a id="11417" class="Symbol">:</a> <a id="11419" class="Symbol">{</a><a id="11420" href="blog/generic-parallel-fp/index.html#11420" class="Bound">A</a> <a id="11422" href="blog/generic-parallel-fp/index.html#11422" class="Bound">B</a> <a id="11424" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="11426" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="11429" class="Symbol">}</a> <a id="11431" class="Symbol">‚Üí</a> <a id="11433" href="blog/generic-parallel-fp/index.html#11340" class="Bound">F</a> <a id="11435" href="blog/generic-parallel-fp/index.html#11420" class="Bound">A</a> <a id="11437" class="Symbol">‚Üí</a> <a id="11439" href="blog/generic-parallel-fp/index.html#11340" class="Bound">F</a> <a id="11441" href="blog/generic-parallel-fp/index.html#11422" class="Bound">B</a> <a id="11443" class="Symbol">‚Üí</a> <a id="11445" href="blog/generic-parallel-fp/index.html#11340" class="Bound">F</a> <a id="11447" class="Symbol">(</a><a id="11448" href="blog/generic-parallel-fp/index.html#11420" class="Bound">A</a> <a id="11450" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="11452" href="blog/generic-parallel-fp/index.html#11422" class="Bound">B</a><a id="11453" class="Symbol">)</a>
<a id="11455" class="Keyword">open</a> <a id="11460" href="blog/generic-parallel-fp/index.html#11335" class="Module">Zip</a> <a id="11464" class="Symbol">‚¶É</a> <a id="11466" class="Symbol">...</a> <a id="11470" class="Symbol">‚¶Ñ</a>
</pre>
<p>That looks a lot like being an applicative, but it‚Äôs missing <code>pure</code> and has some weird idempotent laws that are not particularly relevant today. We can define some helper functions as well:</p>
<pre class="Agda"><a id="zipWith"></a><a id="11674" href="blog/generic-parallel-fp/index.html#11674" class="Function">zipWith</a> <a id="11682" class="Symbol">:</a> <a id="11684" class="Symbol">‚àÄ</a> <a id="11686" class="Symbol">{</a><a id="11687" href="blog/generic-parallel-fp/index.html#11687" class="Bound">A</a> <a id="11689" href="blog/generic-parallel-fp/index.html#11689" class="Bound">B</a> <a id="11691" href="blog/generic-parallel-fp/index.html#11691" class="Bound">C</a><a id="11692" class="Symbol">}</a> <a id="11694" class="Symbol">‚Üí</a> <a id="11696" class="Symbol">‚¶É</a> <a id="11698" href="blog/generic-parallel-fp/index.html#11335" class="Record">Zip</a> <a id="11702" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="11704" class="Symbol">‚¶Ñ</a> <a id="11706" class="Symbol">‚Üí</a> <a id="11708" class="Symbol">(</a><a id="11709" href="blog/generic-parallel-fp/index.html#11687" class="Bound">A</a> <a id="11711" class="Symbol">‚Üí</a> <a id="11713" href="blog/generic-parallel-fp/index.html#11689" class="Bound">B</a> <a id="11715" class="Symbol">‚Üí</a> <a id="11717" href="blog/generic-parallel-fp/index.html#11691" class="Bound">C</a><a id="11718" class="Symbol">)</a> <a id="11720" class="Symbol">‚Üí</a> <a id="11722" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="11724" href="blog/generic-parallel-fp/index.html#11687" class="Bound">A</a> <a id="11726" class="Symbol">‚Üí</a> <a id="11728" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="11730" href="blog/generic-parallel-fp/index.html#11689" class="Bound">B</a> <a id="11732" class="Symbol">‚Üí</a> <a id="11734" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="11736" href="blog/generic-parallel-fp/index.html#11691" class="Bound">C</a>
<a id="11738" href="blog/generic-parallel-fp/index.html#11674" class="Function">zipWith</a> <a id="11746" href="blog/generic-parallel-fp/index.html#11746" class="Bound">f</a> <a id="11748" href="blog/generic-parallel-fp/index.html#11748" class="Bound">fa</a> <a id="11751" href="blog/generic-parallel-fp/index.html#11751" class="Bound">fb</a> <a id="11754" class="Symbol">=</a> <a id="11756" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="11761" class="Symbol">(</a><a id="11762" href="Data.Product.html#3422" class="Function">uncurry</a> <a id="11770" href="blog/generic-parallel-fp/index.html#11746" class="Bound">f</a><a id="11771" class="Symbol">)</a> <a id="11773" class="Symbol">(</a><a id="11774" href="blog/generic-parallel-fp/index.html#11413" class="Field">zip</a> <a id="11778" href="blog/generic-parallel-fp/index.html#11748" class="Bound">fa</a> <a id="11781" href="blog/generic-parallel-fp/index.html#11751" class="Bound">fb</a><a id="11783" class="Symbol">)</a>

<a id="unzip"></a><a id="11786" href="blog/generic-parallel-fp/index.html#11786" class="Function">unzip</a> <a id="11792" class="Symbol">:</a> <a id="11794" class="Symbol">‚¶É</a> <a id="11796" href="blog/generic-parallel-fp/index.html#8411" class="Record">Functor</a> <a id="11804" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="11806" class="Symbol">‚¶Ñ</a> <a id="11808" class="Symbol">‚Üí</a> <a id="11810" class="Symbol">{</a><a id="11811" href="blog/generic-parallel-fp/index.html#11811" class="Bound">A</a> <a id="11813" href="blog/generic-parallel-fp/index.html#11813" class="Bound">B</a> <a id="11815" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="11817" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="11820" class="Symbol">}</a> <a id="11822" class="Symbol">‚Üí</a> <a id="11824" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="11826" class="Symbol">(</a><a id="11827" href="blog/generic-parallel-fp/index.html#11811" class="Bound">A</a> <a id="11829" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="11831" href="blog/generic-parallel-fp/index.html#11813" class="Bound">B</a><a id="11832" class="Symbol">)</a> <a id="11834" class="Symbol">‚Üí</a> <a id="11836" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="11838" href="blog/generic-parallel-fp/index.html#11811" class="Bound">A</a> <a id="11840" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="11842" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="11844" href="blog/generic-parallel-fp/index.html#11813" class="Bound">B</a>
<a id="11846" href="blog/generic-parallel-fp/index.html#11786" class="Function">unzip</a> <a id="11852" href="blog/generic-parallel-fp/index.html#11852" class="Bound">x</a> <a id="11854" class="Symbol">=</a> <a id="11856" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a data-type="Œ£ A B ‚Üí A" id="11861" href="Agda.Builtin.Sigma.html#252" class="Field">proj‚ÇÅ</a> <a id="11867" href="blog/generic-parallel-fp/index.html#11852" class="Bound">x</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="11869" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="11871" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a data-type="(r : Œ£ A B) ‚Üí B (fst r)" id="11876" href="Agda.Builtin.Sigma.html#264" class="Field">proj‚ÇÇ</a> <a id="11882" href="blog/generic-parallel-fp/index.html#11852" class="Bound">x</a>
</pre>
<p>Armed with all of this, we can give an implementation of <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a></span> over functor composition. The idea is to <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a></span> each inner functor, which gives us an <code>G (F A √ó A)</code>. We can then <span class="Agda"><a href="blog/generic-parallel-fp/index.html#11786" class="Function">unzip</a></span> that, whose second projection is then the totals of each inner scan. If we scan these <em>totals</em>, we‚Äôll get a running scan for the whole thing; and all that‚Äôs left is to adjust each.</p>
<!--
<pre class="Agda"><a id="12288" class="Keyword">instance</a>
  <a id="composeFunc"></a><a id="12299" href="blog.generic-parallel-fp.html#12299" class="Function">composeFunc</a> <a id="12311" class="Symbol">:</a> <a id="12313" class="Symbol">‚¶É</a> <a id="12315" href="blog.generic-parallel-fp.html#8411" class="Record">Functor</a> <a id="12323" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="12325" class="Symbol">‚¶Ñ</a> <a id="12327" class="Symbol">‚Üí</a> <a id="12329" class="Symbol">‚¶É</a> <a id="12331" href="blog.generic-parallel-fp.html#8411" class="Record">Functor</a> <a id="12339" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a> <a id="12341" class="Symbol">‚¶Ñ</a> <a id="12343" class="Symbol">‚Üí</a> <a id="12345" href="blog.generic-parallel-fp.html#8411" class="Record">Functor</a> <a id="12353" class="Symbol">(</a><a id="12354" href="blog.generic-parallel-fp.html#6068" class="Record">Compose</a> <a id="12362" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="12364" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a><a id="12365" class="Symbol">)</a>
  <a id="12369" href="blog.generic-parallel-fp.html#12299" class="Function">composeFunc</a> <a id="12381" class="Symbol">.</a><a id="12382" href="blog.generic-parallel-fp.html#8472" class="Field">fmap</a> <a id="12387" href="blog.generic-parallel-fp.html#12387" class="Bound">f</a> <a id="12389" class="Symbol">(</a><a id="12390" href="blog.generic-parallel-fp.html#6130" class="InductiveConstructor">compose</a> <a id="12398" href="blog.generic-parallel-fp.html#12398" class="Bound">x</a><a id="12399" class="Symbol">)</a> <a id="12401" class="Symbol">.</a><a id="12402" href="blog.generic-parallel-fp.html#6150" class="Field">composed</a> <a id="12411" class="Symbol">=</a> <a id="12413" href="blog.generic-parallel-fp.html#8472" class="Field">fmap</a> <a id="12418" class="Symbol">(</a><a id="12419" href="blog.generic-parallel-fp.html#8472" class="Field">fmap</a> <a id="12424" href="blog.generic-parallel-fp.html#12387" class="Bound">f</a><a id="12425" class="Symbol">)</a> <a id="12427" href="blog.generic-parallel-fp.html#12398" class="Bound">x</a>
</pre>-->
<pre class="Agda"><a id="12442" class="Keyword">instance</a>
  <a id="l‚àò"></a><a id="12453" href="blog/generic-parallel-fp/index.html#12453" class="Function">l‚àò</a> <a id="12456" class="Symbol">:</a> <a id="12458" class="Symbol">‚¶É</a> <a id="12460" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="12466" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a> <a id="12468" class="Symbol">‚¶Ñ</a> <a id="12470" class="Symbol">‚Üí</a> <a id="12472" class="Symbol">‚¶É</a> <a id="12474" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="12480" href="blog/generic-parallel-fp/index.html#268" class="Generalizable">G</a> <a id="12482" class="Symbol">‚¶Ñ</a> <a id="12484" class="Symbol">‚Üí</a> <a id="12486" class="Symbol">‚¶É</a> <a id="12488" href="blog/generic-parallel-fp/index.html#11335" class="Record">Zip</a> <a id="12492" href="blog/generic-parallel-fp/index.html#268" class="Generalizable">G</a> <a id="12494" class="Symbol">‚¶Ñ</a> <a id="12496" class="Symbol">‚Üí</a> <a id="12498" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="12504" class="Symbol">(</a><a id="12505" href="blog/generic-parallel-fp/index.html#6068" class="Record">Compose</a> <a id="12513" href="blog/generic-parallel-fp/index.html#268" class="Generalizable">G</a> <a id="12515" href="blog/generic-parallel-fp/index.html#266" class="Generalizable">F</a><a id="12516" class="Symbol">)</a>
  <a id="12520" href="blog/generic-parallel-fp/index.html#12453" class="Function">l‚àò</a> <a id="12523" class="Symbol">.</a><a id="12524" href="blog/generic-parallel-fp/index.html#8580" class="Field">func</a> <a id="12529" class="Symbol">.</a><a id="12530" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="12535" href="blog/generic-parallel-fp/index.html#12535" class="Bound">f</a> <a id="12537" class="Symbol">=</a> <a id="12539" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="12544" href="blog/generic-parallel-fp/index.html#12535" class="Bound">f</a>
  <a id="12548" href="blog/generic-parallel-fp/index.html#12453" class="Function">l‚àò</a> <a id="12551" class="Symbol">.</a><a id="12552" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="12558" class="Symbol">(</a><a id="12559" href="blog/generic-parallel-fp/index.html#6130" class="InductiveConstructor">compose</a> <a id="12567" href="blog/generic-parallel-fp/index.html#12567" class="Bound">gfa</a><a id="12570" class="Symbol">)</a> <a id="12572" class="Symbol">=</a>
    <a id="12578" class="Keyword">let</a> <a id="12582" href="blog/generic-parallel-fp/index.html#12582" class="Bound">gfa&#39;</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="12587" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="12589" href="blog/generic-parallel-fp/index.html#12589" class="Bound">tots</a> <a id="12594" class="Symbol">=</a> <a id="12596" href="blog/generic-parallel-fp/index.html#11786" class="Function">unzip</a> <a id="12602" class="Symbol">(</a><a id="12603" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="12608" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="12614" href="blog/generic-parallel-fp/index.html#12567" class="Bound">gfa</a><a id="12617" class="Symbol">)</a>
        <a id="12627" href="blog/generic-parallel-fp/index.html#12627" class="Bound">tots&#39;</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="12633" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="12635" href="blog/generic-parallel-fp/index.html#12635" class="Bound">tot</a> <a id="12639" class="Symbol">=</a> <a id="12641" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="12647" href="blog/generic-parallel-fp/index.html#12589" class="Bound">tots</a>
        <a id="12660" href="blog/generic-parallel-fp/index.html#12660" class="Bound">adjustl</a> <a id="12668" href="blog/generic-parallel-fp/index.html#12668" class="Bound">t</a> <a id="12670" class="Symbol">=</a> <a id="12672" href="blog/generic-parallel-fp/index.html#8472" class="Field">fmap</a> <a id="12677" class="Symbol">(</a><a id="12678" href="blog/generic-parallel-fp/index.html#12668" class="Bound">t</a> <a id="12680" href="blog/generic-parallel-fp/index.html#376" class="Field Operator">&lt;&gt;_</a><a id="12683" class="Symbol">)</a>
    <a id="12689" class="Keyword">in</a> <a id="12692" href="blog/generic-parallel-fp/index.html#6130" class="InductiveConstructor">compose</a> <a id="12700" class="Symbol">(</a><a id="12701" href="blog/generic-parallel-fp/index.html#11674" class="Function">zipWith</a> <a id="12709" href="blog/generic-parallel-fp/index.html#12660" class="Bound">adjustl</a> <a id="12717" href="blog/generic-parallel-fp/index.html#12627" class="Bound">tots&#39;</a> <a id="12723" href="blog/generic-parallel-fp/index.html#12582" class="Bound">gfa&#39;</a><a id="12727" class="Symbol">)</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="12729" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="12731" href="blog/generic-parallel-fp/index.html#12635" class="Bound">tot</a>
</pre>
<!--
<pre class="Agda"><a id="12749" class="Keyword">instance</a>
  <a id="zI"></a><a id="12760" href="blog.generic-parallel-fp.html#12760" class="Function">zI</a> <a id="12763" class="Symbol">:</a> <a id="12765" href="blog.generic-parallel-fp.html#11335" class="Record">Zip</a> <a id="12769" class="Symbol">(\</a><a id="12771" href="blog.generic-parallel-fp.html#12771" class="Bound">a</a> <a id="12773" class="Symbol">‚Üí</a> <a id="12775" href="blog.generic-parallel-fp.html#12771" class="Bound">a</a><a id="12776" class="Symbol">)</a>
  <a id="12780" href="blog.generic-parallel-fp.html#12760" class="Function">zI</a> <a id="12783" class="Symbol">.</a><a id="12784" href="blog.generic-parallel-fp.html#11390" class="Field">func</a> <a id="12789" class="Symbol">.</a><a id="12790" href="blog.generic-parallel-fp.html#8472" class="Field">fmap</a> <a id="12795" href="blog.generic-parallel-fp.html#12795" class="Bound">f</a> <a id="12797" href="blog.generic-parallel-fp.html#12797" class="Bound">a</a> <a id="12799" class="Symbol">=</a> <a id="12801" href="blog.generic-parallel-fp.html#12795" class="Bound">f</a> <a id="12803" href="blog.generic-parallel-fp.html#12797" class="Bound">a</a>
  <a id="12807" href="blog.generic-parallel-fp.html#12760" class="Function">zI</a> <a id="12810" class="Symbol">.</a><a id="12811" href="blog.generic-parallel-fp.html#11413" class="Field">zip</a> <a id="12815" href="blog.generic-parallel-fp.html#12815" class="Bound">a</a> <a id="12817" href="blog.generic-parallel-fp.html#12817" class="Bound">b</a> <a id="12819" class="Symbol">=</a> <a id="12821" href="blog.generic-parallel-fp.html#12815" class="Bound">a</a> <a id="12823" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="12825" href="blog.generic-parallel-fp.html#12817" class="Bound">b</a>

  <a id="z*"></a><a id="12830" href="blog.generic-parallel-fp.html#12830" class="Function">z*</a> <a id="12833" class="Symbol">:</a> <a id="12835" class="Symbol">‚¶É</a> <a id="12837" href="blog.generic-parallel-fp.html#11335" class="Record">Zip</a> <a id="12841" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="12843" class="Symbol">‚¶Ñ</a> <a id="12845" class="Symbol">‚Üí</a> <a id="12847" class="Symbol">‚¶É</a> <a id="12849" href="blog.generic-parallel-fp.html#11335" class="Record">Zip</a> <a id="12853" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a> <a id="12855" class="Symbol">‚¶Ñ</a> <a id="12857" class="Symbol">‚Üí</a> <a id="12859" href="blog.generic-parallel-fp.html#11335" class="Record">Zip</a> <a id="12863" class="Symbol">(\</a><a id="12865" href="blog.generic-parallel-fp.html#12865" class="Bound">a</a> <a id="12867" class="Symbol">‚Üí</a> <a id="12869" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="12871" href="blog.generic-parallel-fp.html#12865" class="Bound">a</a> <a id="12873" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="12875" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a> <a id="12877" href="blog.generic-parallel-fp.html#12865" class="Bound">a</a><a id="12878" class="Symbol">)</a>
  <a id="12882" href="blog.generic-parallel-fp.html#12830" class="Function">z*</a> <a id="12885" class="Symbol">.</a><a id="12886" href="blog.generic-parallel-fp.html#11390" class="Field">func</a> <a id="12891" class="Symbol">.</a><a id="12892" href="blog.generic-parallel-fp.html#8472" class="Field">fmap</a> <a id="12897" href="blog.generic-parallel-fp.html#12897" class="Bound">f</a> <a id="12899" class="Symbol">(</a><a id="12900" href="blog.generic-parallel-fp.html#12900" class="Bound">x</a> <a id="12902" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="12904" href="blog.generic-parallel-fp.html#12904" class="Bound">y</a><a id="12905" class="Symbol">)</a> <a id="12907" class="Symbol">=</a> <a id="12909" href="blog.generic-parallel-fp.html#8472" class="Field">fmap</a> <a id="12914" href="blog.generic-parallel-fp.html#12897" class="Bound">f</a> <a id="12916" href="blog.generic-parallel-fp.html#12900" class="Bound">x</a> <a id="12918" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="12920" href="blog.generic-parallel-fp.html#8472" class="Field">fmap</a> <a id="12925" href="blog.generic-parallel-fp.html#12897" class="Bound">f</a> <a id="12927" href="blog.generic-parallel-fp.html#12904" class="Bound">y</a>
  <a id="12931" href="blog.generic-parallel-fp.html#12830" class="Function">z*</a> <a id="12934" class="Symbol">.</a><a id="12935" href="blog.generic-parallel-fp.html#11413" class="Field">zip</a> <a id="12939" class="Symbol">(</a><a id="12940" href="blog.generic-parallel-fp.html#12940" class="Bound">fa</a> <a id="12943" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="12945" href="blog.generic-parallel-fp.html#12945" class="Bound">ga</a><a id="12947" class="Symbol">)</a> <a id="12949" class="Symbol">(</a><a id="12950" href="blog.generic-parallel-fp.html#12950" class="Bound">fb</a> <a id="12953" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="12955" href="blog.generic-parallel-fp.html#12955" class="Bound">gb</a><a id="12957" class="Symbol">)</a> <a id="12959" class="Symbol">=</a> <a id="12961" href="blog.generic-parallel-fp.html#11413" class="Field">zip</a> <a id="12965" href="blog.generic-parallel-fp.html#12940" class="Bound">fa</a> <a id="12968" href="blog.generic-parallel-fp.html#12950" class="Bound">fb</a> <a id="12971" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="12973" href="blog.generic-parallel-fp.html#11413" class="Field">zip</a> <a id="12977" href="blog.generic-parallel-fp.html#12945" class="Bound">ga</a> <a id="12980" href="blog.generic-parallel-fp.html#12955" class="Bound">gb</a>

  <a id="z‚àò"></a><a id="12986" href="blog.generic-parallel-fp.html#12986" class="Function">z‚àò</a> <a id="12989" class="Symbol">:</a> <a id="12991" class="Symbol">‚¶É</a> <a id="12993" href="blog.generic-parallel-fp.html#11335" class="Record">Zip</a> <a id="12997" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="12999" class="Symbol">‚¶Ñ</a> <a id="13001" class="Symbol">‚Üí</a> <a id="13003" class="Symbol">‚¶É</a> <a id="13005" href="blog.generic-parallel-fp.html#11335" class="Record">Zip</a> <a id="13009" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a> <a id="13011" class="Symbol">‚¶Ñ</a> <a id="13013" class="Symbol">‚Üí</a> <a id="13015" href="blog.generic-parallel-fp.html#11335" class="Record">Zip</a> <a id="13019" class="Symbol">(</a><a id="13020" href="blog.generic-parallel-fp.html#6068" class="Record">Compose</a> <a id="13028" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="13030" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a><a id="13031" class="Symbol">)</a>
  <a id="13035" href="blog.generic-parallel-fp.html#12986" class="Function">z‚àò</a> <a id="13038" class="Symbol">.</a><a id="13039" href="blog.generic-parallel-fp.html#11390" class="Field">func</a> <a id="13044" class="Symbol">.</a><a id="13045" href="blog.generic-parallel-fp.html#8472" class="Field">fmap</a> <a id="13050" href="blog.generic-parallel-fp.html#13050" class="Bound">f</a> <a id="13052" class="Symbol">=</a> <a id="13054" href="blog.generic-parallel-fp.html#8472" class="Field">fmap</a> <a id="13059" href="blog.generic-parallel-fp.html#13050" class="Bound">f</a>
  <a id="13063" href="blog.generic-parallel-fp.html#12986" class="Function">z‚àò</a> <a id="13066" class="Symbol">.</a><a id="13067" href="blog.generic-parallel-fp.html#11413" class="Field">zip</a> <a id="13071" class="Symbol">(</a><a id="13072" href="blog.generic-parallel-fp.html#6130" class="InductiveConstructor">compose</a> <a id="13080" href="blog.generic-parallel-fp.html#13080" class="Bound">fa</a><a id="13082" class="Symbol">)</a> <a id="13084" class="Symbol">(</a><a id="13085" href="blog.generic-parallel-fp.html#6130" class="InductiveConstructor">compose</a> <a id="13093" href="blog.generic-parallel-fp.html#13093" class="Bound">ga</a><a id="13095" class="Symbol">)</a> <a id="13097" class="Symbol">=</a>
    <a id="13103" href="blog.generic-parallel-fp.html#6130" class="InductiveConstructor">compose</a> <a id="13111" class="Symbol">(</a><a id="13112" href="blog.generic-parallel-fp.html#8472" class="Field">fmap</a> <a id="13117" class="Symbol">(</a><a id="13118" href="Data.Product.html#3422" class="Function">uncurry</a> <a id="13126" href="blog.generic-parallel-fp.html#11413" class="Field">zip</a><a id="13129" class="Symbol">)</a> <a id="13131" class="Symbol">(</a><a id="13132" href="blog.generic-parallel-fp.html#11413" class="Field">zip</a> <a id="13136" href="blog.generic-parallel-fp.html#13080" class="Bound">fa</a> <a id="13139" href="blog.generic-parallel-fp.html#13093" class="Bound">ga</a><a id="13141" class="Symbol">))</a>
</pre>-->
<p>And we‚Äôre done! We now have an algorithm defined piece-wise over the fundamental ADT building blocks. Let‚Äôs put it to use.</p>
<h2 id="dividing-and-conquering"><a href="#dividing-and-conquering" class="header-link">Dividing and Conquering<span class="header-link-emoji">üîó</span></a></h2>
<p>Let‚Äôs pretend that <span class="Agda"><a href="Data.Vec.Base.html#998" class="Datatype">Vec</a></span>s are random access arrays. We‚Äôd like to be able to build array algorithms out of our algorithmic building blocks. To that end, we can make a typeclass corresponding to types that are isomorphic to arrays:</p>
<pre class="Agda"><a id="13548" class="Keyword">open</a> <a id="13553" class="Keyword">import</a> <a id="13560" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="13569" class="Keyword">open</a> <a id="13574" class="Keyword">import</a> <a id="13581" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="13590" class="Keyword">hiding</a> <a id="13597" class="Symbol">(</a><a id="13598" href="Data.Vec.Base.html#3897" class="Function">zip</a><a id="13601" class="Symbol">;</a> <a id="13603" href="Data.Vec.Base.html#3964" class="Function">unzip</a><a id="13608" class="Symbol">;</a> <a id="13610" href="Data.Vec.Base.html#3418" class="Function">zipWith</a><a id="13617" class="Symbol">)</a>

<a id="13620" class="Keyword">record</a> <a id="ArrayIso"></a><a id="13627" href="blog/generic-parallel-fp/index.html#13627" class="Record">ArrayIso</a> <a id="13636" class="Symbol">(</a><a id="13637" href="blog/generic-parallel-fp/index.html#13637" class="Bound">F</a> <a id="13639" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="13641" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="13645" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="13647" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="13650" class="Symbol">)</a> <a id="13652" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="13654" href="Agda.Primitive.html#326" class="Primitive">Set‚ÇÅ</a> <a id="13659" class="Keyword">where</a>
  <a id="13667" class="Keyword">field</a>
    <a id="ArrayIso.Size"></a><a id="13677" href="blog/generic-parallel-fp/index.html#13677" class="Field">Size</a> <a id="13682" class="Symbol">:</a> <a data-type="Set" id="13684" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a>
    <a id="ArrayIso.deserialize"></a><a id="13690" href="blog/generic-parallel-fp/index.html#13690" class="Field">deserialize</a> <a id="13702" class="Symbol">:</a> <a id="13704" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="13708" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="13710" href="blog/generic-parallel-fp/index.html#13677" class="Field">Size</a> <a id="13715" class="Symbol">‚Üí</a> <a id="13717" href="blog/generic-parallel-fp/index.html#13637" class="Bound">F</a> <a id="13719" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
    <a id="ArrayIso.serialize"></a><a id="13725" href="blog/generic-parallel-fp/index.html#13725" class="Field">serialize</a> <a id="13735" class="Symbol">:</a> <a id="13737" href="blog/generic-parallel-fp/index.html#13637" class="Bound">F</a> <a id="13739" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="13741" class="Symbol">‚Üí</a> <a id="13743" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="13747" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="13749" href="blog/generic-parallel-fp/index.html#13677" class="Field">Size</a>
    <a id="13758" class="Comment">-- also prove it&#39;s an iso</a>

<a id="13785" class="Keyword">open</a> <a id="13790" href="blog/generic-parallel-fp/index.html#13627" class="Module">ArrayIso</a> <a id="13799" class="Symbol">‚¶É</a> <a id="13801" class="Symbol">...</a> <a id="13805" class="Symbol">‚¶Ñ</a>
</pre>
<!--
<pre class="Agda"><a id="13821" class="Keyword">instance</a>
  <a id="dU"></a><a id="13832" href="blog.generic-parallel-fp.html#13832" class="Function">dU</a> <a id="13835" class="Symbol">:</a> <a id="13837" href="blog.generic-parallel-fp.html#13627" class="Record">ArrayIso</a> <a id="13846" class="Symbol">(\</a><a id="13848" href="blog.generic-parallel-fp.html#13848" class="Bound">a</a> <a id="13850" class="Symbol">‚Üí</a> <a id="13852" href="Agda.Builtin.Unit.html#164" class="Record">‚ä§</a><a id="13853" class="Symbol">)</a>
  <a id="13857" href="blog.generic-parallel-fp.html#13832" class="Function">dU</a> <a id="13860" class="Symbol">.</a><a id="13861" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="13866" class="Symbol">=</a> <a id="13868" class="Number">0</a>
  <a id="13872" href="blog.generic-parallel-fp.html#13832" class="Function">dU</a> <a id="13875" class="Symbol">.</a><a id="13876" href="blog.generic-parallel-fp.html#13690" class="Field">deserialize</a> <a id="13888" class="Symbol">_</a> <a id="13890" class="Symbol">=</a> <a id="13892" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>
  <a id="13897" href="blog.generic-parallel-fp.html#13832" class="Function">dU</a> <a id="13900" class="Symbol">.</a><a id="13901" href="blog.generic-parallel-fp.html#13725" class="Field">serialize</a> <a id="13911" class="Symbol">_</a> <a id="13913" class="Symbol">=</a> <a id="13915" href="Data.Vec.Base.html#1034" class="InductiveConstructor">[]</a>

  <a id="d*"></a><a id="13921" href="blog.generic-parallel-fp.html#13921" class="Function">d*</a> <a id="13924" class="Symbol">:</a> <a id="13926" class="Symbol">‚¶É</a> <a id="13928" href="blog.generic-parallel-fp.html#13627" class="Record">ArrayIso</a> <a id="13937" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="13939" class="Symbol">‚¶Ñ</a> <a id="13941" class="Symbol">‚Üí</a> <a id="13943" class="Symbol">‚¶É</a> <a id="13945" href="blog.generic-parallel-fp.html#13627" class="Record">ArrayIso</a> <a id="13954" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a> <a id="13956" class="Symbol">‚¶Ñ</a> <a id="13958" class="Symbol">‚Üí</a> <a id="13960" href="blog.generic-parallel-fp.html#13627" class="Record">ArrayIso</a> <a id="13969" class="Symbol">(\</a><a id="13971" href="blog.generic-parallel-fp.html#13971" class="Bound">a</a> <a id="13973" class="Symbol">‚Üí</a> <a id="13975" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="13977" href="blog.generic-parallel-fp.html#13971" class="Bound">a</a> <a id="13979" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="13981" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a> <a id="13983" href="blog.generic-parallel-fp.html#13971" class="Bound">a</a><a id="13984" class="Symbol">)</a>
  <a id="13988" href="blog.generic-parallel-fp.html#13921" class="Function">d*</a> <a id="13991" class="Symbol">‚¶É</a> <a id="13993" href="blog.generic-parallel-fp.html#13993" class="Bound">d-f</a> <a id="13997" class="Symbol">‚¶Ñ</a> <a id="13999" class="Symbol">‚¶É</a> <a id="14001" href="blog.generic-parallel-fp.html#14001" class="Bound">d-g</a> <a id="14005" class="Symbol">‚¶Ñ</a> <a id="14007" class="Symbol">.</a><a id="14008" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14013" class="Symbol">=</a> <a id="14015" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14020" class="Symbol">‚¶É</a> <a id="14022" href="blog.generic-parallel-fp.html#13993" class="Bound">d-f</a> <a id="14026" class="Symbol">‚¶Ñ</a> <a id="14028" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="14030" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14035" class="Symbol">‚¶É</a> <a id="14037" href="blog.generic-parallel-fp.html#14001" class="Bound">d-g</a> <a id="14041" class="Symbol">‚¶Ñ</a>
  <a id="14045" href="blog.generic-parallel-fp.html#13921" class="Function">d*</a> <a id="14048" class="Symbol">‚¶É</a> <a id="14050" href="blog.generic-parallel-fp.html#14050" class="Bound">d-f</a> <a id="14054" class="Symbol">‚¶Ñ</a> <a id="14056" class="Symbol">‚¶É</a> <a id="14058" href="blog.generic-parallel-fp.html#14058" class="Bound">d-g</a> <a id="14062" class="Symbol">‚¶Ñ</a> <a id="14064" class="Symbol">.</a><a id="14065" href="blog.generic-parallel-fp.html#13690" class="Field">deserialize</a> <a id="14077" href="blog.generic-parallel-fp.html#14077" class="Bound">x</a> <a id="14079" class="Symbol">=</a>
    <a id="14085" href="blog.generic-parallel-fp.html#13690" class="Field">deserialize</a> <a id="14097" class="Symbol">‚¶É</a> <a id="14099" href="blog.generic-parallel-fp.html#14050" class="Bound">d-f</a> <a id="14103" class="Symbol">‚¶Ñ</a> <a id="14105" class="Symbol">(</a><a id="14106" href="Data.Vec.Base.html#6461" class="Function">take</a> <a id="14111" class="Symbol">(</a><a id="14112" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14117" class="Symbol">‚¶É</a> <a id="14119" href="blog.generic-parallel-fp.html#14050" class="Bound">d-f</a> <a id="14123" class="Symbol">‚¶Ñ)</a> <a id="14126" class="Symbol">{</a><a id="14127" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14132" class="Symbol">‚¶É</a> <a id="14134" href="blog.generic-parallel-fp.html#14058" class="Bound">d-g</a> <a id="14138" class="Symbol">‚¶Ñ}</a> <a id="14141" href="blog.generic-parallel-fp.html#14077" class="Bound">x</a><a id="14142" class="Symbol">)</a> <a id="14144" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a>
    <a id="14150" href="blog.generic-parallel-fp.html#13690" class="Field">deserialize</a> <a id="14162" class="Symbol">‚¶É</a> <a id="14164" href="blog.generic-parallel-fp.html#14058" class="Bound">d-g</a> <a id="14168" class="Symbol">‚¶Ñ</a> <a id="14170" class="Symbol">(</a><a id="14171" href="Data.Vec.Base.html#6583" class="Function">drop</a> <a id="14176" class="Symbol">(</a><a id="14177" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14182" class="Symbol">‚¶É</a> <a id="14184" href="blog.generic-parallel-fp.html#14050" class="Bound">d-f</a> <a id="14188" class="Symbol">‚¶Ñ)</a> <a id="14191" class="Symbol">{</a><a id="14192" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14197" class="Symbol">‚¶É</a> <a id="14199" href="blog.generic-parallel-fp.html#14058" class="Bound">d-g</a> <a id="14203" class="Symbol">‚¶Ñ}</a> <a id="14206" href="blog.generic-parallel-fp.html#14077" class="Bound">x</a><a id="14207" class="Symbol">)</a>
  <a id="14211" href="blog.generic-parallel-fp.html#13921" class="Function">d*</a> <a id="14214" class="Symbol">‚¶É</a> <a id="14216" href="blog.generic-parallel-fp.html#14216" class="Bound">d-f</a> <a id="14220" class="Symbol">‚¶Ñ</a> <a id="14222" class="Symbol">‚¶É</a> <a id="14224" href="blog.generic-parallel-fp.html#14224" class="Bound">d-g</a> <a id="14228" class="Symbol">‚¶Ñ</a> <a id="14230" class="Symbol">.</a><a id="14231" href="blog.generic-parallel-fp.html#13725" class="Field">serialize</a> <a id="14241" class="Symbol">(</a><a id="14242" href="blog.generic-parallel-fp.html#14242" class="Bound">f</a> <a id="14244" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="14246" href="blog.generic-parallel-fp.html#14246" class="Bound">g</a><a id="14247" class="Symbol">)</a> <a id="14249" class="Symbol">=</a>
    <a id="14255" href="blog.generic-parallel-fp.html#13725" class="Field">serialize</a> <a id="14265" class="Symbol">‚¶É</a> <a id="14267" href="blog.generic-parallel-fp.html#14216" class="Bound">d-f</a> <a id="14271" class="Symbol">‚¶Ñ</a> <a id="14273" href="blog.generic-parallel-fp.html#14242" class="Bound">f</a> <a id="14275" href="Data.Vec.Base.html#2709" class="Function Operator">++</a> <a id="14278" href="blog.generic-parallel-fp.html#13725" class="Field">serialize</a> <a id="14288" class="Symbol">‚¶É</a> <a id="14290" href="blog.generic-parallel-fp.html#14224" class="Bound">d-g</a> <a id="14294" class="Symbol">‚¶Ñ</a> <a id="14296" href="blog.generic-parallel-fp.html#14246" class="Bound">g</a>

  <a id="dP"></a><a id="14301" href="blog.generic-parallel-fp.html#14301" class="Function">dP</a> <a id="14304" class="Symbol">:</a> <a id="14306" href="blog.generic-parallel-fp.html#13627" class="Record">ArrayIso</a> <a id="14315" class="Symbol">(\</a><a id="14317" href="blog.generic-parallel-fp.html#14317" class="Bound">a</a> <a id="14319" class="Symbol">‚Üí</a> <a id="14321" href="blog.generic-parallel-fp.html#14317" class="Bound">a</a><a id="14322" class="Symbol">)</a>
  <a id="14326" href="blog.generic-parallel-fp.html#14301" class="Function">dP</a> <a id="14329" class="Symbol">.</a><a id="14330" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14335" class="Symbol">=</a> <a id="14337" class="Number">1</a>
  <a id="14341" href="blog.generic-parallel-fp.html#14301" class="Function">dP</a> <a id="14344" class="Symbol">.</a><a id="14345" href="blog.generic-parallel-fp.html#13690" class="Field">deserialize</a> <a id="14357" class="Symbol">(</a><a id="14358" href="blog.generic-parallel-fp.html#14358" class="Bound">x</a> <a id="14360" href="Data.Vec.Base.html#1053" class="InductiveConstructor Operator">‚à∑</a> <a id="14362" href="Data.Vec.Base.html#1034" class="InductiveConstructor">[]</a><a id="14364" class="Symbol">)</a> <a id="14366" class="Symbol">=</a> <a id="14368" href="blog.generic-parallel-fp.html#14358" class="Bound">x</a>
  <a id="14372" href="blog.generic-parallel-fp.html#14301" class="Function">dP</a> <a id="14375" class="Symbol">.</a><a id="14376" href="blog.generic-parallel-fp.html#13725" class="Field">serialize</a> <a id="14386" href="blog.generic-parallel-fp.html#14386" class="Bound">x</a> <a id="14388" class="Symbol">=</a> <a id="14390" href="blog.generic-parallel-fp.html#14386" class="Bound">x</a> <a id="14392" href="Data.Vec.Base.html#1053" class="InductiveConstructor Operator">‚à∑</a> <a id="14394" href="Data.Vec.Base.html#1034" class="InductiveConstructor">[]</a>

  <a id="d‚àò"></a><a id="14400" href="blog.generic-parallel-fp.html#14400" class="Function">d‚àò</a> <a id="14403" class="Symbol">:</a> <a id="14405" class="Symbol">‚¶É</a> <a id="14407" href="blog.generic-parallel-fp.html#13627" class="Record">ArrayIso</a> <a id="14416" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="14418" class="Symbol">‚¶Ñ</a> <a id="14420" class="Symbol">‚Üí</a> <a id="14422" class="Symbol">‚¶É</a> <a id="14424" href="blog.generic-parallel-fp.html#13627" class="Record">ArrayIso</a> <a id="14433" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a> <a id="14435" class="Symbol">‚¶Ñ</a> <a id="14437" class="Symbol">‚Üí</a> <a id="14439" href="blog.generic-parallel-fp.html#13627" class="Record">ArrayIso</a> <a id="14448" class="Symbol">(</a><a id="14449" href="blog.generic-parallel-fp.html#6068" class="Record">Compose</a> <a id="14457" href="blog.generic-parallel-fp.html#266" class="Generalizable">F</a> <a id="14459" href="blog.generic-parallel-fp.html#268" class="Generalizable">G</a><a id="14460" class="Symbol">)</a>
  <a id="14464" href="blog.generic-parallel-fp.html#14400" class="Function">d‚àò</a> <a id="14467" class="Symbol">‚¶É</a> <a id="14469" href="blog.generic-parallel-fp.html#14469" class="Bound">d-f</a> <a id="14473" class="Symbol">‚¶Ñ</a> <a id="14475" class="Symbol">‚¶É</a> <a id="14477" href="blog.generic-parallel-fp.html#14477" class="Bound">d-g</a> <a id="14481" class="Symbol">‚¶Ñ</a> <a id="14483" class="Symbol">.</a><a id="14484" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14489" class="Symbol">=</a> <a id="14491" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14496" class="Symbol">‚¶É</a> <a id="14498" href="blog.generic-parallel-fp.html#14469" class="Bound">d-f</a> <a id="14502" class="Symbol">‚¶Ñ</a> <a id="14504" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="14506" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14511" class="Symbol">‚¶É</a> <a id="14513" href="blog.generic-parallel-fp.html#14477" class="Bound">d-g</a> <a id="14517" class="Symbol">‚¶Ñ</a>
  <a id="14521" href="blog.generic-parallel-fp.html#14400" class="Function">d‚àò</a> <a id="14524" class="Symbol">‚¶É</a> <a id="14526" href="blog.generic-parallel-fp.html#14526" class="Bound">d-f</a> <a id="14530" class="Symbol">‚¶Ñ</a> <a id="14532" class="Symbol">‚¶É</a> <a id="14534" href="blog.generic-parallel-fp.html#14534" class="Bound">d-g</a> <a id="14538" class="Symbol">‚¶Ñ</a> <a id="14540" class="Symbol">.</a><a id="14541" href="blog.generic-parallel-fp.html#13690" class="Field">deserialize</a> <a id="14553" href="blog.generic-parallel-fp.html#14553" class="Bound">x</a> <a id="14555" class="Symbol">=</a>
    <a id="14561" class="Keyword">let</a> <a id="14565" href="blog.generic-parallel-fp.html#14565" class="Bound">y</a> <a id="14567" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="14569" class="Symbol">_</a> <a id="14571" class="Symbol">=</a> <a id="14573" href="Data.Vec.Base.html#6705" class="Function">group</a> <a id="14579" class="Symbol">(</a><a id="14580" href="blog.generic-parallel-fp.html#13677" class="Field">Size</a> <a id="14585" class="Symbol">‚¶É</a> <a id="14587" href="blog.generic-parallel-fp.html#14526" class="Bound">d-f</a> <a id="14591" class="Symbol">‚¶Ñ)</a> <a id="14594" class="Symbol">_</a> <a id="14596" href="blog.generic-parallel-fp.html#14553" class="Bound">x</a>
     <a id="14603" class="Keyword">in</a> <a id="14606" href="blog.generic-parallel-fp.html#6130" class="InductiveConstructor">compose</a> <a id="14614" class="Symbol">(</a><a id="14615" href="blog.generic-parallel-fp.html#13690" class="Field">deserialize</a> <a id="14627" class="Symbol">(</a><a id="14628" href="Data.Vec.Base.html#2580" class="Function">Data.Vec.map</a> <a id="14641" class="Symbol">(</a><a id="14642" href="blog.generic-parallel-fp.html#13690" class="Field">deserialize</a> <a id="14654" class="Symbol">‚¶É</a> <a id="14656" href="blog.generic-parallel-fp.html#14534" class="Bound">d-g</a> <a id="14660" class="Symbol">‚¶Ñ)</a> <a id="14663" href="blog.generic-parallel-fp.html#14565" class="Bound">y</a><a id="14664" class="Symbol">))</a>
  <a id="14669" href="blog.generic-parallel-fp.html#14400" class="Function">d‚àò</a> <a id="14672" class="Symbol">‚¶É</a> <a id="14674" href="blog.generic-parallel-fp.html#14674" class="Bound">d-f</a> <a id="14678" class="Symbol">‚¶Ñ</a> <a id="14680" class="Symbol">‚¶É</a> <a id="14682" href="blog.generic-parallel-fp.html#14682" class="Bound">d-g</a> <a id="14686" class="Symbol">‚¶Ñ</a> <a id="14688" class="Symbol">.</a><a id="14689" href="blog.generic-parallel-fp.html#13725" class="Field">serialize</a> <a id="14699" class="Symbol">(</a><a id="14700" href="blog.generic-parallel-fp.html#6130" class="InductiveConstructor">compose</a> <a id="14708" href="blog.generic-parallel-fp.html#14708" class="Bound">x</a><a id="14709" class="Symbol">)</a> <a id="14711" class="Symbol">=</a>
    <a id="14717" href="Data.Vec.Base.html#2813" class="Function">concat</a> <a id="14724" class="Symbol">(</a><a id="14725" href="Data.Vec.Base.html#2580" class="Function">Data.Vec.map</a> <a id="14738" class="Symbol">(</a><a id="14739" href="blog.generic-parallel-fp.html#13725" class="Field">serialize</a> <a id="14749" class="Symbol">‚¶É</a> <a id="14751" href="blog.generic-parallel-fp.html#14682" class="Bound">d-g</a> <a id="14755" class="Symbol">‚¶Ñ)</a> <a id="14758" class="Symbol">(</a><a id="14759" href="blog.generic-parallel-fp.html#13725" class="Field">serialize</a> <a id="14769" class="Symbol">‚¶É</a> <a id="14771" href="blog.generic-parallel-fp.html#14674" class="Bound">d-f</a> <a id="14775" class="Symbol">‚¶Ñ</a> <a id="14777" href="blog.generic-parallel-fp.html#14708" class="Bound">x</a><a id="14778" class="Symbol">))</a>
</pre>-->
<p>There are instances of <span class="Agda"><a href="blog/generic-parallel-fp/index.html#13627" class="Record">ArrayIso</a></span> for the functor building blocks (though none for <span class="Agda"><a href="blog/generic-parallel-fp/index.html#5836" class="InductiveConstructor Operator">:+:</a></span> since arrays are big records.) We can now use an <span class="Agda"><a href="blog/generic-parallel-fp/index.html#13627" class="Record">ArrayIso</a></span> and an <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a></span> to get our desired parallel array algorithms:</p>
<pre class="Agda"><a id="genericScan"></a><a id="15033" href="blog/generic-parallel-fp/index.html#15033" class="Function">genericScan</a>
    <a id="15049" class="Symbol">:</a> <a id="15051" class="Symbol">‚¶É</a> <a id="15053" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="15060" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="15062" class="Symbol">‚¶Ñ</a>
    <a id="15068" class="Symbol">‚Üí</a> <a id="15070" class="Symbol">(</a><a id="15071" href="blog/generic-parallel-fp/index.html#15071" class="Bound">rep</a> <a id="15075" class="Symbol">:</a> <a id="15077" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a><a id="15080" class="Symbol">)</a>
    <a id="15086" class="Symbol">‚Üí</a> <a id="15088" class="Symbol">‚¶É</a> <a id="15090" href="blog/generic-parallel-fp/index.html#15090" class="Bound">d</a> <a id="15092" class="Symbol">:</a> <a id="15094" href="blog/generic-parallel-fp/index.html#13627" class="Record">ArrayIso</a> <a id="15103" class="Symbol">(</a><a id="15104" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="15114" href="blog/generic-parallel-fp/index.html#15071" class="Bound">rep</a><a id="15117" class="Symbol">)</a> <a id="15119" class="Symbol">‚¶Ñ</a>
    <a id="15125" class="Symbol">‚Üí</a> <a id="15127" class="Symbol">‚¶É</a> <a id="15129" href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a> <a id="15135" class="Symbol">(</a><a id="15136" href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a> <a id="15146" href="blog/generic-parallel-fp/index.html#15071" class="Bound">rep</a><a id="15149" class="Symbol">)</a> <a id="15151" class="Symbol">‚¶Ñ</a>
    <a id="15157" class="Symbol">‚Üí</a> <a id="15159" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="15163" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="15165" class="Symbol">(</a><a id="15166" href="blog/generic-parallel-fp/index.html#13677" class="Field">Size</a> <a id="15171" class="Symbol">‚¶É</a> <a id="15173" href="blog/generic-parallel-fp/index.html#15090" class="Bound">d</a> <a id="15175" class="Symbol">‚¶Ñ)</a>
    <a id="15182" class="Symbol">‚Üí</a> <a id="15184" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="15188" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="15190" class="Symbol">(</a><a id="15191" href="blog/generic-parallel-fp/index.html#13677" class="Field">Size</a> <a id="15196" class="Symbol">‚¶É</a> <a id="15198" href="blog/generic-parallel-fp/index.html#15090" class="Bound">d</a> <a id="15200" class="Symbol">‚¶Ñ)</a> <a id="15203" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="15205" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
<a id="15207" href="blog/generic-parallel-fp/index.html#15033" class="Function">genericScan</a> <a id="15219" class="Symbol">_</a> <a id="15221" class="Symbol">‚¶É</a> <a id="15223" class="Argument">d</a> <a id="15225" class="Symbol">=</a> <a id="15227" href="blog/generic-parallel-fp/index.html#15227" class="Bound">d</a> <a id="15229" class="Symbol">‚¶Ñ</a> <a id="15231" href="blog/generic-parallel-fp/index.html#15231" class="Bound">x</a> <a id="15233" class="Symbol">=</a>
  <a id="15237" class="Keyword">let</a> <a id="15241" href="blog/generic-parallel-fp/index.html#15241" class="Bound">res</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="15245" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="15247" href="blog/generic-parallel-fp/index.html#15247" class="Bound">a</a> <a id="15249" class="Symbol">=</a> <a id="15251" href="blog/generic-parallel-fp/index.html#8603" class="Field">lscan</a> <a id="15257" class="Symbol">(</a><a id="15258" href="blog/generic-parallel-fp/index.html#13690" class="Field">deserialize</a> <a id="15270" href="blog/generic-parallel-fp/index.html#15231" class="Bound">x</a><a id="15271" class="Symbol">)</a>
   <a id="15276" class="Keyword">in</a> <a id="15279" href="blog/generic-parallel-fp/index.html#13725" class="Field">serialize</a> <a id="15289" class="Symbol">‚¶É</a> <a id="15291" href="blog/generic-parallel-fp/index.html#15227" class="Bound">d</a> <a id="15293" class="Symbol">‚¶Ñ</a> <a id="15295" href="blog/generic-parallel-fp/index.html#15241" class="Bound">res</a> <a data-type="(fst : A) (snd : B fst) ‚Üí Œ£ A B" id="15299" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="15301" href="blog/generic-parallel-fp/index.html#15247" class="Bound">a</a>
</pre>
<p>I think this is the first truly dependent type I‚Äôve ever written. We take a <span class="Agda"><a href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a></span> corresponding to how we‚Äôd like to divvy up the problem, and then see if the <span class="Agda"><a href="blog/generic-parallel-fp/index.html#6183" class="Function">Represent</a></span> of that has <span class="Agda"><a href="blog/generic-parallel-fp/index.html#13627" class="Record">ArrayIso</a></span> and <span class="Agda"><a href="blog/generic-parallel-fp/index.html#8523" class="Record">LScan</a></span> instances, and then give back an algorithm that scans over arrays of the correct <span class="Agda"><a href="blog/generic-parallel-fp/index.html#13677" class="Field">Size</a></span>.</p>
<p>Finally we‚Äôre ready to try this out. We can give the <span class="Agda"><a href="blog/generic-parallel-fp/index.html#1013" class="Datatype">RList</a></span> implementation from earlier:</p>
<pre class="Agda"><a id="‚ñ∑_"></a><a id="15740" href="blog/generic-parallel-fp/index.html#15740" class="Function Operator">‚ñ∑_</a> <a id="15743" class="Symbol">:</a> <a id="15745" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a> <a id="15749" class="Symbol">‚Üí</a> <a id="15751" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
<a id="15755" href="blog/generic-parallel-fp/index.html#15740" class="Function Operator">‚ñ∑_</a> <a id="15758" href="blog/generic-parallel-fp/index.html#15758" class="Bound">a</a> <a id="15760" class="Symbol">=</a> <a id="15762" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a> <a id="15766" href="blog/generic-parallel-fp/index.html#5862" class="InductiveConstructor Operator">:*:</a> <a id="15770" href="blog/generic-parallel-fp/index.html#15758" class="Bound">a</a>

<a id="15773" href="blog/generic-parallel-fp/index.html#15773" class="Function">_</a> <a id="15775" class="Symbol">:</a> <a id="15777" class="Symbol">‚¶É</a> <a id="15779" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="15786" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="15788" class="Symbol">‚¶Ñ</a> <a id="15790" class="Symbol">‚Üí</a> <a id="15792" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="15796" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="15798" class="Number">4</a> <a id="15800" class="Symbol">‚Üí</a> <a id="15802" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="15806" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="15808" class="Number">4</a> <a id="15810" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="15812" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
<a id="15814" class="Symbol">_</a> <a id="15816" class="Symbol">=</a> <a id="15818" href="blog/generic-parallel-fp/index.html#15033" class="Function">genericScan</a> <a id="15830" class="Symbol">(</a><a id="15831" href="blog/generic-parallel-fp/index.html#15740" class="Function Operator">‚ñ∑</a> <a id="15833" href="blog/generic-parallel-fp/index.html#15740" class="Function Operator">‚ñ∑</a> <a id="15835" href="blog/generic-parallel-fp/index.html#15740" class="Function Operator">‚ñ∑</a> <a id="15837" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a><a id="15840" class="Symbol">)</a>
</pre>
<p>or the <span class="Agda"><a href="blog/generic-parallel-fp/index.html#1497" class="Datatype">LList</a></span> instance:</p>
<pre class="Agda"><a id="_‚óÅ"></a><a id="15884" href="blog/generic-parallel-fp/index.html#15884" class="Function Operator">_‚óÅ</a> <a id="15887" class="Symbol">:</a> <a id="15889" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a> <a id="15893" class="Symbol">‚Üí</a> <a id="15895" href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a>
<a id="15899" href="blog/generic-parallel-fp/index.html#15884" class="Function Operator">_‚óÅ</a> <a id="15902" href="blog/generic-parallel-fp/index.html#15902" class="Bound">a</a> <a id="15904" class="Symbol">=</a> <a id="15906" href="blog/generic-parallel-fp/index.html#15902" class="Bound">a</a> <a id="15908" href="blog/generic-parallel-fp/index.html#5862" class="InductiveConstructor Operator">:*:</a> <a id="15912" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a>

<a id="15917" href="blog/generic-parallel-fp/index.html#15917" class="Function">_</a> <a id="15919" class="Symbol">:</a> <a id="15921" class="Symbol">‚¶É</a> <a id="15923" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="15930" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="15932" class="Symbol">‚¶Ñ</a> <a id="15934" class="Symbol">‚Üí</a> <a id="15936" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="15940" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="15942" class="Number">4</a> <a id="15944" class="Symbol">‚Üí</a> <a id="15946" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="15950" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="15952" class="Number">4</a> <a id="15954" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="15956" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
<a id="15958" class="Symbol">_</a> <a id="15960" class="Symbol">=</a> <a id="15962" href="blog/generic-parallel-fp/index.html#15033" class="Function">genericScan</a> <a id="15974" class="Symbol">(</a><a id="15975" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a> <a id="15979" href="blog/generic-parallel-fp/index.html#15884" class="Function Operator">‚óÅ</a> <a id="15981" href="blog/generic-parallel-fp/index.html#15884" class="Function Operator">‚óÅ</a> <a id="15983" href="blog/generic-parallel-fp/index.html#15884" class="Function Operator">‚óÅ</a><a id="15984" class="Symbol">)</a>
</pre>
<p>But we can also come up with more interesting strategies as well. For example, we can divvy up the problem by left-associating the first half, and right-associating the second:</p>
<pre class="Agda"><a id="16173" href="blog/generic-parallel-fp/index.html#16173" class="Function">_</a> <a id="16175" class="Symbol">:</a> <a id="16177" class="Symbol">‚¶É</a> <a id="16179" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="16186" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="16188" class="Symbol">‚¶Ñ</a> <a id="16190" class="Symbol">‚Üí</a> <a id="16192" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="16196" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="16198" class="Number">8</a> <a id="16200" class="Symbol">‚Üí</a> <a id="16202" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="16206" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="16208" class="Number">8</a> <a id="16210" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="16212" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
<a id="16214" class="Symbol">_</a> <a id="16216" class="Symbol">=</a> <a id="16218" href="blog/generic-parallel-fp/index.html#15033" class="Function">genericScan</a> <a id="16230" class="Symbol">((</a><a id="16232" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a> <a id="16236" href="blog/generic-parallel-fp/index.html#15884" class="Function Operator">‚óÅ</a> <a id="16238" href="blog/generic-parallel-fp/index.html#15884" class="Function Operator">‚óÅ</a> <a id="16240" href="blog/generic-parallel-fp/index.html#15884" class="Function Operator">‚óÅ</a><a id="16241" class="Symbol">)</a> <a id="16243" href="blog/generic-parallel-fp/index.html#5862" class="InductiveConstructor Operator">:*:</a> <a id="16247" class="Symbol">(</a><a id="16248" href="blog/generic-parallel-fp/index.html#15740" class="Function Operator">‚ñ∑</a> <a id="16250" href="blog/generic-parallel-fp/index.html#15740" class="Function Operator">‚ñ∑</a> <a id="16252" href="blog/generic-parallel-fp/index.html#15740" class="Function Operator">‚ñ∑</a> <a id="16254" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a><a id="16257" class="Symbol">))</a>
</pre>
<p>This one probably isn‚Äôt an <em>efficient</em> algorithm, but it‚Äôs cool that we can express such a thing so succinctly. Probably of more interest is a balanced tree over our array:</p>
<pre class="Agda"><a id="16443" href="blog/generic-parallel-fp/index.html#16443" class="Function">_</a> <a id="16445" class="Symbol">:</a> <a id="16447" class="Symbol">‚¶É</a> <a id="16449" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="16456" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="16458" class="Symbol">‚¶Ñ</a> <a id="16460" class="Symbol">‚Üí</a> <a id="16462" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="16466" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="16468" class="Number">16</a> <a id="16471" class="Symbol">‚Üí</a> <a id="16473" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="16477" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="16479" class="Number">16</a> <a id="16482" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="16484" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
<a id="16486" class="Symbol">_</a> <a id="16488" class="Symbol">=</a> <a id="16490" class="Keyword">let</a> <a id="16494" href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åä_‚åã</a> <a id="16498" href="blog/generic-parallel-fp/index.html#16498" class="Bound">a</a> <a id="16500" class="Symbol">=</a> <a id="16502" href="blog/generic-parallel-fp/index.html#16498" class="Bound">a</a> <a id="16504" href="blog/generic-parallel-fp/index.html#5862" class="InductiveConstructor Operator">:*:</a> <a id="16508" href="blog/generic-parallel-fp/index.html#16498" class="Bound">a</a>
     <a id="16515" class="Keyword">in</a> <a id="16518" href="blog/generic-parallel-fp/index.html#15033" class="Function">genericScan</a> <a id="16530" class="Symbol">(</a><a id="16531" href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åä</a> <a id="16533" href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åä</a> <a id="16535" href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åä</a> <a id="16537" href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åä</a> <a id="16539" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a> <a id="16543" href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åã</a> <a id="16545" href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åã</a> <a id="16547" href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åã</a> <a id="16549" href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åã</a><a id="16550" class="Symbol">)</a>
</pre>
<p>The balanced tree over products is interesting, but what if we make a balanced tree over <em>composition?</em> In essence, we can split the problem into chunks of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mo stretchy="false">(</mo></msup><msup><mn>2</mn><mi>n</mi></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">2^(2^n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mopen mtight">(</span></span></span></span></span></span></span></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> amounts of work via <span class="Agda"><a href="blog/generic-parallel-fp/index.html#16796" class="Datatype">Bush</a></span>:</p>
<pre class="Agda"><a id="16763" class="Symbol">{-#</a> <a id="16767" class="Keyword">NO_POSITIVITY_CHECK</a> <a id="16787" class="Symbol">#-}</a>
<a id="16791" class="Keyword">data</a> <a id="Bush"></a><a id="16796" href="blog/generic-parallel-fp/index.html#16796" class="Datatype">Bush</a> <a id="16801" class="Symbol">:</a> <a data-type="Set" id="16803" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="16805" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="16807" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="16811" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="16813" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="16817" class="Keyword">where</a>
  <a id="Bush.twig"></a><a id="16825" href="blog/generic-parallel-fp/index.html#16825" class="InductiveConstructor">twig</a> <a id="16830" class="Symbol">:</a> <a id="16832" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="16834" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="16836" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="16838" class="Symbol">‚Üí</a> <a id="16840" href="blog/generic-parallel-fp/index.html#16796" class="Datatype">Bush</a> <a id="16845" class="Number">0</a> <a id="16847" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
  <a id="Bush.bush"></a><a id="16851" href="blog/generic-parallel-fp/index.html#16851" class="InductiveConstructor">bush</a> <a id="16856" class="Symbol">:</a> <a id="16858" class="Symbol">{</a><a id="16859" href="blog/generic-parallel-fp/index.html#16859" class="Bound">n</a> <a id="16861" class="Symbol">:</a> <a data-type="Set" id="16863" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="16864" class="Symbol">}</a> <a id="16866" class="Symbol">‚Üí</a> <a id="16868" href="blog/generic-parallel-fp/index.html#16796" class="Datatype">Bush</a> <a id="16873" href="blog/generic-parallel-fp/index.html#16859" class="Bound">n</a> <a id="16875" class="Symbol">(</a><a id="16876" href="blog/generic-parallel-fp/index.html#16796" class="Datatype">Bush</a> <a id="16881" href="blog/generic-parallel-fp/index.html#16859" class="Bound">n</a> <a id="16883" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a><a id="16884" class="Symbol">)</a> <a id="16886" class="Symbol">‚Üí</a> <a id="16888" href="blog/generic-parallel-fp/index.html#16796" class="Datatype">Bush</a> <a id="16893" class="Symbol">(</a><a data-type="Nat ‚Üí Nat" id="16894" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="16898" href="blog/generic-parallel-fp/index.html#16859" class="Bound">n</a><a id="16899" class="Symbol">)</a> <a id="16901" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
</pre>
<p>Which we won‚Äôt use directly, but can use it‚Äôs <span class="Agda"><a href="blog/generic-parallel-fp/index.html#5743" class="Datatype">Rep</a></span>:</p>
<pre class="Agda"><a id="16973" href="blog/generic-parallel-fp/index.html#16973" class="Function">_</a> <a id="16975" class="Symbol">:</a> <a id="16977" class="Symbol">‚¶É</a> <a id="16979" href="blog/generic-parallel-fp/index.html#304" class="Record">Monoid</a> <a id="16986" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="16988" class="Symbol">‚¶Ñ</a> <a id="16990" class="Symbol">‚Üí</a> <a id="16992" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="16996" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="16998" class="Number">16</a> <a id="17001" class="Symbol">‚Üí</a> <a id="17003" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="17007" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a> <a id="17009" class="Number">16</a> <a id="17012" href="Data.Product.html#1167" class="Function Operator">√ó</a> <a id="17014" href="blog/generic-parallel-fp/index.html#254" class="Generalizable">A</a>
<a id="17016" class="Symbol">_</a> <a id="17018" class="Symbol">=</a> <a id="17020" class="Keyword">let</a> <a id="17024" href="blog/generic-parallel-fp/index.html#17024" class="Bound">pair</a> <a id="17029" class="Symbol">=</a> <a id="17031" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a> <a id="17035" href="blog/generic-parallel-fp/index.html#5862" class="InductiveConstructor Operator">:*:</a> <a id="17039" href="blog/generic-parallel-fp/index.html#5798" class="InductiveConstructor">Par</a>
     <a id="17048" class="Keyword">in</a> <a id="17051" href="blog/generic-parallel-fp/index.html#15033" class="Function">genericScan</a> <a id="17063" class="Symbol">((</a><a id="17065" href="blog/generic-parallel-fp/index.html#17024" class="Bound">pair</a> <a id="17070" href="blog/generic-parallel-fp/index.html#5888" class="InductiveConstructor Operator">:‚àò:</a> <a id="17074" href="blog/generic-parallel-fp/index.html#17024" class="Bound">pair</a><a id="17078" class="Symbol">)</a> <a id="17080" href="blog/generic-parallel-fp/index.html#5888" class="InductiveConstructor Operator">:‚àò:</a> <a id="17084" class="Symbol">(</a><a id="17085" href="blog/generic-parallel-fp/index.html#17024" class="Bound">pair</a> <a id="17090" href="blog/generic-parallel-fp/index.html#5888" class="InductiveConstructor Operator">:‚àò:</a> <a id="17094" href="blog/generic-parallel-fp/index.html#17024" class="Bound">pair</a><a id="17098" class="Symbol">))</a>
</pre>
<p>The paper compares several of these strategies for dividing-and-conquering. In particular, it shows that we can minimize total work via a left-associated <span class="Agda"><a href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åä_‚åã</a></span> strategy, but maximize parallelism with a <em>right</em>-associated <span class="Agda"><a href="blog/generic-parallel-fp/index.html#16494" class="Bound Operator">‚åä_‚åã</a></span>. And using the <code>Bush</code> from earlier, we can get a nice middle ground.</p>
<h2 id="very-quick-ffts"><a href="#very-quick-ffts" class="header-link">Very Quick FFTs<span class="header-link-emoji">üîó</span></a></h2>
<p>The paper follows up, applying this approach to implementations of the fast fourier transform. There, the <span class="Agda"><a href="blog/generic-parallel-fp/index.html#16796" class="Datatype">Bush</a></span> approach gives constant factor improvments for both <em>work</em> and <em>parallelism,</em> compared to all previously known algorithms.</p>
<p>Results like these are strong evidence that Elliott is <em>actually onto something</em> with his seemingly crazy ideas that computation should be elegant and well principled. Giving significant constant factor improvements to well-known, extremely important algorithms <em>mostly for free</em> is a true superpower, and is worth taking extremely seriously.</p>
<h2 id="fighting-against-publication-bias"><a href="#fighting-against-publication-bias" class="header-link">Fighting Against Publication Bias<span class="header-link-emoji">üîó</span></a></h2>
<p>Andrew McKnight and I tried to use this same approach to get a nice algorithm for sorting, hoping that we could get well-known sorting algorithms to fall out as special cases of our more general functor building blocks. We completely failed on this front, namely because we couldn‚Äôt figure out how to give an instance for product types. Rather alarmingly, we‚Äôre not entirely sure <em>why</em> the approach failed there; maybe it was just not thinking hard enough.</p>
<p>Another plausible idea is that sorting requires branching, and that this approach only works for statically-known codepaths.</p>
<h2 id="future-work"><a href="#future-work" class="header-link">Future Work<span class="header-link-emoji">üîó</span></a></h2>
<p>Andrew and I spent a good chunk of the week thinking about this problem, and we figure there are solid odds that you could <em>automatically</em> discover these generic algorithmic building blocks from a well-known algorithm. Here‚Äôs the sketch:</p>
<p>Use the well-known algorithm as a specification, instantiate all parameters at small types and see if you can find instances of the algorithm for the functor building blocks that agree with the spec. It seems like you should be able to use factorization of the input to target which instances you‚Äôre looking for.</p>
<p>Of course, once you have the algorithmic building blocks, conventional search techniques can be used to optimize any particular goal you might have.</p>

<p class="meta">
</p>

</div>

<div class="comments">
  <script src="https://utteranc.es/client.js" repo="isovector/reasonablypolymorphic.com" issue-term="pathname" theme="github-light" crossorigin="anonymous" async>
  </script>
</div>
</article>

</div>
    <nav>
        <h1><a href="/">REASONABLY<br />POLYMORPHIC</a></h1>
    
        <p> Hi there. I&#39;m <strong>Sandy Maguire</strong>. I like improving life and
        making cool things.</p>
    
        <p>If you want to get in touch, I&#39;d love to hear from you! Send me an
        email; you can contact me via <tt><b>sandy</b></tt> at <tt><b>sandymaguire.me</b></tt>.</p>
    
        <h2>SITE LINKS</h2>
        <ul>
            <li><a href="/">Archives</a></li>
            <li><a href="/talks">Talks</a></li>
        </ul>
    
        <h2>THINGS I MAKE</h2>
        <ul>
            <li>Code on <a href="http://github.com/isovector">github</a></li>
            <li>Book <a href="/book/preface.html">archive</a></li>
            <li>My other <a href="http://sandymaguire.me">blog</a></li>
        </ul>
    
        <h2>WHAT I&#39;M DOING</h2>
        <ul>
            <!-- <li><a href="/erdos">Erdos Project</a></li> -->
            <li>Music at <a href="http://last.fm/user/Paamayim">last.fm</a></li>
            <li>Books at <a href="https://www.goodreads.com/review/list/14945161-sandy-maguire?shelf=currently-reading">goodreads</a></li>
            <!-- <li>Papers at <a href="https://www.mendeley.com/groups/7295141/read/papers/">mendeley</a></li> -->
        </ul>
    
        <p>
        ¬© 2015-2023 Sandy Maguire
        </p>
    </nav>

    <!--
    <div id="smallnav">
      <div class="smallhome"><a href="/">REASONABLY POLYMORPHIC</a></div>
      <div class="smallarchives"><a href="/blog/archives/">ARCHIVES</a></div>
    </div>
    -->
</body>
</html>

