<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <base href="/"></base>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Review: Lightweight Semiformal Time Complexity Analysis for Purely Functional Data Structures :: Reasonably Polymorphic</title>
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
        <link href="/atom.xml" rel="alternate" title="Reasonably Polymorphic - Atom" type="application/atom+xml" />
        <link href="/feed.rss" rel="alternate" title="Reasonably Polymorphic - RSS" type="application/rss+xml" />

        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/katex.min.css" />
        <link rel="stylesheet" href="/css/agda-cats.css" />

        <script src="/equations.js"></script>
        <script src="/highlight-hover.js"></script>

  <noscript>
    <style>
      body span.reasoning-step .as-written {
        display: inline;
      }

      body span.reasoning-step .alternate {
        display: none;
      }
    </style>
  </noscript>

        </head>
        <body>
<div class="main">

<article>
<header>
  <h1><a href="/blog/complexity-analysis/index.html#">Review: Lightweight Semiformal Time Complexity Analysis for Purely Functional Data Structures</a></h1>
</header>
<p class="meta">
    <time>2022-03-06</time>

    <span class="tags">
        
    </span>
</p>
<div class="content">
    <p>What a mouthful of a title! <a href="https://www.cse.chalmers.se/~nad/publications/danielsson-popl2008.pdf">LWTCAfPFDS</a> is our paper for the week, written by Nils Anders Danielsson. At a high level, the idea is to introduce a graded monad which counts computation steps, whose bind adds those steps together. By constructing our program in this monad, we can use the type-system to track its runtime asymptotics.</p>
<h2 id="core-definitions"><a href="#core-definitions" class="header-link">Core Definitions<span class="header-link-emoji">üîó</span></a></h2>
<p>We might as well dive in. Since all of this complexity analysis stuff shouldn‚Äôt <em>change</em> anything at runtime, we really only need to stick the analysis in the types, and can erase it all at runtime.</p>
<p>The paper thus presents its main tools in an <code>abstract</code> block, which is a new Agda feature for me. And wow, does Agda ever feel like it‚Äôs Haskell but from the future. An <code>abstract</code> block lets us give some definitions, which <em>inside</em> the <code>abstract</code> block can be normalized. But outside the block, they are opaque symbols that are just what they are. This is a delightful contrast to Haskell, where we need to play a game of making a new module, and carefully not exporting things in order to get the same behavior. And even then, in Haskell, we can‚Äôt give opaque <code>type</code> synonyms or anything like that.</p>
<p>Anyway, the main type in the paper is <span class="Agda"><a href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a></span>, which tracks how many computation steps are necessary to produce an eventual value:</p>
<!--
<pre class="Agda"><a id="1606" class="Symbol">{-#</a> <a id="1610" class="Keyword">OPTIONS</a> <a id="1618" class="Pragma">--rewriting</a> <a id="1630" class="Symbol">#-}</a>

<a id="1635" class="Keyword">module</a> <a id="1642" href="blog.complexity-analysis.html" class="Module">blog.complexity-analysis</a> <a id="1667" class="Keyword">where</a>

<a id="1674" class="Keyword">open</a> <a id="1679" class="Keyword">import</a> <a id="1686" href="Function.html" class="Module">Function</a>
<a id="1695" class="Keyword">open</a> <a id="1700" class="Keyword">import</a> <a id="1707" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="1716" class="Keyword">open</a> <a id="1721" class="Keyword">import</a> <a id="1728" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a>
<a id="1748" class="Keyword">open</a> <a id="1753" class="Keyword">import</a> <a id="1760" href="Data.Bool.html" class="Module">Data.Bool</a> <a id="1770" class="Keyword">using</a> <a id="1776" class="Symbol">(</a><a id="1777" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a><a id="1781" class="Symbol">;</a> <a id="1783" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a><a id="1787" class="Symbol">;</a> <a id="1789" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a><a id="1794" class="Symbol">)</a>
<a id="1796" class="Keyword">open</a> <a id="1801" class="Keyword">import</a> <a id="1808" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="1846" class="Symbol">as</a> <a id="1849" class="Module">Eq</a>

<a id="1853" class="Keyword">open</a> <a id="1858" href="Relation.Binary.PropositionalEquality.html" class="Module">Eq</a>

<a id="1862" class="Keyword">private</a> <a id="1870" class="Keyword">variable</a>
  <a id="1881" href="blog.complexity-analysis.html#1881" class="Generalizable">a</a> <a id="1883" href="blog.complexity-analysis.html#1883" class="Generalizable">b</a> <a id="1885" class="Symbol">:</a> <a id="1887" href="Agda.Primitive.html#326" class="Primitive">Set</a>
  <a id="1893" href="blog.complexity-analysis.html#1893" class="Generalizable">m</a> <a id="1895" href="blog.complexity-analysis.html#1895" class="Generalizable">n</a> <a id="1897" class="Symbol">:</a> <a id="1899" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a>
</pre>-->
<pre class="Agda"><a id="1914" class="Keyword">abstract</a>
  <a id="Thunk"></a><a id="1925" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="1931" class="Symbol">:</a> <a data-type="Set" id="1933" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="1935" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="1937" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1941" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="1943" href="Agda.Primitive.html#326" class="Primitive">Set</a>
  <a id="1949" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="1955" href="blog/complexity-analysis/index.html#1955" class="Bound">n</a> <a id="1957" href="blog/complexity-analysis/index.html#1957" class="Bound">a</a> <a id="1959" class="Symbol">=</a> <a id="1961" href="blog/complexity-analysis/index.html#1957" class="Bound">a</a>
</pre>
<p>Because none of this exists at runtime, we can just ignore the <code>n</code> argument, and use the <code>abstract</code>ion barrier to ensure nobody can use this fact in anger. <span class="Agda"><a href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a></span> is a <em>graded</em> monad, that is, a monad parameterized by a monoid, which uses <code>mempty</code> for <code>pure</code>, and <code>mappend</code> for binding. We can show that <span class="Agda"><a href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a></span> does form a graded monad:</p>
<pre class="Agda">  <a id="pure"></a><a id="2328" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="2333" class="Symbol">:</a> <a id="2335" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="2337" class="Symbol">‚Üí</a> <a id="2339" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="2345" class="Number">0</a> <a id="2347" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a>
  <a id="2351" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="2356" href="blog/complexity-analysis/index.html#2356" class="Bound">x</a> <a id="2358" class="Symbol">=</a> <a id="2360" href="blog/complexity-analysis/index.html#2356" class="Bound">x</a>

  <a id="2365" class="Keyword">infixl</a> <a id="2372" class="Number">1</a> <a id="2374" href="blog/complexity-analysis/index.html#2382" class="Function Operator">_&gt;&gt;=_</a>
  <a id="_&gt;&gt;=_"></a><a id="2382" href="blog/complexity-analysis/index.html#2382" class="Function Operator">_&gt;&gt;=_</a> <a id="2388" class="Symbol">:</a> <a id="2390" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="2396" href="blog/complexity-analysis/index.html#1893" class="Generalizable">m</a> <a id="2398" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="2400" class="Symbol">‚Üí</a> <a id="2402" class="Symbol">(</a><a id="2403" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="2405" class="Symbol">‚Üí</a> <a id="2407" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="2413" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a> <a id="2415" href="blog/complexity-analysis/index.html#1883" class="Generalizable">b</a><a id="2416" class="Symbol">)</a> <a id="2418" class="Symbol">‚Üí</a> <a id="2420" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="2426" class="Symbol">(</a><a id="2427" href="blog/complexity-analysis/index.html#1893" class="Generalizable">m</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="2429" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="2431" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="2432" class="Symbol">)</a> <a id="2434" href="blog/complexity-analysis/index.html#1883" class="Generalizable">b</a>
  <a id="2438" href="blog/complexity-analysis/index.html#2438" class="Bound">x</a> <a id="2440" href="blog/complexity-analysis/index.html#2382" class="Function Operator">&gt;&gt;=</a> <a id="2444" href="blog/complexity-analysis/index.html#2444" class="Bound">f</a> <a id="2446" class="Symbol">=</a> <a id="2448" href="blog/complexity-analysis/index.html#2444" class="Bound">f</a> <a id="2450" href="blog/complexity-analysis/index.html#2438" class="Bound">x</a>

  <a id="2455" class="Keyword">infixr</a> <a id="2462" class="Number">1</a> <a id="2464" href="blog/complexity-analysis/index.html#2472" class="Function Operator">_=&lt;&lt;_</a>
  <a id="_=&lt;&lt;_"></a><a id="2472" href="blog/complexity-analysis/index.html#2472" class="Function Operator">_=&lt;&lt;_</a> <a id="2478" class="Symbol">:</a> <a id="2480" class="Symbol">(</a><a id="2481" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="2483" class="Symbol">‚Üí</a> <a id="2485" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="2491" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a> <a id="2493" href="blog/complexity-analysis/index.html#1883" class="Generalizable">b</a><a id="2494" class="Symbol">)</a> <a id="2496" class="Symbol">‚Üí</a> <a id="2498" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="2504" href="blog/complexity-analysis/index.html#1893" class="Generalizable">m</a> <a id="2506" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="2508" class="Symbol">‚Üí</a> <a id="2510" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="2516" class="Symbol">(</a><a id="2517" href="blog/complexity-analysis/index.html#1893" class="Generalizable">m</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="2519" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="2521" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="2522" class="Symbol">)</a> <a id="2524" href="blog/complexity-analysis/index.html#1883" class="Generalizable">b</a>
  <a id="2528" href="blog/complexity-analysis/index.html#2528" class="Bound">f</a> <a id="2530" href="blog/complexity-analysis/index.html#2472" class="Function Operator">=&lt;&lt;</a> <a id="2534" href="blog/complexity-analysis/index.html#2534" class="Bound">x</a> <a id="2536" class="Symbol">=</a> <a id="2538" href="blog/complexity-analysis/index.html#2528" class="Bound">f</a> <a id="2540" href="blog/complexity-analysis/index.html#2534" class="Bound">x</a>
</pre>
<p>We‚Äôll omit the proofs that <span class="Agda"><a href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a></span> really is a monad, but it‚Äôs not hard to see; <span class="Agda"><a href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a></span> is truly just the identity monad.</p>
<p><span class="Agda"><a href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a></span> is also equipped with two further operations; the ability to mark a computation cycle, and the ability to extract the underlying value by throwing away the complexity analysis:</p>
<pre class="Agda">  <a id="2883" class="Keyword">infixr</a> <a id="2890" class="Number">0</a> <a id="2892" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!_</a>
  <a id="!_"></a><a id="2897" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!_</a> <a id="2900" class="Symbol">:</a> <a id="2902" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="2908" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a> <a id="2910" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="2912" class="Symbol">‚Üí</a> <a id="2914" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="2920" class="Symbol">(</a><a data-type="Nat ‚Üí Nat" id="2921" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="2925" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="2926" class="Symbol">)</a> <a id="2928" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a>
  <a id="2932" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!_</a> <a id="2935" href="blog/complexity-analysis/index.html#2935" class="Bound">a</a> <a id="2937" class="Symbol">=</a> <a id="2939" href="blog/complexity-analysis/index.html#2935" class="Bound">a</a>

  <a id="force"></a><a id="2944" href="blog/complexity-analysis/index.html#2944" class="Function">force</a> <a id="2950" class="Symbol">:</a> <a id="2952" class="Symbol">{</a><a id="2953" href="blog/complexity-analysis/index.html#2953" class="Bound">a</a> <a id="2955" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="2957" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="2960" class="Symbol">}</a> <a id="2962" class="Symbol">‚Üí</a> <a id="2964" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="2970" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a> <a id="2972" href="blog/complexity-analysis/index.html#2953" class="Bound">a</a> <a id="2974" class="Symbol">‚Üí</a> <a id="2976" href="blog/complexity-analysis/index.html#2953" class="Bound">a</a>
  <a id="2980" href="blog/complexity-analysis/index.html#2944" class="Function">force</a> <a id="2986" href="blog/complexity-analysis/index.html#2986" class="Bound">x</a> <a id="2988" class="Symbol">=</a> <a id="2990" href="blog/complexity-analysis/index.html#2986" class="Bound">x</a>
</pre>
<p>Here, <span class="Agda"><a href="blog/complexity-analysis/index.html#2897" class="Function Operator">!_</a></span> is given a low, right-spanning precedence, which means it‚Äôs relatively painless to annotate with:</p>
<pre class="Agda"><a id="3118" href="blog/complexity-analysis/index.html#3118" class="Function">_</a> <a id="3120" class="Symbol">:</a> <a id="3122" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="3128" class="Number">3</a> <a data-type="Set" id="3130" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a>
<a id="3132" class="Symbol">_</a> <a id="3134" class="Symbol">=</a> <a id="3136" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="3138" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="3140" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="3142" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="3147" class="Number">0</a>
</pre>
<h2 id="conventions"><a href="#conventions" class="header-link">Conventions<span class="header-link-emoji">üîó</span></a></h2>
<p>Our definitions are ‚Äúopt-in,‚Äù in the sense that the compiler won‚Äôt yell at you if you forget to call <span class="Agda"><a href="blog/complexity-analysis/index.html#2897" class="Function Operator">!_</a></span> somewhere a computational step happens. Thus, we require users to follow the following conventions:</p>
<ol type="1">
<li>Every function body must begin with a call to <span class="Agda"><a href="blog/complexity-analysis/index.html#2897" class="Function Operator">!_</a></span>.</li>
<li><span class="Agda"><a href="blog/complexity-analysis/index.html#2944" class="Function">force</a></span> may not be used in a function body.</li>
<li>None of <span class="Agda"><a href="blog/complexity-analysis/index.html#2328" class="Function">pure</a></span>, <span class="Agda"><a href="blog/complexity-analysis/index.html#2382" class="Function Operator">_&gt;&gt;=_</a></span> nor <span class="Agda"><a href="blog/complexity-analysis/index.html#2897" class="Function Operator">!_</a></span> may be called partially applied.</li>
</ol>
<p>The first convention ensures we count everything that should be counted. The second ensures we don‚Äôt cheat by discarding complexity information before it‚Äôs been counted. And the third ensures we don‚Äôt accidentally introduce uncounted computation steps.</p>
<p>The first two are pretty obvious, but the third is a little subtler. Under the hood, partial application gets turned into a lambda, which introduces a computation step to evaluate. But that step won‚Äôt be ticked via <span class="Agda"><a href="blog/complexity-analysis/index.html#2897" class="Function Operator">!_</a></span>, so we will have lost the bijection between our programs and their analyses.</p>
<h2 id="lazy-data-types"><a href="#lazy-data-types" class="header-link">Lazy Data Types<span class="header-link-emoji">üîó</span></a></h2>
<p>The paper shows us how to define a lazy vector. <span class="Agda"><a href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a></span> <code>a c n</code> is a vector of <code>n</code> elements of type <code>a</code>, where the cost of forcing each subsequent tail is <code>c</code>:</p>
<pre class="Agda"><a id="4346" class="Symbol">{-#</a> <a id="4350" class="Keyword">NO_POSITIVITY_CHECK</a> <a id="4370" class="Symbol">#-}</a>
<a id="4374" class="Keyword">data</a> <a id="VecL"></a><a id="4379" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="4384" class="Symbol">(</a><a id="4385" href="blog/complexity-analysis/index.html#4385" class="Bound">a</a> <a id="4387" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="4389" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="4392" class="Symbol">)</a> <a id="4394" class="Symbol">(</a><a id="4395" href="blog/complexity-analysis/index.html#4395" class="Bound">c</a> <a id="4397" class="Symbol">:</a> <a data-type="Set" id="4399" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="4400" class="Symbol">)</a> <a id="4402" class="Symbol">:</a> <a data-type="Set" id="4404" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="4406" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="4408" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="4412" class="Keyword">where</a>
  <a id="VecL.[]"></a><a id="4420" href="blog/complexity-analysis/index.html#4420" class="InductiveConstructor">[]</a> <a id="4423" class="Symbol">:</a> <a id="4425" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="4430" href="blog/complexity-analysis/index.html#4385" class="Bound">a</a> <a id="4432" href="blog/complexity-analysis/index.html#4395" class="Bound">c</a> <a id="4434" class="Number">0</a>
  <a id="VecL._‚à∑_"></a><a id="4438" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">_‚à∑_</a> <a id="4442" class="Symbol">:</a> <a id="4444" href="blog/complexity-analysis/index.html#4385" class="Bound">a</a> <a id="4446" class="Symbol">‚Üí</a> <a id="4448" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="4454" href="blog/complexity-analysis/index.html#4395" class="Bound">c</a> <a id="4456" class="Symbol">(</a><a id="4457" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="4462" href="blog/complexity-analysis/index.html#4385" class="Bound">a</a> <a id="4464" href="blog/complexity-analysis/index.html#4395" class="Bound">c</a> <a id="4466" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="4467" class="Symbol">)</a> <a id="4469" class="Symbol">‚Üí</a> <a id="4471" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="4476" href="blog/complexity-analysis/index.html#4385" class="Bound">a</a> <a id="4478" href="blog/complexity-analysis/index.html#4395" class="Bound">c</a> <a id="4480" class="Symbol">(</a><a data-type="Nat ‚Üí Nat" id="4481" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="4485" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="4486" class="Symbol">)</a>

<a id="4489" class="Keyword">infixr</a> <a id="4496" class="Number">5</a> <a id="4498" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">_‚à∑_</a>
</pre>
<p>Let‚Äôs try to write <span class="Agda"><a href="blog/complexity-analysis/index.html#5467" class="Function">fmap</a></span> for <span class="Agda"><a href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a></span>. We‚Äôre going to need a helper function, which delays a computation by artificially inflating its number of steps:</p>
<pre class="Agda"><a id="4678" class="Keyword">abstract</a>
  <a id="wait"></a><a id="4689" href="blog/complexity-analysis/index.html#4689" class="Function">wait</a> <a id="4694" class="Symbol">:</a> <a id="4696" class="Symbol">{</a><a id="4697" href="blog/complexity-analysis/index.html#4697" class="Bound">n</a> <a id="4699" class="Symbol">:</a> <a data-type="Set" id="4701" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="4702" class="Symbol">}</a> <a id="4704" class="Symbol">‚Üí</a> <a id="4706" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="4712" href="blog/complexity-analysis/index.html#1893" class="Generalizable">m</a> <a id="4714" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="4716" class="Symbol">‚Üí</a> <a id="4718" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="4724" class="Symbol">(</a><a id="4725" href="blog/complexity-analysis/index.html#4697" class="Bound">n</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="4727" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="4729" href="blog/complexity-analysis/index.html#1893" class="Generalizable">m</a><a id="4730" class="Symbol">)</a> <a id="4732" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a>
  <a id="4736" href="blog/complexity-analysis/index.html#4689" class="Function">wait</a> <a id="4741" href="blog/complexity-analysis/index.html#4741" class="Bound">m</a> <a id="4743" class="Symbol">=</a> <a id="4745" href="blog/complexity-analysis/index.html#4741" class="Bound">m</a>
</pre>
<p>(the paper follows its own rules and ensures that we call <span class="Agda"><a href="blog/complexity-analysis/index.html#2897" class="Function Operator">!_</a></span> every time we <span class="Agda"><a href="blog/complexity-analysis/index.html#4689" class="Function">wait</a></span>, thus it comes with an extra <span class="Agda"><a data-type="Nat ‚Üí Nat" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a></span> in the type of <span class="Agda"><a href="blog/complexity-analysis/index.html#4689" class="Function">wait</a></span>. It gets confusing, so we‚Äôll use this version instead.)</p>
<p>Unfortunately, the paper also plays fast and loose with its math. It‚Äôs fine, because the math is right, but the code presented in the paper doesn‚Äôt typecheck in Agda. As a workaround, we need to enable rewriting:</p>
<pre class="Agda"><a id="5196" class="Keyword">open</a> <a id="5201" class="Keyword">import</a> <a id="5208" href="Agda.Builtin.Equality.Rewrite.html" class="Module">Agda.Builtin.Equality.Rewrite</a>
<a id="5238" class="Symbol">{-#</a> <a id="5242" class="Keyword">REWRITE</a> <a id="5250" href="Data.Nat.Properties.html#12854" class="Function">+-suc</a> <a id="5256" href="Data.Nat.Properties.html#13218" class="Function">+-identity ≥</a> <a id="5268" class="Symbol">#-}</a>
</pre>
<p>We‚Äôll also need to be able to lift equalities over the <code>Thunk</code> time bounds:</p>
<pre class="Agda"><a id="cast"></a><a id="5358" href="blog/complexity-analysis/index.html#5358" class="Function">cast</a> <a id="5363" class="Symbol">:</a> <a id="5365" href="blog/complexity-analysis/index.html#1893" class="Generalizable">m</a> <a id="5367" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">‚â°</a> <a id="5369" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a> <a id="5371" class="Symbol">‚Üí</a> <a id="5373" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="5379" href="blog/complexity-analysis/index.html#1893" class="Generalizable">m</a> <a id="5381" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="5383" class="Symbol">‚Üí</a> <a id="5385" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="5391" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a> <a id="5393" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a>
<a id="5395" href="blog/complexity-analysis/index.html#5358" class="Function">cast</a> <a id="5400" href="blog/complexity-analysis/index.html#5400" class="Bound">eq</a> <a id="5403" href="blog/complexity-analysis/index.html#5403" class="Bound">x</a> <a id="5405" class="Keyword">rewrite</a> <a id="5413" href="blog/complexity-analysis/index.html#5400" class="Bound">eq</a> <a id="5416" class="Symbol">=</a> <a id="5418" href="blog/complexity-analysis/index.html#5403" class="Bound">x</a>
</pre>
<p>Finally, we can write <span class="Agda"><a href="blog/complexity-analysis/index.html#5467" class="Function">fmap</a></span>:</p>
<pre class="Agda"><a id="fmap"></a><a id="5467" href="blog/complexity-analysis/index.html#5467" class="Function">fmap</a>
  <a id="5474" class="Symbol">:</a> <a id="5476" class="Symbol">{</a><a id="5477" href="blog/complexity-analysis/index.html#5477" class="Bound">c</a> <a id="5479" href="blog/complexity-analysis/index.html#5479" class="Bound">fc</a> <a id="5482" class="Symbol">:</a> <a data-type="Set" id="5484" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="5485" class="Symbol">}</a>
  <a id="5489" class="Symbol">‚Üí</a> <a id="5491" class="Symbol">(</a><a id="5492" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="5494" class="Symbol">‚Üí</a> <a id="5496" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="5502" href="blog/complexity-analysis/index.html#5479" class="Bound">fc</a> <a id="5505" href="blog/complexity-analysis/index.html#1883" class="Generalizable">b</a><a id="5506" class="Symbol">)</a>
  <a id="5510" class="Symbol">‚Üí</a> <a id="5512" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="5517" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="5519" href="blog/complexity-analysis/index.html#5477" class="Bound">c</a> <a id="5521" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a>
  <a id="5525" class="Symbol">‚Üí</a> <a id="5527" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="5533" class="Symbol">(</a><a id="5534" class="Number">2</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="5536" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="5538" href="blog/complexity-analysis/index.html#5479" class="Bound">fc</a><a id="5540" class="Symbol">)</a> <a id="5542" class="Symbol">(</a><a id="5543" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="5548" href="blog/complexity-analysis/index.html#1883" class="Generalizable">b</a> <a id="5550" class="Symbol">(</a><a id="5551" class="Number">2</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="5553" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="5555" href="blog/complexity-analysis/index.html#5479" class="Bound">fc</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="5558" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="5560" href="blog/complexity-analysis/index.html#5477" class="Bound">c</a><a id="5561" class="Symbol">)</a> <a id="5563" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="5564" class="Symbol">)</a>
<a id="5566" href="blog/complexity-analysis/index.html#5467" class="Function">fmap</a> <a id="5571" href="blog/complexity-analysis/index.html#5571" class="Bound">f</a> <a id="5573" href="blog/complexity-analysis/index.html#4420" class="InductiveConstructor">[]</a> <a id="5576" class="Symbol">=</a> <a id="5578" href="blog/complexity-analysis/index.html#4689" class="Function">wait</a> <a id="5583" class="Symbol">(</a><a id="5584" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="5589" href="blog/complexity-analysis/index.html#4420" class="InductiveConstructor">[]</a><a id="5591" class="Symbol">)</a>
<a id="5593" href="blog/complexity-analysis/index.html#5467" class="Function">fmap</a> <a id="5598" class="Symbol">{</a><a id="5599" class="Argument">c</a> <a id="5601" class="Symbol">=</a> <a id="5603" href="blog/complexity-analysis/index.html#5603" class="Bound">c</a><a id="5604" class="Symbol">}</a> <a id="5606" href="blog/complexity-analysis/index.html#5606" class="Bound">f</a> <a id="5608" class="Symbol">(</a><a id="5609" href="blog/complexity-analysis/index.html#5609" class="Bound">x</a> <a id="5611" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="5613" href="blog/complexity-analysis/index.html#5613" class="Bound">xs</a><a id="5615" class="Symbol">)</a>
          <a id="5627" class="Symbol">=</a> <a id="5629" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="5631" href="blog/complexity-analysis/index.html#5606" class="Bound">f</a> <a id="5633" href="blog/complexity-analysis/index.html#5609" class="Bound">x</a>
  <a id="5637" href="blog/complexity-analysis/index.html#2382" class="Function Operator">&gt;&gt;=</a> <a id="5641" class="Symbol">\</a><a id="5642" href="blog/complexity-analysis/index.html#5642" class="Bound">x&#39;</a> <a id="5645" class="Symbol">‚Üí</a> <a id="5647" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="5649" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="5654" class="Symbol">(</a><a id="5655" href="blog/complexity-analysis/index.html#5642" class="Bound">x&#39;</a> <a id="5658" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="5660" href="blog/complexity-analysis/index.html#5358" class="Function">cast</a> <a id="5665" class="Symbol">(</a><a id="5666" href="Data.Nat.Properties.html#13395" class="Function">+-comm</a> <a id="5673" href="blog/complexity-analysis/index.html#5603" class="Bound">c</a> <a id="5675" class="Symbol">_)</a> <a id="5678" class="Symbol">(</a><a id="5679" href="blog/complexity-analysis/index.html#5613" class="Bound">xs</a> <a id="5682" href="blog/complexity-analysis/index.html#2382" class="Function Operator">&gt;&gt;=</a> <a id="5686" href="blog/complexity-analysis/index.html#5467" class="Function">fmap</a> <a id="5691" href="blog/complexity-analysis/index.html#5606" class="Bound">f</a><a id="5692" class="Symbol">))</a>
</pre>
<p>This took me about an hour to write; I‚Äôm not convinced the approach here is as ‚Äúlightweight‚Äù as claimed. Of particular challenge was figuring out the actual time bounds on this thing. The problem is that we usually reason about asymptotics via Big-O notation, which ignores all of these constant factors. What would be nicer is the hypothetical type:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fmap</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">:</span> {c fc <span class="op">:</span> ‚Ñï}</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  ‚Üí (a ‚Üí <span class="dt">Thunk</span> (<span class="dt">O</span> fc) b)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  ‚Üí <span class="dt">VecL</span> a c n</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  ‚Üí <span class="dt">Thunk</span> (<span class="dt">O</span> c) (<span class="dt">VecL</span> b (<span class="dt">O</span> (fc <span class="op">+</span> c)) n)</span></code></pre></div>
<p>where every thunk is now parameterized by <code>O x</code> saying our asymptotics are bounded by <code>x</code>. We‚Äôll see about fleshing this idea out later. For now, we can power through on the paper, and write vector insertion. Let‚Äôs assume we have a constant time comparison function for <span class="Agda"><a href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a></span>:</p>
<pre class="Agda"><a id="6455" class="Keyword">postulate</a>
  <a id="_&lt;=_"></a><a id="6467" href="blog/complexity-analysis/index.html#6467" class="Postulate Operator">_&lt;=_</a> <a id="6472" class="Symbol">:</a> <a id="6474" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="6476" class="Symbol">‚Üí</a> <a id="6478" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="6480" class="Symbol">‚Üí</a> <a id="6482" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="6488" class="Number">1</a> <a data-type="Set" id="6490" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
</pre>
<p>First things first, we need another waiting function to inflate the times on every tail:</p>
<pre class="Agda"><a id="waitL"></a><a id="6594" href="blog/complexity-analysis/index.html#6594" class="Function">waitL</a>
    <a id="6604" class="Symbol">:</a> <a id="6606" class="Symbol">{</a><a id="6607" href="blog/complexity-analysis/index.html#6607" class="Bound">c&#39;</a> <a id="6610" class="Symbol">:</a> <a data-type="Set" id="6612" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="6613" class="Symbol">}</a> <a id="6615" class="Symbol">{</a><a id="6616" href="blog/complexity-analysis/index.html#6616" class="Bound">c</a> <a id="6618" class="Symbol">:</a> <a data-type="Set" id="6620" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="6621" class="Symbol">}</a>
    <a id="6627" class="Symbol">‚Üí</a> <a id="6629" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="6634" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="6636" href="blog/complexity-analysis/index.html#6607" class="Bound">c&#39;</a> <a id="6639" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a>
    <a id="6645" class="Symbol">‚Üí</a> <a id="6647" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="6653" class="Number">1</a> <a id="6655" class="Symbol">(</a><a id="6656" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="6661" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="6663" class="Symbol">(</a><a id="6664" class="Number">2</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="6666" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="6668" href="blog/complexity-analysis/index.html#6616" class="Bound">c</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="6670" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="6672" href="blog/complexity-analysis/index.html#6607" class="Bound">c&#39;</a><a id="6674" class="Symbol">)</a> <a id="6676" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="6677" class="Symbol">)</a>
<a id="6679" href="blog/complexity-analysis/index.html#6594" class="Function">waitL</a> <a id="6685" href="blog/complexity-analysis/index.html#4420" class="InductiveConstructor">[]</a> <a id="6688" class="Symbol">=</a> <a id="6690" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="6692" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="6697" href="blog/complexity-analysis/index.html#4420" class="InductiveConstructor">[]</a>
<a id="6700" href="blog/complexity-analysis/index.html#6594" class="Function">waitL</a> <a id="6706" class="Symbol">(</a><a id="6707" href="blog/complexity-analysis/index.html#6707" class="Bound">x</a> <a id="6709" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="6711" href="blog/complexity-analysis/index.html#6711" class="Bound">xs</a><a id="6713" class="Symbol">)</a> <a id="6715" class="Symbol">=</a> <a id="6717" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="6719" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="6724" class="Symbol">(</a><a id="6725" href="blog/complexity-analysis/index.html#6707" class="Bound">x</a> <a id="6727" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="6729" href="blog/complexity-analysis/index.html#4689" class="Function">wait</a> <a id="6734" class="Symbol">(</a><a id="6735" href="blog/complexity-analysis/index.html#6594" class="Function">waitL</a> <a id="6741" href="blog/complexity-analysis/index.html#2472" class="Function Operator">=&lt;&lt;</a> <a id="6745" href="blog/complexity-analysis/index.html#6711" class="Bound">xs</a><a id="6747" class="Symbol">))</a>
</pre>
<p>and a helper version of <span class="Agda"><a href="blog/complexity-analysis/index.html#6841" class="Function Operator">if_then_else_</a></span> which accounts in <span class="Agda"><a href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a></span>:</p>
<pre class="Agda"><a id="if_then_else_"></a><a id="6841" href="blog/complexity-analysis/index.html#6841" class="Function Operator">if_then_else_</a> <a id="6855" class="Symbol">:</a> <a data-type="Set" id="6857" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a> <a id="6862" class="Symbol">‚Üí</a> <a id="6864" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="6866" class="Symbol">‚Üí</a> <a id="6868" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="6870" class="Symbol">‚Üí</a> <a id="6872" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="6878" class="Number">1</a> <a id="6880" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a>
<a id="6882" href="blog/complexity-analysis/index.html#6841" class="Function Operator">if</a> <a data-type="Bool" id="6885" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a> <a id="6891" href="blog/complexity-analysis/index.html#6841" class="Function Operator">then</a> <a id="6896" href="blog/complexity-analysis/index.html#6896" class="Bound">t</a> <a id="6898" href="blog/complexity-analysis/index.html#6841" class="Function Operator">else</a> <a id="6903" href="blog/complexity-analysis/index.html#6903" class="Bound">f</a> <a id="6905" class="Symbol">=</a> <a id="6907" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="6909" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="6914" href="blog/complexity-analysis/index.html#6903" class="Bound">f</a>
<a id="6916" href="blog/complexity-analysis/index.html#6841" class="Function Operator">if</a> <a data-type="Bool" id="6919" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>  <a id="6925" href="blog/complexity-analysis/index.html#6841" class="Function Operator">then</a> <a id="6930" href="blog/complexity-analysis/index.html#6930" class="Bound">t</a> <a id="6932" href="blog/complexity-analysis/index.html#6841" class="Function Operator">else</a> <a id="6937" href="blog/complexity-analysis/index.html#6937" class="Bound">f</a> <a id="6939" class="Symbol">=</a> <a id="6941" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="6943" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="6948" href="blog/complexity-analysis/index.html#6930" class="Bound">t</a>
<a id="6950" class="Keyword">infixr</a> <a id="6957" class="Number">2</a> <a id="6959" href="blog/complexity-analysis/index.html#6841" class="Function Operator">if_then_else_</a>
</pre>
<p>we can thus write vector insertion:</p>
<pre class="Agda"><a id="insert"></a><a id="7019" href="blog/complexity-analysis/index.html#7019" class="Function">insert</a>
    <a id="7030" class="Symbol">:</a> <a id="7032" class="Symbol">{</a><a id="7033" href="blog/complexity-analysis/index.html#7033" class="Bound">c</a> <a id="7035" class="Symbol">:</a> <a data-type="Set" id="7037" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="7038" class="Symbol">}</a>
    <a id="7044" class="Symbol">‚Üí</a> <a id="7046" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a>
    <a id="7052" class="Symbol">‚Üí</a> <a id="7054" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="7059" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="7061" href="blog/complexity-analysis/index.html#7033" class="Bound">c</a> <a id="7063" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a>
    <a id="7069" class="Symbol">‚Üí</a> <a id="7071" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="7077" class="Number">4</a> <a id="7079" class="Symbol">(</a><a id="7080" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="7085" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="7087" class="Symbol">(</a><a id="7088" class="Number">4</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="7090" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="7092" href="blog/complexity-analysis/index.html#7033" class="Bound">c</a><a id="7093" class="Symbol">)</a> <a id="7095" class="Symbol">(</a><a data-type="Nat ‚Üí Nat" id="7096" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="7100" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="7101" class="Symbol">))</a>
<a id="7104" href="blog/complexity-analysis/index.html#7019" class="Function">insert</a> <a id="7111" href="blog/complexity-analysis/index.html#7111" class="Bound">x</a> <a id="7113" href="blog/complexity-analysis/index.html#4420" class="InductiveConstructor">[]</a> <a id="7116" class="Symbol">=</a> <a id="7118" href="blog/complexity-analysis/index.html#4689" class="Function">wait</a> <a id="7123" class="Symbol">(</a><a id="7124" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="7129" class="Symbol">(</a><a id="7130" href="blog/complexity-analysis/index.html#7111" class="Bound">x</a> <a id="7132" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="7134" href="blog/complexity-analysis/index.html#4689" class="Function">wait</a> <a id="7139" class="Symbol">(</a><a id="7140" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="7145" href="blog/complexity-analysis/index.html#4420" class="InductiveConstructor">[]</a><a id="7147" class="Symbol">)))</a>
<a id="7151" href="blog/complexity-analysis/index.html#7019" class="Function">insert</a> <a id="7158" href="blog/complexity-analysis/index.html#7158" class="Bound">x</a> <a id="7160" class="Symbol">(</a><a id="7161" href="blog/complexity-analysis/index.html#7161" class="Bound">y</a> <a id="7163" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="7165" href="blog/complexity-analysis/index.html#7165" class="Bound">ys</a><a id="7167" class="Symbol">)</a>
         <a id="7178" class="Symbol">=</a> <a id="7180" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="7182" href="blog/complexity-analysis/index.html#7158" class="Bound">x</a> <a id="7184" href="blog/complexity-analysis/index.html#6467" class="Postulate Operator">&lt;=</a> <a id="7187" href="blog/complexity-analysis/index.html#7161" class="Bound">y</a>
  <a id="7191" href="blog/complexity-analysis/index.html#2382" class="Function Operator">&gt;&gt;=</a> <a id="7195" class="Symbol">\</a><a id="7196" href="blog/complexity-analysis/index.html#7196" class="Bound">b</a> <a id="7198" class="Symbol">‚Üí</a> <a id="7200" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="7202" href="blog/complexity-analysis/index.html#6841" class="Function Operator">if</a> <a id="7205" href="blog/complexity-analysis/index.html#7196" class="Bound">b</a> <a id="7207" href="blog/complexity-analysis/index.html#6841" class="Function Operator">then</a> <a id="7212" href="blog/complexity-analysis/index.html#7158" class="Bound">x</a> <a id="7214" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="7216" href="blog/complexity-analysis/index.html#4689" class="Function">wait</a> <a id="7221" class="Symbol">(</a><a id="7222" href="blog/complexity-analysis/index.html#6594" class="Function">waitL</a> <a id="7228" class="Symbol">(</a><a id="7229" href="blog/complexity-analysis/index.html#7161" class="Bound">y</a> <a id="7231" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="7233" href="blog/complexity-analysis/index.html#7165" class="Bound">ys</a><a id="7235" class="Symbol">))</a>
                  <a id="7256" href="blog/complexity-analysis/index.html#6841" class="Function Operator">else</a> <a id="7261" href="blog/complexity-analysis/index.html#7161" class="Bound">y</a> <a id="7263" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="7265" class="Symbol">(</a><a id="7266" href="blog/complexity-analysis/index.html#7019" class="Function">insert</a> <a id="7273" href="blog/complexity-analysis/index.html#7158" class="Bound">x</a> <a id="7275" href="blog/complexity-analysis/index.html#2472" class="Function Operator">=&lt;&lt;</a> <a id="7279" href="blog/complexity-analysis/index.html#7165" class="Bound">ys</a><a id="7281" class="Symbol">)</a>
</pre>
<p>The obvious followup to <span class="Agda"><a href="blog/complexity-analysis/index.html#7019" class="Function">insert</a></span> is insertion <span class="Agda"><a href="blog/complexity-analysis/index.html#7410" class="Function">sort</a></span>:</p>
<pre class="Agda"><a id="7361" class="Keyword">open</a> <a id="7366" class="Keyword">import</a> <a id="7373" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="7382" class="Keyword">using</a> <a id="7388" class="Symbol">(</a><a id="7389" href="Data.Vec.Base.html#998" class="Datatype">Vec</a><a id="7392" class="Symbol">;</a> <a id="7394" href="Data.Vec.Base.html#1034" class="InductiveConstructor">[]</a><a id="7396" class="Symbol">;</a> <a id="7398" href="Data.Vec.Base.html#1053" class="InductiveConstructor Operator">_‚à∑_</a><a id="7401" class="Symbol">;</a> <a id="7403" href="Data.Vec.Base.html#1546" class="Function">tail</a><a id="7407" class="Symbol">)</a>

<a id="sort"></a><a id="7410" href="blog/complexity-analysis/index.html#7410" class="Function">sort</a> <a id="7415" class="Symbol">:</a> <a id="7417" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="7421" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="7423" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a> <a id="7425" class="Symbol">‚Üí</a> <a id="7427" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="7433" class="Symbol">(</a><a id="7434" class="Number">1</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="7436" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="7438" class="Number">5</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="7440" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="7442" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="7443" class="Symbol">)</a> <a id="7445" class="Symbol">(</a><a id="7446" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="7451" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="7453" class="Symbol">(</a><a id="7454" class="Number">4</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="7456" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="7458" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="7459" class="Symbol">)</a> <a id="7461" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="7462" class="Symbol">)</a>
<a id="7464" href="blog/complexity-analysis/index.html#7410" class="Function">sort</a> <a id="7469" href="Data.Vec.Base.html#1034" class="InductiveConstructor">[]</a> <a id="7472" class="Symbol">=</a> <a id="7474" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="7476" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="7481" href="blog/complexity-analysis/index.html#4420" class="InductiveConstructor">[]</a>
<a id="7484" href="blog/complexity-analysis/index.html#7410" class="Function">sort</a> <a id="7489" class="Symbol">(</a><a id="7490" href="blog/complexity-analysis/index.html#7490" class="Bound">x</a> <a id="7492" href="Data.Vec.Base.html#1053" class="InductiveConstructor Operator">‚à∑</a> <a id="7494" href="blog/complexity-analysis/index.html#7494" class="Bound">xs</a><a id="7496" class="Symbol">)</a> <a id="7498" class="Symbol">=</a> <a id="7500" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="7502" href="blog/complexity-analysis/index.html#7019" class="Function">insert</a> <a id="7509" href="blog/complexity-analysis/index.html#7490" class="Bound">x</a> <a id="7511" href="blog/complexity-analysis/index.html#2472" class="Function Operator">=&lt;&lt;</a> <a id="7515" href="blog/complexity-analysis/index.html#7410" class="Function">sort</a> <a id="7520" href="blog/complexity-analysis/index.html#7494" class="Bound">xs</a>
</pre>
<p>This thing looks linear, but insertion sort is <span style="white-space: nowrap;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>,</span> so what gives? The thing to notice is that the cost of each <em>tail</em> is linear, but we have <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> tails, so forcing the whole thing indeed works out to <span style="white-space: nowrap;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.</span> We can now show <span class="Agda"><a href="blog/complexity-analysis/index.html#7804" class="Function">head</a></span> runs in constant time:</p>
<pre class="Agda"><a id="head"></a><a id="7804" href="blog/complexity-analysis/index.html#7804" class="Function">head</a> <a id="7809" class="Symbol">:</a> <a id="7811" class="Symbol">{</a><a id="7812" href="blog/complexity-analysis/index.html#7812" class="Bound">c</a> <a id="7814" class="Symbol">:</a> <a data-type="Set" id="7816" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="7817" class="Symbol">}</a> <a id="7819" class="Symbol">‚Üí</a> <a id="7821" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="7826" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="7828" href="blog/complexity-analysis/index.html#7812" class="Bound">c</a> <a id="7830" class="Symbol">(</a><a data-type="Nat ‚Üí Nat" id="7831" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="7835" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="7836" class="Symbol">)</a> <a id="7838" class="Symbol">‚Üí</a> <a id="7840" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="7846" class="Number">1</a> <a id="7848" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a>
<a id="7850" href="blog/complexity-analysis/index.html#7804" class="Function">head</a> <a id="7855" class="Symbol">(</a><a id="7856" href="blog/complexity-analysis/index.html#7856" class="Bound">x</a> <a id="7858" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="7860" class="Symbol">_)</a> <a id="7863" class="Symbol">=</a> <a id="7865" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="7867" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="7872" href="blog/complexity-analysis/index.html#7856" class="Bound">x</a>
</pre>
<p>and that we can find the <span class="Agda"><a href="blog/complexity-analysis/index.html#7951" class="Function">minimum</a></span> element in linear time:</p>
<pre class="Agda"><a id="minimum"></a><a id="7951" href="blog/complexity-analysis/index.html#7951" class="Function">minimum</a> <a id="7959" class="Symbol">:</a> <a id="7961" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="7965" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="7967" class="Symbol">(</a><a data-type="Nat ‚Üí Nat" id="7968" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="7972" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="7973" class="Symbol">)</a> <a id="7975" class="Symbol">‚Üí</a> <a id="7977" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="7983" class="Symbol">(</a><a id="7984" class="Number">8</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="7986" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="7988" class="Number">5</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="7990" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="7992" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="7993" class="Symbol">)</a> <a id="7995" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a>
<a id="7997" href="blog/complexity-analysis/index.html#7951" class="Function">minimum</a> <a id="8005" href="blog/complexity-analysis/index.html#8005" class="Bound">xs</a> <a id="8008" class="Symbol">=</a> <a id="8010" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="8012" href="blog/complexity-analysis/index.html#7804" class="Function">head</a> <a id="8017" href="blog/complexity-analysis/index.html#2472" class="Function Operator">=&lt;&lt;</a> <a id="8021" href="blog/complexity-analysis/index.html#7410" class="Function">sort</a> <a id="8026" href="blog/complexity-analysis/index.html#8005" class="Bound">xs</a>
</pre>
<p>Interestingly, Agda can figure out the bounds on <span class="Agda"><a href="blog/complexity-analysis/index.html#7951" class="Function">minimum</a></span> by itself, but not any of our other functions.</p>
<p>The paper goes on to show that we can define <span class="Agda"><a href="blog/complexity-analysis/index.html#8264" class="Function">last</a></span>, and then get a quadratic-time <code>maximum</code> using it:</p>
<pre class="Agda"><a id="last"></a><a id="8264" href="blog/complexity-analysis/index.html#8264" class="Function">last</a> <a id="8269" class="Symbol">:</a> <a id="8271" class="Symbol">{</a><a id="8272" href="blog/complexity-analysis/index.html#8272" class="Bound">c</a> <a id="8274" class="Symbol">:</a> <a data-type="Set" id="8276" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="8277" class="Symbol">}</a> <a id="8279" class="Symbol">‚Üí</a> <a id="8281" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="8286" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="8288" href="blog/complexity-analysis/index.html#8272" class="Bound">c</a> <a id="8290" class="Symbol">(</a><a data-type="Nat ‚Üí Nat" id="8291" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="8295" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a><a id="8296" class="Symbol">)</a> <a id="8298" class="Symbol">‚Üí</a> <a id="8300" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="8306" class="Symbol">(</a><a id="8307" class="Number">1</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="8309" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a data-type="Nat ‚Üí Nat" id="8311" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="8315" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="8317" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a data-type="Nat ‚Üí Nat" id="8319" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="8323" href="blog/complexity-analysis/index.html#8272" class="Bound">c</a><a id="8324" class="Symbol">)</a> <a id="8326" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a>
<a id="8328" href="blog/complexity-analysis/index.html#8264" class="Function">last</a> <a id="8333" class="Symbol">(</a><a id="8334" href="blog/complexity-analysis/index.html#8334" class="Bound">x</a> <a id="8336" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="8338" href="blog/complexity-analysis/index.html#8338" class="Bound">xs</a><a id="8340" class="Symbol">)</a> <a id="8342" class="Symbol">=</a> <a id="8344" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="8346" href="blog/complexity-analysis/index.html#8373" class="Function">last&#39;</a> <a id="8352" href="blog/complexity-analysis/index.html#8334" class="Bound">x</a> <a id="8354" href="blog/complexity-analysis/index.html#2472" class="Function Operator">=&lt;&lt;</a> <a id="8358" href="blog/complexity-analysis/index.html#8338" class="Bound">xs</a>
  <a id="8363" class="Keyword">where</a>
    <a id="8373" href="blog/complexity-analysis/index.html#8373" class="Function">last&#39;</a> <a id="8379" class="Symbol">:</a> <a id="8381" class="Symbol">{</a><a id="8382" href="blog/complexity-analysis/index.html#8382" class="Bound">c</a> <a id="8384" class="Symbol">:</a> <a data-type="Set" id="8386" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="8387" class="Symbol">}</a> <a id="8389" class="Symbol">‚Üí</a> <a id="8391" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="8393" class="Symbol">‚Üí</a> <a id="8395" href="blog/complexity-analysis/index.html#4379" class="Datatype">VecL</a> <a id="8400" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a> <a id="8402" href="blog/complexity-analysis/index.html#8382" class="Bound">c</a> <a id="8404" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a> <a id="8406" class="Symbol">‚Üí</a> <a id="8408" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="8414" class="Symbol">(</a><a id="8415" class="Number">1</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="8417" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="8419" href="blog/complexity-analysis/index.html#1895" class="Generalizable">n</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="8421" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a data-type="Nat ‚Üí Nat" id="8423" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="8427" href="blog/complexity-analysis/index.html#8382" class="Bound">c</a><a id="8428" class="Symbol">)</a> <a id="8430" href="blog/complexity-analysis/index.html#1881" class="Generalizable">a</a>
    <a id="8436" href="blog/complexity-analysis/index.html#8373" class="Function">last&#39;</a> <a id="8442" href="blog/complexity-analysis/index.html#8442" class="Bound">a</a> <a id="8444" href="blog/complexity-analysis/index.html#4420" class="InductiveConstructor">[]</a> <a id="8447" class="Symbol">=</a> <a id="8449" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="8451" href="blog/complexity-analysis/index.html#2328" class="Function">pure</a> <a id="8456" href="blog/complexity-analysis/index.html#8442" class="Bound">a</a>
    <a id="8462" href="blog/complexity-analysis/index.html#8373" class="Function">last&#39;</a> <a id="8468" class="Symbol">_</a> <a id="8470" class="Symbol">(</a><a id="8471" href="blog/complexity-analysis/index.html#8471" class="Bound">x</a> <a id="8473" href="blog/complexity-analysis/index.html#4438" class="InductiveConstructor Operator">‚à∑</a> <a id="8475" href="blog/complexity-analysis/index.html#8475" class="Bound">xs</a><a id="8477" class="Symbol">)</a> <a id="8479" class="Symbol">=</a> <a id="8481" href="blog/complexity-analysis/index.html#2897" class="Function Operator">!</a> <a id="8483" href="blog/complexity-analysis/index.html#8373" class="Function">last&#39;</a> <a id="8489" href="blog/complexity-analysis/index.html#8471" class="Bound">x</a> <a id="8491" href="blog/complexity-analysis/index.html#2472" class="Function Operator">=&lt;&lt;</a> <a id="8495" href="blog/complexity-analysis/index.html#8475" class="Bound">xs</a>
</pre>
<p>Trying to define <code>maximum</code> makes Agda spin, probably because of one of my rewrite rules. But here‚Äôs what it should be:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">maximum</span> <span class="op">:</span> <span class="dt">Vec</span> a (suc n) ‚Üí <span class="dt">Thunk</span> (<span class="dv">13</span> <span class="op">+</span> <span class="dv">14</span> <span class="op">*</span> n <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> n <span class="op">^</span> <span class="dv">2</span>) a</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">maximum</span> xs <span class="ot">=</span> <span class="op">!</span> <span class="fu">last</span> <span class="op">=&lt;&lt;</span> <span class="fu">sort</span> xs</span></code></pre></div>
<p>The paper goes on to say some thinks about partially evaluating thunks, and then shows its use to measure some popular libraries. But I‚Äôm more interested in making the experience better.</p>
<h2 id="extra-curricular-big-o"><a href="#extra-curricular-big-o" class="header-link">Extra-curricular Big O<span class="header-link-emoji">üîó</span></a></h2>
<p>Clearly this is all too much work. When we do complexity analysis by hand, we are primarily concerned with <em>complexity classes,</em> not exact numbers of steps. How hard would it be to generalize all of this so that <code>Thunk</code> takes a function bounding the runtime necessary to produce its value?</p>
<p>First, a quick refresher on what big-O means. A function <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>:</mo><mi mathvariant="double-struck">N</mi><mo>‚Üí</mo><mi mathvariant="double-struck">N</mi></mrow><annotation encoding="application/x-tex">f : \mathbb{N} \to \mathbb{N}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6889em;"></span><span class="mord mathbb">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">‚Üí</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6889em;"></span><span class="mord mathbb">N</span></span></span></span> is said to be in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>g</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(g)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span></span> for some <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo>:</mo><mi mathvariant="double-struck">N</mi><mo>‚Üí</mo><mi mathvariant="double-struck">N</mi></mrow><annotation encoding="application/x-tex">g : \mathbb{N} \to \mathbb{N}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6889em;"></span><span class="mord mathbb">N</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">‚Üí</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6889em;"></span><span class="mord mathbb">N</span></span></span></span> iff:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">‚àÉ</mi><mo stretchy="false">(</mo><mi>C</mi><mi>k</mi><mo>:</mo><mi mathvariant="double-struck">N</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">‚àÄ</mi><mo stretchy="false">(</mo><mi>n</mi><mo>:</mo><mi mathvariant="double-struck">N</mi><mo separator="true">,</mo><mi>k</mi><mo>‚â§</mo><mi>n</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>‚â§</mo><mi>C</mi><mo>‚ãÖ</mo><mi>g</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">
\exists (C k : \mathbb{N}). \forall (n : \mathbb{N}, k \leq n). f(n) \leq C \cdot g(n)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">‚àÉ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathbb">N</span><span class="mclose">)</span><span class="mord">.‚àÄ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathbb">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">‚â§</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">‚â§</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">‚ãÖ</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span></p>
<p>That is, there is some point <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> at which <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> stays above <span style="white-space: nowrap;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>.</span> This is the formal definition, but in practice we usually play rather fast and loose with our notation. For example, we say ‚Äúquicksort is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo>‚ãÖ</mo><mi>log</mi><mo>‚Å°</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\cdot\log{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">‚ãÖ</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">n</span></span><span class="mclose">)</span></span></span></span> in the length of the list‚Äù, or ‚Äú<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo>‚ãÖ</mo><mi>log</mi><mo>‚Å°</mo><mi>m</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n\cdot\log{m})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">‚ãÖ</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">m</span></span><span class="mclose">)</span></span></span></span> , where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span> is the size of the first argument.‚Äù</p>
<p>We need to do a bit of elaboration here to turn these informal statements into a formal claim. In both cases, there should are implicit binders inside the <span style="white-space: nowrap;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mo>‚àí</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(-)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">‚àí</span><span class="mclose">)</span></span></span></span>,</span> binding <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> in the first, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">m, n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span> in the second. These functions then get instantiated with the actual sizes of the lists. It‚Äôs a subtle point, but it needs to be kept in mind.</p>
<p>The other question is how the hell do we generalize that definition to multiple variables? Easy! We replace <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>:</mo><mi mathvariant="double-struck">N</mi><mo separator="true">,</mo><mi>k</mi><mo>‚â§</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n : \mathbb{N}, k \leq n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathbb">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">‚â§</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> with a vector of natural numbers, subject to the constraint that they‚Äôre <em>all</em> bigger than <span style="white-space: nowrap;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>.</span></p>
<p>OK, let‚Äôs write some code. We can give the definition of <span class="Agda"><a href="blog/complexity-analysis/index.html#10572" class="Record">O</a></span>:</p>
<pre class="Agda"><a id="10468" class="Keyword">open</a> <a id="10473" class="Keyword">import</a> <a id="10480" href="Data.Vec.Relation.Unary.All.html" class="Module">Data.Vec.Relation.Unary.All</a>
    <a id="10512" class="Keyword">using</a> <a id="10518" class="Symbol">(</a><a id="10519" href="Data.Vec.Relation.Unary.All.html#1073" class="Datatype">All</a><a id="10522" class="Symbol">;</a> <a id="10524" href="Data.Vec.Relation.Unary.All.html#1165" class="InductiveConstructor Operator">_‚à∑_</a><a id="10527" class="Symbol">;</a> <a id="10529" href="Data.Vec.Relation.Unary.All.html#1148" class="InductiveConstructor">[]</a><a id="10531" class="Symbol">)</a>
    <a id="10537" class="Keyword">renaming</a> <a id="10546" class="Symbol">(</a><a id="10547" href="Data.Vec.Relation.Unary.All.html#1447" class="Function">tail</a> <a id="10552" class="Symbol">to</a> <a id="10555" class="Function">tailAll</a><a id="10562" class="Symbol">)</a>

<a id="10565" class="Keyword">record</a> <a id="O"></a><a id="10572" href="blog/complexity-analysis/index.html#10572" class="Record">O</a> <a id="10574" class="Symbol">{</a><a id="10575" href="blog/complexity-analysis/index.html#10575" class="Bound">vars</a> <a id="10580" class="Symbol">:</a> <a data-type="Set" id="10582" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="10583" class="Symbol">}</a> <a id="10585" class="Symbol">(</a><a id="10586" href="blog/complexity-analysis/index.html#10586" class="Bound">g</a> <a id="10588" class="Symbol">:</a> <a id="10590" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a data-type="Set" id="10594" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="10596" href="blog/complexity-analysis/index.html#10575" class="Bound">vars</a>  <a id="10602" class="Symbol">‚Üí</a> <a data-type="Set" id="10604" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="10605" class="Symbol">)</a> <a id="10607" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="10609" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="10613" class="Keyword">where</a>
  <a id="10621" class="Keyword">field</a>
    <a id="O.f"></a><a id="10631" href="blog/complexity-analysis/index.html#10631" class="Field">f</a> <a id="10633" class="Symbol">:</a> <a id="10635" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a data-type="Set" id="10639" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="10641" href="blog/complexity-analysis/index.html#10575" class="Bound">vars</a> <a id="10646" class="Symbol">‚Üí</a> <a data-type="Set" id="10648" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a>
    <a id="O.C"></a><a id="10654" href="blog/complexity-analysis/index.html#10654" class="Field">C</a> <a id="10656" class="Symbol">:</a> <a data-type="Set" id="10658" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a>
    <a id="O.k"></a><a id="10664" href="blog/complexity-analysis/index.html#10664" class="Field">k</a> <a id="10666" class="Symbol">:</a> <a data-type="Set" id="10668" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a>
    <a id="O.def"></a><a id="10674" href="blog/complexity-analysis/index.html#10674" class="Field">def</a> <a id="10678" class="Symbol">:</a> <a id="10680" class="Symbol">(</a><a id="10681" href="blog/complexity-analysis/index.html#10681" class="Bound">n</a> <a id="10683" class="Symbol">:</a> <a id="10685" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a data-type="Set" id="10689" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="10691" href="blog/complexity-analysis/index.html#10575" class="Bound">vars</a><a id="10695" class="Symbol">)</a> <a id="10697" class="Symbol">‚Üí</a> <a id="10699" href="Data.Vec.Relation.Unary.All.html#1073" class="Datatype">All</a> <a id="10703" class="Symbol">(</a><a id="10704" href="blog/complexity-analysis/index.html#10664" class="Field">k</a> <a id="10706" href="Data.Nat.Base.html#1535" class="Datatype Operator">‚â§_</a><a id="10708" class="Symbol">)</a> <a id="10710" href="blog/complexity-analysis/index.html#10681" class="Bound">n</a> <a id="10712" class="Symbol">‚Üí</a> <a id="10714" href="blog/complexity-analysis/index.html#10631" class="Field">f</a> <a id="10716" href="blog/complexity-analysis/index.html#10681" class="Bound">n</a> <a id="10718" href="Data.Nat.Base.html#1535" class="Datatype Operator">‚â§</a> <a id="10720" href="blog/complexity-analysis/index.html#10654" class="Field">C</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="10722" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="10724" href="blog/complexity-analysis/index.html#10586" class="Bound">g</a> <a id="10726" href="blog/complexity-analysis/index.html#10681" class="Bound">n</a>
</pre>
<p>The generality of <span class="Agda"><a href="blog/complexity-analysis/index.html#10572" class="Record">O</a></span> is a bit annoying for the common case of being a function over one variable, so we can introduce a helper function <span class="Agda"><a href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a></span>:</p>
<pre class="Agda"><a id="hoist"></a><a id="10895" href="blog/complexity-analysis/index.html#10895" class="Function">hoist</a> <a id="10901" class="Symbol">:</a> <a id="10903" class="Symbol">{</a><a id="10904" href="blog/complexity-analysis/index.html#10904" class="Bound">a</a> <a id="10906" href="blog/complexity-analysis/index.html#10906" class="Bound">b</a> <a id="10908" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="10910" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="10913" class="Symbol">}</a> <a id="10915" class="Symbol">‚Üí</a> <a id="10917" class="Symbol">(</a><a id="10918" href="blog/complexity-analysis/index.html#10904" class="Bound">a</a> <a id="10920" class="Symbol">‚Üí</a> <a id="10922" href="blog/complexity-analysis/index.html#10906" class="Bound">b</a><a id="10923" class="Symbol">)</a> <a id="10925" class="Symbol">‚Üí</a> <a id="10927" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="10931" href="blog/complexity-analysis/index.html#10904" class="Bound">a</a> <a id="10933" class="Number">1</a> <a id="10935" class="Symbol">‚Üí</a> <a id="10937" href="blog/complexity-analysis/index.html#10906" class="Bound">b</a>
<a id="10939" href="blog/complexity-analysis/index.html#10895" class="Function">hoist</a> <a id="10945" href="blog/complexity-analysis/index.html#10945" class="Bound">f</a> <a id="10947" class="Symbol">(</a><a id="10948" href="blog/complexity-analysis/index.html#10948" class="Bound">x</a> <a id="10950" href="Data.Vec.Base.html#1053" class="InductiveConstructor Operator">‚à∑</a> <a id="10952" href="Data.Vec.Base.html#1034" class="InductiveConstructor">[]</a><a id="10954" class="Symbol">)</a> <a id="10956" class="Symbol">=</a> <a id="10958" href="blog/complexity-analysis/index.html#10945" class="Bound">f</a> <a id="10960" href="blog/complexity-analysis/index.html#10948" class="Bound">x</a>

<a id="O&#39;"></a><a id="10963" href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a> <a id="10966" class="Symbol">:</a> <a id="10968" class="Symbol">(</a><a data-type="Set" id="10969" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="10971" class="Symbol">‚Üí</a> <a data-type="Set" id="10973" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="10974" class="Symbol">)</a> <a id="10976" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="10978" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="10982" href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a> <a id="10985" href="blog/complexity-analysis/index.html#10985" class="Bound">f</a> <a id="10987" class="Symbol">=</a> <a id="10989" href="blog/complexity-analysis/index.html#10572" class="Record">O</a> <a id="10991" class="Symbol">(</a><a id="10992" href="blog/complexity-analysis/index.html#10895" class="Function">hoist</a> <a id="10998" href="blog/complexity-analysis/index.html#10985" class="Bound">f</a><a id="10999" class="Symbol">)</a>
</pre>
<p>We can trivially lift any function <code>f</code> into <span class="Agda"><a href="blog/complexity-analysis/index.html#10572" class="Record">O</a></span> <code>f</code>:</p>
<pre class="Agda"><a id="O-build"></a><a id="11071" href="blog/complexity-analysis/index.html#11071" class="Function">O-build</a> <a id="11079" class="Symbol">:</a> <a id="11081" class="Symbol">{</a><a id="11082" href="blog/complexity-analysis/index.html#11082" class="Bound">vars</a> <a id="11087" class="Symbol">:</a> <a data-type="Set" id="11089" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="11090" class="Symbol">}</a> <a id="11092" class="Symbol">‚Üí</a> <a id="11094" class="Symbol">(</a><a id="11095" href="blog/complexity-analysis/index.html#11095" class="Bound">f</a> <a id="11097" class="Symbol">:</a> <a id="11099" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a data-type="Set" id="11103" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="11105" href="blog/complexity-analysis/index.html#11082" class="Bound">vars</a> <a id="11110" class="Symbol">‚Üí</a> <a data-type="Set" id="11112" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="11113" class="Symbol">)</a> <a id="11115" class="Symbol">‚Üí</a> <a id="11117" href="blog/complexity-analysis/index.html#10572" class="Record">O</a> <a id="11119" href="blog/complexity-analysis/index.html#11095" class="Bound">f</a>
<a id="11121" href="blog/complexity-analysis/index.html#11071" class="Function">O-build</a> <a id="11129" href="blog/complexity-analysis/index.html#11129" class="Bound">f</a> <a id="11131" class="Symbol">.</a><a id="11132" href="blog/complexity-analysis/index.html#10631" class="Field">O.f</a> <a id="11136" class="Symbol">=</a> <a id="11138" href="blog/complexity-analysis/index.html#11129" class="Bound">f</a>
<a id="11140" href="blog/complexity-analysis/index.html#11071" class="Function">O-build</a> <a id="11148" href="blog/complexity-analysis/index.html#11148" class="Bound">f</a> <a id="11150" class="Symbol">.</a><a id="11151" href="blog/complexity-analysis/index.html#10654" class="Field">O.C</a> <a id="11155" class="Symbol">=</a> <a id="11157" class="Number">1</a>
<a id="11159" href="blog/complexity-analysis/index.html#11071" class="Function">O-build</a> <a id="11167" href="blog/complexity-analysis/index.html#11167" class="Bound">f</a> <a id="11169" class="Symbol">.</a><a id="11170" href="blog/complexity-analysis/index.html#10664" class="Field">O.k</a> <a id="11174" class="Symbol">=</a> <a id="11176" class="Number">0</a>
<a id="11178" href="blog/complexity-analysis/index.html#11071" class="Function">O-build</a> <a id="11186" href="blog/complexity-analysis/index.html#11186" class="Bound">f</a> <a id="11188" class="Symbol">.</a><a id="11189" href="blog/complexity-analysis/index.html#10674" class="Field">O.def</a> <a id="11195" href="blog/complexity-analysis/index.html#11195" class="Bound">n</a> <a id="11197" href="blog/complexity-analysis/index.html#11197" class="Bound">x</a> <a id="11199" class="Symbol">=</a> <a id="11201" href="Data.Nat.Properties.html#4565" class="Function">‚â§-refl</a>
</pre>
<p>and also trivially weaken an <span class="Agda"><a href="blog/complexity-analysis/index.html#10572" class="Record">O</a></span> into using more variables:</p>
<pre class="Agda"><a id="O-weaken"></a><a id="11285" href="blog/complexity-analysis/index.html#11285" class="Function">O-weaken</a> <a id="11294" class="Symbol">:</a> <a id="11296" class="Symbol">‚àÄ</a> <a id="11298" class="Symbol">{</a><a id="11299" href="blog/complexity-analysis/index.html#11299" class="Bound">vars</a><a id="11303" class="Symbol">}</a> <a id="11305" class="Symbol">{</a><a id="11306" href="blog/complexity-analysis/index.html#11306" class="Bound">f</a> <a id="11308" class="Symbol">:</a> <a id="11310" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a data-type="Set" id="11314" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="11316" href="blog/complexity-analysis/index.html#11299" class="Bound">vars</a> <a id="11321" class="Symbol">‚Üí</a> <a data-type="Set" id="11323" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="11324" class="Symbol">}</a> <a id="11326" class="Symbol">‚Üí</a> <a id="11328" href="blog/complexity-analysis/index.html#10572" class="Record">O</a> <a id="11330" href="blog/complexity-analysis/index.html#11306" class="Bound">f</a> <a id="11332" class="Symbol">‚Üí</a> <a id="11334" href="blog/complexity-analysis/index.html#10572" class="Record">O</a> <a id="11336" class="Symbol">(</a><a id="11337" href="blog/complexity-analysis/index.html#11306" class="Bound">f</a> <a id="11339" href="Function.Base.html#1031" class="Function Operator">‚àò</a> <a id="11341" href="Data.Vec.Base.html#1546" class="Function">tail</a><a id="11345" class="Symbol">)</a>
<a id="11347" href="blog/complexity-analysis/index.html#11285" class="Function">O-weaken</a> <a id="11356" href="blog/complexity-analysis/index.html#11356" class="Bound">o</a> <a id="11358" class="Symbol">.</a><a id="11359" href="blog/complexity-analysis/index.html#10631" class="Field">O.f</a> <a id="11363" class="Symbol">=</a> <a id="11365" href="blog/complexity-analysis/index.html#11356" class="Bound">o</a> <a id="11367" class="Symbol">.</a><a id="11368" href="blog/complexity-analysis/index.html#10631" class="Field">O.f</a> <a id="11372" href="Function.Base.html#1031" class="Function Operator">‚àò</a> <a id="11374" href="Data.Vec.Base.html#1546" class="Function">tail</a>
<a id="11379" href="blog/complexity-analysis/index.html#11285" class="Function">O-weaken</a> <a id="11388" href="blog/complexity-analysis/index.html#11388" class="Bound">o</a> <a id="11390" class="Symbol">.</a><a id="11391" href="blog/complexity-analysis/index.html#10654" class="Field">O.C</a> <a id="11395" class="Symbol">=</a> <a id="11397" href="blog/complexity-analysis/index.html#11388" class="Bound">o</a> <a id="11399" class="Symbol">.</a><a id="11400" href="blog/complexity-analysis/index.html#10654" class="Field">O.C</a>
<a id="11404" href="blog/complexity-analysis/index.html#11285" class="Function">O-weaken</a> <a id="11413" href="blog/complexity-analysis/index.html#11413" class="Bound">o</a> <a id="11415" class="Symbol">.</a><a id="11416" href="blog/complexity-analysis/index.html#10664" class="Field">O.k</a> <a id="11420" class="Symbol">=</a> <a id="11422" href="blog/complexity-analysis/index.html#11413" class="Bound">o</a> <a id="11424" class="Symbol">.</a><a id="11425" href="blog/complexity-analysis/index.html#10664" class="Field">O.k</a>
<a id="11429" href="blog/complexity-analysis/index.html#11285" class="Function">O-weaken</a> <a id="11438" href="blog/complexity-analysis/index.html#11438" class="Bound">o</a> <a id="11440" class="Symbol">.</a><a id="11441" href="blog/complexity-analysis/index.html#10674" class="Field">O.def</a> <a id="11447" class="Symbol">(_</a> <a id="11450" href="Data.Vec.Base.html#1053" class="InductiveConstructor Operator">‚à∑</a> <a id="11452" href="blog/complexity-analysis/index.html#11452" class="Bound">x</a><a id="11453" class="Symbol">)</a> <a id="11455" class="Symbol">(_</a> <a id="11458" href="Data.Vec.Relation.Unary.All.html#1165" class="InductiveConstructor Operator">‚à∑</a> <a id="11460" href="blog/complexity-analysis/index.html#11460" class="Bound">eq</a><a id="11462" class="Symbol">)</a> <a id="11464" class="Symbol">=</a> <a id="11466" href="blog/complexity-analysis/index.html#11438" class="Bound">o</a> <a id="11468" class="Symbol">.</a><a id="11469" href="blog/complexity-analysis/index.html#10674" class="Field">O.def</a> <a id="11475" href="blog/complexity-analysis/index.html#11452" class="Bound">x</a> <a id="11477" href="blog/complexity-analysis/index.html#11460" class="Bound">eq</a>
</pre>
<p>More interestingly, we can lift a given <span class="Agda"><a href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a></span> into a higher power, witnessing the fact that eg, something of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> is also <span style="white-space: nowrap;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>:</span></p>
<pre class="Agda"><a id="O-^-suc"></a><a id="11632" href="blog/complexity-analysis/index.html#11632" class="Function">O-^-suc</a> <a id="11640" class="Symbol">:</a> <a id="11642" class="Symbol">{</a><a id="11643" href="blog/complexity-analysis/index.html#11643" class="Bound">n</a> <a id="11645" class="Symbol">:</a> <a data-type="Set" id="11647" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="11648" class="Symbol">}</a> <a id="11650" class="Symbol">‚Üí</a> <a id="11652" href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a> <a id="11655" class="Symbol">(</a><a id="11656" href="Data.Nat.Base.html#3471" class="Function Operator">_^</a> <a id="11659" href="blog/complexity-analysis/index.html#11643" class="Bound">n</a><a id="11660" class="Symbol">)</a> <a id="11662" class="Symbol">‚Üí</a> <a id="11664" href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a> <a id="11667" class="Symbol">(</a><a id="11668" href="Data.Nat.Base.html#3471" class="Function Operator">_^</a> <a data-type="Nat ‚Üí Nat" id="11671" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="11675" href="blog/complexity-analysis/index.html#11643" class="Bound">n</a><a id="11676" class="Symbol">)</a>
<a id="11678" href="blog/complexity-analysis/index.html#11632" class="Function">O-^-suc</a> <a id="11686" href="blog/complexity-analysis/index.html#11686" class="Bound">o</a> <a id="11688" class="Symbol">.</a><a id="11689" href="blog/complexity-analysis/index.html#10631" class="Field">O.f</a> <a id="11693" class="Symbol">=</a> <a id="11695" href="blog/complexity-analysis/index.html#11686" class="Bound">o</a> <a id="11697" class="Symbol">.</a><a id="11698" href="blog/complexity-analysis/index.html#10631" class="Field">O.f</a>
<a id="11702" href="blog/complexity-analysis/index.html#11632" class="Function">O-^-suc</a> <a id="11710" href="blog/complexity-analysis/index.html#11710" class="Bound">o</a> <a id="11712" class="Symbol">.</a><a id="11713" href="blog/complexity-analysis/index.html#10654" class="Field">O.C</a> <a id="11717" class="Symbol">=</a> <a id="11719" href="blog/complexity-analysis/index.html#11710" class="Bound">o</a> <a id="11721" class="Symbol">.</a><a id="11722" href="blog/complexity-analysis/index.html#10654" class="Field">O.C</a>
<a id="11726" href="blog/complexity-analysis/index.html#11632" class="Function">O-^-suc</a> <a id="11734" href="blog/complexity-analysis/index.html#11734" class="Bound">o</a> <a id="11736" class="Symbol">.</a><a id="11737" href="blog/complexity-analysis/index.html#10664" class="Field">O.k</a> <a id="11741" class="Symbol">=</a> <a data-type="Nat ‚Üí Nat" id="11743" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="11747" class="Symbol">(</a><a id="11748" href="blog/complexity-analysis/index.html#11734" class="Bound">o</a> <a id="11750" class="Symbol">.</a><a id="11751" href="blog/complexity-analysis/index.html#10664" class="Field">O.k</a><a id="11754" class="Symbol">)</a>
<a id="11756" href="blog/complexity-analysis/index.html#11632" class="Function">O-^-suc</a> <a id="11764" class="Symbol">{</a><a id="11765" href="blog/complexity-analysis/index.html#11765" class="Bound">n</a><a id="11766" class="Symbol">}</a> <a id="11768" href="blog/complexity-analysis/index.html#11768" class="Bound">o</a> <a id="11770" class="Symbol">.</a><a id="11771" href="blog/complexity-analysis/index.html#10674" class="Field">O.def</a> <a id="11777" href="blog/complexity-analysis/index.html#11777" class="Bound">xs</a><a id="11779" class="Symbol">@(</a><a id="11781" href="blog/complexity-analysis/index.html#11781" class="Bound">x</a> <a id="11783" href="Data.Vec.Base.html#1053" class="InductiveConstructor Operator">‚à∑</a> <a id="11785" href="Data.Vec.Base.html#1034" class="InductiveConstructor">[]</a><a id="11787" class="Symbol">)</a> <a id="11789" href="blog/complexity-analysis/index.html#11789" class="Bound">ps</a><a id="11791" class="Symbol">@(</a><a id="11793" href="Data.Nat.Base.html#1600" class="InductiveConstructor">s‚â§s</a> <a id="11797" href="blog/complexity-analysis/index.html#11797" class="Bound">px</a> <a id="11800" href="Data.Vec.Relation.Unary.All.html#1165" class="InductiveConstructor Operator">‚à∑</a> <a id="11802" href="Data.Vec.Relation.Unary.All.html#1148" class="InductiveConstructor">[]</a><a id="11804" class="Symbol">)</a> <a id="11806" class="Symbol">=</a>
  <a id="11810" href="Relation.Binary.Reasoning.Base.Triple.html#3010" class="Function Operator">begin</a>
    <a id="11820" href="blog/complexity-analysis/index.html#10631" class="Function">f</a> <a id="11822" href="blog/complexity-analysis/index.html#11777" class="Bound">xs</a>               <span class="reasoning-step"><span class="as-written Function"><a id="11839" href="Relation.Binary.Reasoning.Base.Triple.html#3745" class="Function">‚â§‚ü®</a> <a id="11842" href="blog/complexity-analysis/index.html#10674" class="Function">def</a> <a id="11846" href="blog/complexity-analysis/index.html#11777" class="Bound">xs</a> <a id="11849" class="Symbol">(</a><a id="11850" href="Data.Nat.Properties.html#7182" class="Function">‚â§-step</a> <a id="11857" href="blog/complexity-analysis/index.html#11797" class="Bound">px</a> <a id="11860" href="Data.Vec.Relation.Unary.All.html#1165" class="InductiveConstructor Operator">‚à∑</a> <a id="11862" href="Data.Vec.Relation.Unary.All.html#1148" class="InductiveConstructor">[]</a><a id="11864" class="Symbol">)</a> <a id="11866" href="Relation.Binary.Reasoning.Base.Triple.html#3745" class="Function">‚ü©</a></span><span class="alternate Function">‚â§</span></span>
    <a id="11872" href="blog/complexity-analysis/index.html#10654" class="Function">C</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="11874" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="11876" class="Symbol">(</a><a id="11877" href="blog/complexity-analysis/index.html#11781" class="Bound">x</a> <a id="11879" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="11881" href="blog/complexity-analysis/index.html#11765" class="Bound">n</a><a id="11882" class="Symbol">)</a>        <span class="reasoning-step"><span class="as-written Function"><a id="11891" href="Relation.Binary.Reasoning.Base.Triple.html#3745" class="Function">‚â§‚ü®</a> <a id="11894" href="Data.Nat.Properties.html#25321" class="Function">*-monoÀ°-‚â§</a> <a id="11904" class="Symbol">(</a><a id="11905" href="blog/complexity-analysis/index.html#11781" class="Bound">x</a> <a id="11907" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="11909" href="blog/complexity-analysis/index.html#11765" class="Bound">n</a><a id="11910" class="Symbol">)</a> <a id="11912" class="Symbol">(</a><a id="11913" href="Data.Nat.Properties.html#26034" class="Function">m‚â§m*n</a> <a id="11919" href="blog/complexity-analysis/index.html#10654" class="Function">C</a> <a id="11921" class="Symbol">(</a><a id="11922" href="Data.Nat.Base.html#1600" class="InductiveConstructor">s‚â§s</a> <a id="11926" href="Data.Nat.Base.html#1558" class="InductiveConstructor">z‚â§n</a><a id="11929" class="Symbol">))</a> <a id="11932" href="Relation.Binary.Reasoning.Base.Triple.html#3745" class="Function">‚ü©</a></span><span class="alternate Function">‚â§</span></span>
    <a id="11938" class="Symbol">(</a><a id="11939" href="blog/complexity-analysis/index.html#10654" class="Function">C</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="11941" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="11943" href="blog/complexity-analysis/index.html#11781" class="Bound">x</a><a id="11944" class="Symbol">)</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="11946" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="11948" class="Symbol">(</a><a id="11949" href="blog/complexity-analysis/index.html#11781" class="Bound">x</a> <a id="11951" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="11953" href="blog/complexity-analysis/index.html#11765" class="Bound">n</a><a id="11954" class="Symbol">)</a>  <span class="reasoning-step"><span class="as-written Function"><a id="11957" href="Relation.Binary.Reasoning.Base.Triple.html#4518" class="Function">‚â°‚ü®</a> <a id="11960" href="Data.Nat.Properties.html#21046" class="Function">*-assoc</a> <a id="11968" href="blog/complexity-analysis/index.html#10654" class="Function">C</a> <a id="11970" href="blog/complexity-analysis/index.html#11781" class="Bound">x</a> <a id="11972" class="Symbol">(</a><a id="11973" href="blog/complexity-analysis/index.html#11781" class="Bound">x</a> <a id="11975" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="11977" href="blog/complexity-analysis/index.html#11765" class="Bound">n</a><a id="11978" class="Symbol">)</a> <a id="11980" href="Relation.Binary.Reasoning.Base.Triple.html#4518" class="Function">‚ü©</a></span><span class="alternate Function">‚â°</span></span>
    <a id="11986" href="blog/complexity-analysis/index.html#10654" class="Function">C</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="11988" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="11990" class="Symbol">(</a><a id="11991" href="blog/complexity-analysis/index.html#11781" class="Bound">x</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="11993" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="11995" class="Symbol">(</a><a id="11996" href="blog/complexity-analysis/index.html#11781" class="Bound">x</a> <a id="11998" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="12000" href="blog/complexity-analysis/index.html#11765" class="Bound">n</a><a id="12001" class="Symbol">))</a>
  <a id="12006" href="Relation.Binary.Reasoning.Base.Triple.html#5119" class="Function Operator">‚àé</a>
  <a id="12010" class="Keyword">where</a>
    <a id="12020" class="Keyword">open</a> <a id="12025" href="blog/complexity-analysis/index.html#10572" class="Module">O</a> <a id="12027" href="blog/complexity-analysis/index.html#11768" class="Bound">o</a>
    <a id="12033" class="Keyword">open</a> <a id="12038" href="Data.Nat.Properties.html#12478" class="Module">‚â§-Reasoning</a>
</pre>
<p>However, the challenge is and has always been to simplify the construction of <span class="Agda"><a href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a></span> bounds. Thus, we‚Äôd like the ability to remove low-order terms from <span class="Agda"><a href="blog/complexity-analysis/index.html#10572" class="Record">O</a></span>s. We can do this by eliminating <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">n^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span> whenever there is a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><msup><mi>k</mi><mo mathvariant="normal" lspace="0em" rspace="0em">‚Ä≤</mo></msup></msup></mrow><annotation encoding="application/x-tex">n^{k&#39;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9425em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> term around with <span style="white-space: nowrap;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>‚â§</mo><msup><mi>k</mi><mo mathvariant="normal" lspace="0em" rspace="0em">‚Ä≤</mo></msup></mrow><annotation encoding="application/x-tex">k \leq k&#39;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">‚â§</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7519em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚Ä≤</span></span></span></span></span></span></span></span></span></span></span></span>:</span></p>
<pre class="Agda"><a id="12328" class="Keyword">postulate</a>
  <a id="O-drop-low"></a><a id="12340" href="blog/complexity-analysis/index.html#12340" class="Postulate">O-drop-low</a>
    <a id="12355" class="Symbol">:</a> <a id="12357" class="Symbol">{</a><a id="12358" href="blog/complexity-analysis/index.html#12358" class="Bound">z</a> <a id="12360" href="blog/complexity-analysis/index.html#12360" class="Bound">x</a> <a id="12362" href="blog/complexity-analysis/index.html#12362" class="Bound">y</a> <a id="12364" href="blog/complexity-analysis/index.html#12364" class="Bound">k</a> <a id="12366" href="blog/complexity-analysis/index.html#12366" class="Bound">k&#39;</a> <a id="12369" class="Symbol">:</a> <a data-type="Set" id="12371" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="12372" class="Symbol">}</a>
    <a id="12378" class="Symbol">‚Üí</a> <a id="12380" href="blog/complexity-analysis/index.html#12364" class="Bound">k</a> <a id="12382" href="Data.Nat.Base.html#1535" class="Datatype Operator">‚â§</a> <a id="12384" href="blog/complexity-analysis/index.html#12366" class="Bound">k&#39;</a>
    <a id="12391" class="Symbol">‚Üí</a> <a id="12393" href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a> <a id="12396" class="Symbol">(\</a><a id="12398" href="blog/complexity-analysis/index.html#12398" class="Bound">n</a> <a id="12400" class="Symbol">‚Üí</a> <a id="12402" href="blog/complexity-analysis/index.html#12358" class="Bound">z</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="12404" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="12406" href="blog/complexity-analysis/index.html#12360" class="Bound">x</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="12408" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="12410" href="blog/complexity-analysis/index.html#12398" class="Bound">n</a> <a id="12412" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="12414" href="blog/complexity-analysis/index.html#12364" class="Bound">k</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="12416" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="12418" href="blog/complexity-analysis/index.html#12362" class="Bound">y</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="12420" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="12422" href="blog/complexity-analysis/index.html#12398" class="Bound">n</a> <a id="12424" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="12426" href="blog/complexity-analysis/index.html#12366" class="Bound">k&#39;</a><a id="12428" class="Symbol">)</a>
    <a id="12434" class="Symbol">‚Üí</a> <a id="12436" href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a> <a id="12439" class="Symbol">(\</a><a id="12441" href="blog/complexity-analysis/index.html#12441" class="Bound">n</a> <a id="12443" class="Symbol">‚Üí</a> <a id="12445" href="blog/complexity-analysis/index.html#12358" class="Bound">z</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="12447" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="12449" href="blog/complexity-analysis/index.html#12441" class="Bound">n</a> <a id="12451" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="12453" href="blog/complexity-analysis/index.html#12366" class="Bound">k&#39;</a><a id="12455" class="Symbol">)</a>
</pre>
<p>The <code>z</code> variable here lets us compose <span class="Agda"><a href="blog/complexity-analysis/index.html#12340" class="Postulate">O-drop-low</a></span> terms, by subsequently instantiating</p>
<p>As a special case, we can eliminate constant terms via <span class="Agda"><a href="blog/complexity-analysis/index.html#12340" class="Postulate">O-drop-low</a></span> by first expanding constant terms to be coefficients of <span style="white-space: nowrap;"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>0</mn></msup></mrow><annotation encoding="application/x-tex">n^0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span></span></span></span>:</span></p>
<pre class="Agda"><a id="O-drop-1"></a><a id="12701" href="blog/complexity-analysis/index.html#12701" class="Function">O-drop-1</a>
  <a id="12712" class="Symbol">:</a> <a id="12714" class="Symbol">{</a><a id="12715" href="blog/complexity-analysis/index.html#12715" class="Bound">x</a> <a id="12717" href="blog/complexity-analysis/index.html#12717" class="Bound">y</a> <a id="12719" href="blog/complexity-analysis/index.html#12719" class="Bound">k</a> <a id="12721" class="Symbol">:</a> <a data-type="Set" id="12723" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="12724" class="Symbol">}</a>
  <a id="12728" class="Symbol">‚Üí</a> <a id="12730" href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a> <a id="12733" class="Symbol">(\</a><a id="12735" href="blog/complexity-analysis/index.html#12735" class="Bound">n</a> <a id="12737" class="Symbol">‚Üí</a> <a id="12739" href="blog/complexity-analysis/index.html#12715" class="Bound">x</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="12741" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="12743" href="blog/complexity-analysis/index.html#12717" class="Bound">y</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="12745" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="12747" href="blog/complexity-analysis/index.html#12735" class="Bound">n</a> <a id="12749" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="12751" href="blog/complexity-analysis/index.html#12719" class="Bound">k</a><a id="12752" class="Symbol">)</a>
  <a id="12756" class="Symbol">‚Üí</a> <a id="12758" href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a> <a id="12761" class="Symbol">(\</a><a id="12763" href="blog/complexity-analysis/index.html#12763" class="Bound">n</a> <a id="12765" class="Symbol">‚Üí</a> <a id="12767" href="blog/complexity-analysis/index.html#12763" class="Bound">n</a> <a id="12769" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="12771" href="blog/complexity-analysis/index.html#12719" class="Bound">k</a><a id="12772" class="Symbol">)</a>
<a id="12774" href="blog/complexity-analysis/index.html#12701" class="Function">O-drop-1</a> <a id="12783" class="Symbol">{</a><a id="12784" href="blog/complexity-analysis/index.html#12784" class="Bound">x</a><a id="12785" class="Symbol">}</a> <a id="12787" class="Symbol">{</a><a id="12788" href="blog/complexity-analysis/index.html#12788" class="Bound">y</a><a id="12789" class="Symbol">}</a> <a id="12791" class="Symbol">{</a><a id="12792" href="blog/complexity-analysis/index.html#12792" class="Bound">k</a><a id="12793" class="Symbol">}</a> <a id="12795" href="blog/complexity-analysis/index.html#12795" class="Bound">o</a> <a id="12797" class="Keyword">rewrite</a> <a id="12805" href="Relation.Binary.PropositionalEquality.Core.html#1684" class="Function">sym</a> <a id="12809" class="Symbol">(</a><a id="12810" href="Data.Nat.Properties.html#20010" class="Function">*-identity ≥</a> <a id="12822" href="blog/complexity-analysis/index.html#12784" class="Bound">x</a><a id="12823" class="Symbol">)</a> <a id="12825" class="Symbol">=</a>
  <a id="12829" href="blog/complexity-analysis/index.html#12340" class="Postulate">O-drop-low</a> <a id="12840" class="Symbol">{</a><a id="12841" class="Number">0</a><a id="12842" class="Symbol">}</a> <a id="12844" class="Symbol">{</a><a id="12845" href="blog/complexity-analysis/index.html#12784" class="Bound">x</a><a id="12846" class="Symbol">}</a> <a id="12848" class="Symbol">{</a><a id="12849" href="blog/complexity-analysis/index.html#12788" class="Bound">y</a><a id="12850" class="Symbol">}</a> <a id="12852" class="Symbol">{</a><a id="12853" class="Argument">k</a> <a id="12855" class="Symbol">=</a> <a id="12857" class="Number">0</a><a id="12858" class="Symbol">}</a> <a id="12860" class="Symbol">{</a><a id="12861" href="blog/complexity-analysis/index.html#12792" class="Bound">k</a><a id="12862" class="Symbol">}</a> <a id="12864" href="Data.Nat.Base.html#1558" class="InductiveConstructor">z‚â§n</a> <a id="12868" href="blog/complexity-analysis/index.html#12795" class="Bound">o</a>
</pre>
<p>With these functions, we can now easily construct <span class="Agda"><a href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a></span> values for arbitrary one-variable functions:</p>
<pre class="Agda"><a id="12987" href="blog/complexity-analysis/index.html#12987" class="Function">_</a> <a id="12989" class="Symbol">:</a> <a id="12991" href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a> <a id="12994" class="Symbol">(</a><a id="12995" href="Data.Nat.Base.html#3471" class="Function Operator">_^</a> <a id="12998" class="Number">1</a><a id="12999" class="Symbol">)</a>
<a id="13001" class="Symbol">_</a> <a id="13003" class="Symbol">=</a> <a id="13005" href="blog/complexity-analysis/index.html#12701" class="Function">O-drop-1</a> <a id="13014" class="Symbol">{</a><a id="13015" class="Number">4</a><a id="13016" class="Symbol">}</a> <a id="13018" class="Symbol">{</a><a id="13019" class="Number">5</a><a id="13020" class="Symbol">}</a> <a id="13022" class="Symbol">{</a><a id="13023" class="Number">1</a><a id="13024" class="Symbol">}</a> <a id="13026" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="13028" href="blog/complexity-analysis/index.html#11071" class="Function">O-build</a> <a id="13036" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="13038" href="blog/complexity-analysis/index.html#10895" class="Function">hoist</a> <a id="13044" class="Symbol">\</a><a id="13045" href="blog/complexity-analysis/index.html#13045" class="Bound">n</a> <a id="13047" class="Symbol">‚Üí</a> <a id="13049" class="Number">4</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="13051" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="13053" class="Number">5</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="13055" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="13057" href="blog/complexity-analysis/index.html#13045" class="Bound">n</a> <a id="13059" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="13061" class="Number">1</a>

<a id="13064" href="blog/complexity-analysis/index.html#13064" class="Function">_</a> <a id="13066" class="Symbol">:</a> <a id="13068" href="blog/complexity-analysis/index.html#10963" class="Function">O&#39;</a> <a id="13071" class="Symbol">(</a><a id="13072" href="Data.Nat.Base.html#3471" class="Function Operator">_^</a> <a id="13075" class="Number">2</a><a id="13076" class="Symbol">)</a>
<a id="13078" class="Symbol">_</a> <a id="13080" class="Symbol">=</a> <a id="13082" href="blog/complexity-analysis/index.html#12701" class="Function">O-drop-1</a> <a id="13091" class="Symbol">{</a><a id="13092" class="Number">4</a><a id="13093" class="Symbol">}</a> <a id="13095" class="Symbol">{</a><a id="13096" class="Number">1</a><a id="13097" class="Symbol">}</a> <a id="13099" class="Symbol">{</a><a id="13100" class="Number">2</a><a id="13101" class="Symbol">}</a>
  <a id="13105" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="13107" href="blog/complexity-analysis/index.html#12340" class="Postulate">O-drop-low</a> <a id="13118" class="Symbol">{</a><a id="13119" class="Number">4</a><a id="13120" class="Symbol">}</a> <a id="13122" class="Symbol">{</a><a id="13123" class="Number">5</a><a id="13124" class="Symbol">}</a> <a id="13126" class="Symbol">{</a><a id="13127" class="Number">3</a><a id="13128" class="Symbol">}</a> <a id="13130" class="Symbol">{</a><a id="13131" class="Number">1</a><a id="13132" class="Symbol">}</a> <a id="13134" class="Symbol">{</a><a id="13135" class="Number">2</a><a id="13136" class="Symbol">}</a> <a id="13138" class="Symbol">(</a><a id="13139" href="Data.Nat.Base.html#1600" class="InductiveConstructor">s‚â§s</a> <a id="13143" href="Data.Nat.Base.html#1558" class="InductiveConstructor">z‚â§n</a><a id="13146" class="Symbol">)</a>
  <a id="13150" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="13152" href="blog/complexity-analysis/index.html#11071" class="Function">O-build</a> <a id="13160" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="13162" href="blog/complexity-analysis/index.html#10895" class="Function">hoist</a> <a id="13168" class="Symbol">\</a><a id="13169" href="blog/complexity-analysis/index.html#13169" class="Bound">n</a> <a id="13171" class="Symbol">‚Üí</a> <a id="13173" class="Number">4</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="13175" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="13177" class="Number">5</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="13179" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="13181" href="blog/complexity-analysis/index.html#13169" class="Bound">n</a> <a id="13183" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="13185" class="Number">1</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="13187" href="Agda.Builtin.Nat.html#325" class="Primitive Operator">+</a> <a id="13189" class="Number">3</a> <a data-type="Nat ‚Üí Nat ‚Üí Nat" id="13191" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">*</a> <a id="13193" href="blog/complexity-analysis/index.html#13169" class="Bound">n</a> <a id="13195" href="Data.Nat.Base.html#3471" class="Function Operator">^</a> <a id="13197" class="Number">2</a>
</pre>
<p>Finally, we just need to build a version of <span class="Agda"><a href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a></span> that is adequately lifted over the same functions we use for <span class="Agda"><a href="blog/complexity-analysis/index.html#10572" class="Record">O</a></span>:</p>
<pre class="Agda"><a id="13341" class="Keyword">abstract</a>
  <a id="OThunk"></a><a id="13352" href="blog/complexity-analysis/index.html#13352" class="Function">OThunk</a> <a id="13359" class="Symbol">:</a> <a id="13361" class="Symbol">{</a><a id="13362" href="blog/complexity-analysis/index.html#13362" class="Bound">vars</a> <a id="13367" class="Symbol">:</a> <a data-type="Set" id="13369" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="13370" class="Symbol">}</a> <a id="13372" class="Symbol">‚Üí</a> <a id="13374" class="Symbol">(</a><a id="13375" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a data-type="Set" id="13379" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="13381" href="blog/complexity-analysis/index.html#13362" class="Bound">vars</a> <a id="13386" class="Symbol">‚Üí</a> <a data-type="Set" id="13388" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="13389" class="Symbol">)</a> <a id="13391" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="13393" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="13397" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="13399" href="Agda.Primitive.html#326" class="Primitive">Set</a>
  <a id="13405" href="blog/complexity-analysis/index.html#13352" class="Function">OThunk</a> <a id="13412" class="Symbol">_</a> <a id="13414" href="blog/complexity-analysis/index.html#13414" class="Bound">a</a> <a id="13416" class="Symbol">=</a> <a id="13418" href="blog/complexity-analysis/index.html#13414" class="Bound">a</a>

  <a id="OThunk&#39;"></a><a id="13423" href="blog/complexity-analysis/index.html#13423" class="Function">OThunk&#39;</a> <a id="13431" class="Symbol">:</a> <a id="13433" class="Symbol">(</a><a data-type="Set" id="13434" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="13436" class="Symbol">‚Üí</a> <a data-type="Set" id="13438" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="13439" class="Symbol">)</a> <a id="13441" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="13443" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="13447" class="Symbol">‚Üí</a> <a data-type="Set‚ÇÅ" id="13449" href="Agda.Primitive.html#326" class="Primitive">Set</a>
  <a id="13455" href="blog/complexity-analysis/index.html#13423" class="Function">OThunk&#39;</a> <a id="13463" href="blog/complexity-analysis/index.html#13463" class="Bound">f</a> <a id="13465" class="Symbol">=</a> <a id="13467" href="blog/complexity-analysis/index.html#13352" class="Function">OThunk</a> <a id="13474" class="Symbol">(</a><a id="13475" href="blog/complexity-analysis/index.html#10895" class="Function">hoist</a> <a id="13481" href="blog/complexity-analysis/index.html#13463" class="Bound">f</a><a id="13482" class="Symbol">)</a>
</pre>
<p>The <span class="Agda"><a href="blog/complexity-analysis/index.html#13586" class="Function">limit</a></span> function can be used to lift a <span class="Agda"><a href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a></span> into an <span class="Agda"><a href="blog/complexity-analysis/index.html#13352" class="Function">OThunk</a></span>:</p>
<pre class="Agda">  <a id="limit"></a><a id="13586" href="blog/complexity-analysis/index.html#13586" class="Function">limit</a>
    <a id="13596" class="Symbol">:</a> <a id="13598" class="Symbol">{</a><a id="13599" href="blog/complexity-analysis/index.html#13599" class="Bound">vars</a> <a id="13604" class="Symbol">:</a> <a data-type="Set" id="13606" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="13607" class="Symbol">}</a> <a id="13609" class="Symbol">{</a><a id="13610" href="blog/complexity-analysis/index.html#13610" class="Bound">f</a> <a id="13612" class="Symbol">:</a> <a id="13614" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a data-type="Set" id="13618" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="13620" href="blog/complexity-analysis/index.html#13599" class="Bound">vars</a> <a id="13625" class="Symbol">‚Üí</a> <a data-type="Set" id="13627" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a><a id="13628" class="Symbol">}</a> <a id="13630" class="Symbol">{</a><a id="13631" href="blog/complexity-analysis/index.html#13631" class="Bound">a</a> <a id="13633" class="Symbol">:</a> <a data-type="Set‚ÇÅ" id="13635" href="Agda.Primitive.html#326" class="Primitive">Set</a><a id="13638" class="Symbol">}</a>
    <a id="13644" class="Symbol">‚Üí</a> <a id="13646" class="Symbol">(</a><a id="13647" href="blog/complexity-analysis/index.html#13647" class="Bound">v</a> <a id="13649" class="Symbol">:</a> <a id="13651" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a data-type="Set" id="13655" href="Agda.Builtin.Nat.html#192" class="Datatype">‚Ñï</a> <a id="13657" href="blog/complexity-analysis/index.html#13599" class="Bound">vars</a><a id="13661" class="Symbol">)</a>
    <a id="13667" class="Symbol">‚Üí</a> <a id="13669" class="Symbol">(</a><a id="13670" href="blog/complexity-analysis/index.html#13670" class="Bound">o</a> <a id="13672" class="Symbol">:</a> <a id="13674" href="blog/complexity-analysis/index.html#10572" class="Record">O</a> <a id="13676" href="blog/complexity-analysis/index.html#13610" class="Bound">f</a><a id="13677" class="Symbol">)</a>
    <a id="13683" class="Symbol">‚Üí</a> <a id="13685" href="blog/complexity-analysis/index.html#1925" class="Function">Thunk</a> <a id="13691" class="Symbol">(</a><a id="13692" href="blog/complexity-analysis/index.html#13670" class="Bound">o</a> <a id="13694" class="Symbol">.</a><a id="13695" href="blog/complexity-analysis/index.html#10631" class="Field">O.f</a> <a id="13699" href="blog/complexity-analysis/index.html#13647" class="Bound">v</a><a id="13700" class="Symbol">)</a> <a id="13702" href="blog/complexity-analysis/index.html#13631" class="Bound">a</a> <a id="13704" class="Symbol">‚Üí</a> <a id="13706" href="blog/complexity-analysis/index.html#13352" class="Function">OThunk</a> <a id="13713" href="blog/complexity-analysis/index.html#13610" class="Bound">f</a> <a id="13715" href="blog/complexity-analysis/index.html#13631" class="Bound">a</a>
  <a id="13719" href="blog/complexity-analysis/index.html#13586" class="Function">limit</a> <a id="13725" class="Symbol">_</a> <a id="13727" class="Symbol">_</a> <a id="13729" href="blog/complexity-analysis/index.html#13729" class="Bound">x</a> <a id="13731" class="Symbol">=</a> <a id="13733" href="blog/complexity-analysis/index.html#13729" class="Bound">x</a>
</pre>
<p>and we can now give an asymptotic bound over <span class="Agda"><a href="blog/complexity-analysis/index.html#7410" class="Function">sort</a></span>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>o2 <span class="op">:</span> <span class="dt">O&#39;</span> (_<span class="op">^</span> <span class="dv">1</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>o2 <span class="ot">=</span> <span class="dt">O</span><span class="op">-</span><span class="fu">drop</span><span class="op">-</span><span class="dv">1</span> {<span class="dv">1</span>} {<span class="dv">5</span>} {<span class="dv">1</span>} <span class="op">$</span> <span class="dt">O</span><span class="op">-</span>build <span class="op">$</span> hoist \n <span class="ot">-&gt;</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">5</span> <span class="op">*</span> n</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>linearHeadSort <span class="op">:</span> <span class="dt">Vec</span> a n ‚Üí <span class="dt">OThunk&#39;</span> (_<span class="op">^</span> <span class="dv">1</span>) (<span class="dt">VecL</span> a (<span class="dv">4</span> <span class="op">*</span> n) n)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>linearHeadSort {n <span class="ot">=</span> n} v <span class="ot">=</span> limit (n ‚à∑ []) o2 <span class="op">$</span> <span class="fu">sort</span> v</span></code></pre></div>
<h2 id="conclusions"><a href="#conclusions" class="header-link">Conclusions<span class="header-link-emoji">üîó</span></a></h2>
<p>I‚Äôm traveling right now, and ran out of internet on publication day, which means I don‚Äôt have a copy of the paper in front of me as I write this (foolish!) Overall, the paper is slightly interesting, though I don‚Äôt think there‚Äôs anything especially novel here. Sticking the runtime behavior into the type is pretty much babby‚Äôs first example of graded monads, and we don‚Äôt even get asymptotics out of it! Instead we need to push big polynomials around, and explicitly call <span class="Agda"><a href="blog/complexity-analysis/index.html#4689" class="Function">wait</a></span> to make different branches work out.</p>
<p>The <span class="Agda"><a href="blog/complexity-analysis/index.html#10572" class="Record">O</a></span> stuff I‚Äôve presented here alleviates a few of those problems; as it allows us to relatively-easily throw away the polynomials and just work with the highest order terms. A probably better approach would be to throw away the functions, and use a canonical normalizing-form to express the asymptotes. Then we could define a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="#cc0000"><mtext>\lub</mtext></mstyle></mrow><annotation encoding="application/x-tex">\lub</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text" style="color:#cc0000;"><span class="mord" style="color:#cc0000;">\lub</span></span></span></span></span> operator over <span class="Agda"><a href="blog/complexity-analysis/index.html#13352" class="Function">OThunk</a></span>s, and define:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>_<span class="op">&gt;&gt;=</span>_ <span class="op">:</span> <span class="dt">OThunk</span> f a ‚Üí (a ‚Üí <span class="dt">OThunk</span> g b) ‚Üí <span class="dt">OThunk</span> (f ‚äî g) b</span></code></pre></div>
<p>to let us work compositionally in the land of big O.</p>
<p>My biggest takeaway here is that the techniques described in this paper are probably not powerful enough to be used in anger. Or, at least, not if you actually want to get any work done. Between the monads, polynomials, and waiting, the experience could use a lot of TLC.</p>

<p class="meta">
</p>

</div>

<div class="comments">
  <script src="https://utteranc.es/client.js" repo="isovector/reasonablypolymorphic.com" issue-term="pathname" theme="github-light" crossorigin="anonymous" async>
  </script>
</div>
</article>

</div>
    <nav>
        <h1><a href="/">REASONABLY<br />POLYMORPHIC</a></h1>
    
        <p> Hi there. I&#39;m <strong>Sandy Maguire</strong>. I like improving life and
        making cool things.</p>
    
        <p>If you want to get in touch, I&#39;d love to hear from you! Send me an
        email; you can contact me via <tt><b>sandy</b></tt> at <tt><b>sandymaguire.me</b></tt>.</p>
    
        <h2>SITE LINKS</h2>
        <ul>
            <li><a href="/">Archives</a></li>
            <li><a href="/talks">Talks</a></li>
        </ul>
    
        <h2>THINGS I MAKE</h2>
        <ul>
            <li>Code on <a href="http://github.com/isovector">github</a></li>
            <li>Book <a href="/book/preface.html">archive</a></li>
            <li>My other <a href="http://sandymaguire.me">blog</a></li>
        </ul>
    
        <h2>WHAT I&#39;M DOING</h2>
        <ul>
            <!-- <li><a href="/erdos">Erdos Project</a></li> -->
            <li>Music at <a href="http://last.fm/user/Paamayim">last.fm</a></li>
            <li>Books at <a href="https://www.goodreads.com/review/list/14945161-sandy-maguire?shelf=currently-reading">goodreads</a></li>
            <!-- <li>Papers at <a href="https://www.mendeley.com/groups/7295141/read/papers/">mendeley</a></li> -->
        </ul>
    
        <p>
        ¬© 2015-2023 Sandy Maguire
        </p>
    </nav>

    <!--
    <div id="smallnav">
      <div class="smallhome"><a href="/">REASONABLY POLYMORPHIC</a></div>
      <div class="smallarchives"><a href="/blog/archives/">ARCHIVES</a></div>
    </div>
    -->
</body>
</html>

